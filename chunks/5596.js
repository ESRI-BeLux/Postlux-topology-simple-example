"use strict";(self.webpackChunkarcgis_typescript_template=self.webpackChunkarcgis_typescript_template||[]).push([[5596],{2296:(e,t,i)=>{i.d(t,{I:()=>f,b:()=>m});var n=i(77788),a=i(29592),s=i(31790),r=i(65630),o=i(78546),l=i(83660),c=i(69952),h=i(19635),d=i(41014),p=i(92624),u=i(19778),_=i(7782),g=i(33763);function m(e){const t=new p.N5,{vertex:i,fragment:m}=t;return(0,c.NB)(i,e),t.include(s.d,e),t.attributes.add(g.r.POSITION,"vec3"),t.attributes.add(g.r.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(g.r.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.code.add(d.H`
    void main(void) {
      vpos = position;
      ${e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0;
      gl_Position = transformPosition(proj, view, vpos);

      ${e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":""}
    }
  `),t.include(a.HQ,e),t.include(r.Q,e),m.uniforms.add(new u.N("tex",(e=>e.texture)),new h.m("opacity",(e=>e.opacity))),t.varyings.add("vTexCoord","vec2"),e.output===n.V.Alpha?m.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}

      float alpha = texture(tex, vTexCoord).a * opacity;
      if (alpha  < ${d.H.float(o.H)}) {
        discard;
      }

      fragColor = vec4(alpha);
    }
    `):(m.include(l.a),m.code.add(d.H`
    void main() {
      discardBySlice(vpos);
      ${e.multipassEnabled?"terrainDepthTest(depth);":""}
      fragColor = texture(tex, vTexCoord) * opacity;

      if (fragColor.a < ${d.H.float(o.H)}) {
        discard;
      }

      fragColor = highlightSlice(fragColor, vpos);
      ${e.transparencyPassType===_.y.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    }
    `)),t}const f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},6578:(e,t,i)=>{i.d(t,{L:()=>f,b:()=>_});var n=i(25336),a=i(26110),s=i(53334),r=i(56560),o=i(1725),l=i(66579),c=i(19635),h=i(41014),d=i(99040),p=i(92624),u=i(33763);function _(e){const t=new p.N5;t.include(o.K,e);const{vertex:i,fragment:a}=t;return i.uniforms.add(new d.X("modelView",((e,t)=>(0,n.Tl)(m,t.camera.viewMatrix,e.origin))),new d.X("proj",((e,t)=>t.camera.projectionMatrix)),new c.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new l.G("pixelToNDC",((e,t)=>(0,s.hZ)(g,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))),t.attributes.add(u.r.START,"vec3"),t.attributes.add(u.r.END,"vec3"),t.attributes.add(u.r.UP,"vec3"),t.attributes.add(u.r.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add(h.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),a.uniforms.add(new c.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),a.code.add(h.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
vec3 dEndStart = vViewEnd - vViewStart;
if (dot(dEndStart, dEndStart) < 1e-5) {
discard;
}
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
fragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const g=(0,r.vt)(),m=(0,a.vt)(),f=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},75232:(e,t,i)=>{i.d(t,{L:()=>I,b:()=>w,d:()=>M});var n=i(4506),a=i(53334),s=i(56560),r=i(80347),o=i(19913),l=i(74772),c=i(76982),h=i(94669),d=i(87368),p=i(69891),u=i(1725),_=i(28019),g=i(66579),m=i(64802),f=i(92121),v=i(19635),y=i(41014),b=i(92624);const M=(0,n.kU)(6);function w(e){const t=new b.N5;t.include(_.c),t.include(u.K,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new v.m("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add(y.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,i)=>(0,r.e)(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>(0,r.e)(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add(new f.E("heightManifoldOrigin",((i,n)=>(e(E,i,n),t(R,n),(0,r.f)(R,R,E),(0,r.n)(A,R),A[3]=(0,r.l)(R),A))),new m.t("globalOrigin",((e,i)=>t(E,i))),new v.m("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,r.q)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,r.l)(e.heightManifoldTarget)))),i.code.add(y.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else i.code.add(y.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(i.uniforms.add(new v.m("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add(y.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new v.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.code.add(y.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add(y.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),i.code.add(y.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled){i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("heightPlane",((e,t)=>x(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,E),t.camera.viewMatrix))));const t=e.spherical?y.H`normalize(globalOrigin - pos)`:y.H`heightPlane.xyz`;i.code.add(y.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${t})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return e.pointDistanceEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("pointDistanceSphere",((e,t)=>function(e,t){return(0,r.e)((0,p.g)(C),e.pointDistanceOrigin,t.camera.viewMatrix),C[3]=(0,r.q)(e.pointDistanceOrigin,e.pointDistanceTarget),C}(e,t)))),i.code.add(y.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new f.E("lineVerticalPlane",((e,t)=>function(e,t){const i=(0,h.sd)(e.lineVerticalPlaneSegment,.5,E),n=e.renderCoordsHelper.worldUpAtPosition(i,T),a=(0,r.n)(R,e.lineVerticalPlaneSegment.vector),s=(0,r.b)(E,n,a);return(0,r.n)(s,s),x(e.lineVerticalPlaneSegment.origin,s,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalStart",((e,t)=>function(e,t){const i=(0,r.c)(E,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),(0,r.e)(i,i,t.camera.viewMatrix)}(e,t))),new m.t("lineVerticalEnd",((e,t)=>function(e,t){const i=(0,r.g)(E,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),(0,r.e)(i,i,t.camera.viewMatrix)}(e,t)))),i.code.add(y.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new g.G("angleCutoff",(e=>S(e))),new m.t("intersectsLineStart",((e,t)=>(0,r.e)(E,e.lineStartWorld,t.camera.viewMatrix))),new m.t("intersectsLineEnd",((e,t)=>(0,r.e)(E,e.lineEndWorld,t.camera.viewMatrix))),new m.t("intersectsLineDirection",((e,t)=>((0,r.c)(A,e.intersectsLineSegment.vector),A[3]=0,(0,r.n)(E,(0,l.t)(A,A,t.camera.viewMatrix))))),new v.m("intersectsLineRadius",(e=>e.intersectsLineRadius))),i.code.add(y.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),i.code.add(y.H`fragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}function S(e){return(0,a.hZ)(O,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,n.kU)(2))))}function x(e,t,i){return(0,r.e)(P,e,i),(0,r.c)(A,t),A[3]=0,(0,l.t)(A,A,i),(0,d.O_)(P,A,D)}const O=(0,s.vt)(),E=(0,o.vt)(),A=(0,c.vt)(),T=(0,o.vt)(),R=(0,o.vt)(),P=(0,o.vt)(),D=(0,d.vt)(),C=(0,p.c)(),I=Object.freeze(Object.defineProperty({__proto__:null,build:w,defaultAngleCutoff:M},Symbol.toStringTag,{value:"Module"}))},32349:(e,t,i)=>{i.d(t,{S:()=>M,b:()=>v});var n=i(76982),a=i(12540),s=i(77788),r=i(29592),o=i(31790),l=i(65630),c=i(78546),h=i(83660),d=i(69952),p=i(64802),u=i(92121),_=i(41014),g=i(92624),m=i(7782),f=i(33763);function v(e){const t=new g.N5,i=e.multipassEnabled&&(e.output===s.V.Color||e.output===s.V.Alpha);t.include(o.d,e),t.include(a.L,e),t.include(r.HQ,e);const{vertex:n,fragment:v}=t;return v.include(h.a),(0,d.NB)(n,e),v.uniforms.add(new u.E("uColor",(e=>e.color))),t.attributes.add(f.r.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(f.r.OFFSET,"vec3"),e.shadingEnabled&&((0,d.S7)(n),t.attributes.add(f.r.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),n.code.add(_.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&n.code.add(_.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),n.code.add(_.H`
    ${i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),i&&t.include(l.Q,e),v.code.add(_.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${i?"terrainDepthTest(depth);":""}
    `),e.shadingEnabled?(v.uniforms.add(new p.t("shadingDirection",(e=>e.shadingDirection))),v.uniforms.add(new u.E("shadedColor",(e=>y(e.shadingTint,e.color)))),v.code.add(_.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):v.code.add(_.H`vec4 finalColor = uColor;`),v.code.add(_.H`
      ${e.output===s.V.ObjectAndLayerIdColor?_.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${_.H.float(c.y)}) {
        discard;
      }
      ${e.output===s.V.Alpha?_.H`fragColor = vec4(finalColor.a);`:""}

      ${e.output===s.V.Color?_.H`fragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===m.y.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    }
    `),t}function y(e,t){const i=1-e[3],n=e[3]+t[3]*i;return 0===n?(b[3]=n,b):(b[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,b[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,b[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,b[3]=t[3],b)}const b=(0,n.vt)(),M=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},70465:(e,t,i)=>{i.d(t,{S:()=>h,b:()=>c});var n=i(69952),a=i(92121),s=i(19635),r=i(41014),o=i(92624),l=i(33763);function c(e){const t=new o.N5,{vertex:i,fragment:c,attributes:h,varyings:d}=t;return(0,n.NB)(i,e),h.add(l.r.POSITION,"vec3"),h.add(l.r.UV0,"vec2"),d.add("vUV","vec2"),i.code.add(r.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),c.uniforms.add(new a.E("backgroundColor",(e=>e.backgroundColor)),new a.E("gridColor",(e=>e.gridColor)),new s.m("gridWidth",(e=>e.gridWidth))),c.code.add(r.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const h=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},18031:(e,t,i)=>{i.d(t,{P:()=>u});var n=i(62991),a=i(89809),s=i(47980),r=i(19759),o=i(1874),l=i(88135),c=i(91101),h=i(81482),d=i(80925),p=i(55714);function u(e){const t=e?.origins??[void 0];return(i,n)=>{const a=function(e,t,i){if("resource"===e?.type)return function(e,t,i){const n=(0,l.z4)(t,i);return{type:String,read:(e,t,i)=>{const a=(0,p.r)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer(t,a,o,l){if(!l?.resources)return"string"==typeof t?void(a[o]=(0,p.t)(t,l)):void(a[o]=t.write({},l));const h=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),u=(0,p.t)(h,{...l,verifyItemRelativeUrls:l?.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},p.M.NO),f=n.type!==String&&(!(0,s.H)(this)||l?.origin&&this.originIdOf(i)>(0,c.aB)(l.origin)),v={object:this,propertyName:i,value:t,targetUrl:u,dest:a,targetPropertyName:o,context:l,params:e};l?.portalItem&&u&&!(0,r.oP)(u)?f&&e?.contentAddressed?_(v):f?function(e){const{context:t,targetUrl:i,params:n,value:a,dest:s,targetPropertyName:o}=e;if(!t.portalItem)return;const l=t.portalItem.resourceFromPath(i),c=m(a,i,t),h=(0,d.n)(c),p=(0,r.Zo)(l.path),u=n?.compress??!1;h===p?(t.resources&&g({...e,resource:l,content:c,compress:u,updates:t.resources.toUpdate}),s[o]=i):_(e)}(v):function({context:e,targetUrl:t,dest:i,targetPropertyName:n}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),i[n]=t)}(v):l?.portalItem&&(null==u||null!=(0,p.i)(u)||(0,r.w8)(u)||f)?_(v):a[o]=u}}}}(e,t,i);switch(e?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=p.b;return{read:e,write:t}}}}(e,i,n);for(const e of t){const t=(0,h.rM)(i,e,n);for(const e in a)t[e]=a[e]}}}function _(e){const{targetUrl:t,params:i,value:s,context:l,dest:c,targetPropertyName:h}=e;if(!l.portalItem)return;const u=(0,p.p)(t),_=m(s,t,l);if(i?.contentAddressed&&"json"!==_.type)return void l.messages?.push(new n.A("persistable:contentAddressingUnsupported",`Property "${h}" is trying to serializing a resource with content of type ${_.type} with content addressing. Content addressing is only supported for json resources.`,{content:_}));const f=i?.contentAddressed&&"json"===_.type?(0,a.d)(_.jsonString):u?.filename??(0,o.lk)(),v=(0,r.fj)(i?.prefix??u?.prefix,f),y=`${v}.${(0,d.n)(_)}`;if(i?.contentAddressed&&l.resources&&"json"===_.type){const e=l.resources.toKeep.find((({resource:e})=>e.path===y))??l.resources.toAdd.find((({resource:e})=>e.path===y));if(e)return void(c[h]=e.resource.itemRelativeUrl)}const b=l.portalItem.resourceFromPath(y);(0,r.w8)(t)&&l.resources&&l.resources.pendingOperations.push((0,r.tk)(t).then((e=>{b.path=`${v}.${(0,d.n)({type:"blob",blob:e})}`,c[h]=b.itemRelativeUrl})).catch((()=>{})));const M=i?.compress??!1;l.resources&&g({...e,resource:b,content:_,compress:M,updates:l.resources.toAdd}),c[h]=b.itemRelativeUrl}function g({object:e,propertyName:t,updates:i,resource:n,content:a,compress:s}){i.push({resource:n,content:a,compress:s,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function m(e,t,i){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(i))}}},53357:(e,t,i)=>{function n(){return new Float32Array(4)}function a(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,n){const a=new Float32Array(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a}function r(){return n()}function o(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function h(){return s(0,0,1,0)}function d(){return s(0,0,0,1)}i.d(t,{fA:()=>s,o8:()=>a});const p=r(),u=o(),_=l(),g=c(),m=h(),f=d();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_W:f,UNIT_X:_,UNIT_Y:g,UNIT_Z:m,ZEROS:p,clone:a,create:n,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:o,unitW:d,unitX:l,unitY:c,unitZ:h,zeros:r},Symbol.toStringTag,{value:"Module"}))},47980:(e,t,i)=>{function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{H:()=>n})},63540:(e,t,i)=>{i.d(t,{l:()=>c});var n=i(4506),a=i(25336),s=i(19913),r=i(31262),o=i(99269),l=i(67488);function c(e,t,i,n){if(null==e||null==n)return!1;const s=(0,o.Qk)(e,o.Wv),c=(0,o.Qk)(n,o.zp);if(s===c&&!h(c)&&(s!==o.rz.UNKNOWN||(0,l.aI)(e,n)))return(0,a.kN)(i,t),!0;if(h(c)){const e=o.w5[s][o.rz.LON_LAT],n=o.w5[o.rz.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,p,0),n(p,0,u,0),(0,r.y)(d*p[0],d*p[1],i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}if((c===o.rz.WEB_MERCATOR||c===o.rz.PLATE_CARREE||c===o.rz.WGS84)&&(s===o.rz.WGS84||s===o.rz.CGCS2000&&c===o.rz.PLATE_CARREE||s===o.rz.SPHERICAL_ECEF||s===o.rz.WEB_MERCATOR)){const e=o.w5[s][o.rz.LON_LAT],n=o.w5[o.rz.LON_LAT][c];return null!=e&&null!=n&&(e(t,0,p,0),n(p,0,u,0),s===o.rz.SPHERICAL_ECEF?(0,r.C)(d*p[0],d*p[1],i):(0,a.D_)(i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}return!1}function h(e){return e===o.rz.SPHERICAL_ECEF||e===o.rz.SPHERICAL_MARS_PCPF||e===o.rz.SPHERICAL_MOON_PCPF}const d=(0,n.kU)(1),p=(0,s.vt)(),u=(0,s.vt)()},31262:(e,t,i)=>{i.d(t,{C:()=>s,y:()=>a});var n=i(25336);function a(e,t,i){const n=Math.sin(e),a=Math.cos(e),s=Math.sin(t),r=Math.cos(t),o=i;return o[0]=-n,o[4]=-s*a,o[8]=r*a,o[12]=0,o[1]=a,o[5]=-s*n,o[9]=r*n,o[13]=0,o[2]=0,o[6]=r,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function s(e,t,i){return a(e,t,i),(0,n.mg)(i,i),i}},80925:(e,t,i)=>{i.d(t,{n:()=>a});var n=i(19759);function a(e){return s[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,n.Zo)(e);return l[t]||r}(e.url)}(e)]||o}const s={},r="text/plain",o=s[r],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in l)s[l[e]]=e},52799:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool3D:()=>Xi,ExtentTransformTool:()=>co,GraphicMoveTool:()=>is,GraphicReshapeTool:()=>Rs,GraphicTransformTool:()=>Ys});var n=i(82392),a=i(60861),s=i(70214),r=i(57725),o=i(61985),l=i(81482),c=i(6273),h=(i(80861),i(67498),i(26325)),d=i(80347),p=i(19913),u=i(19541),_=i(44223),g=i(23572),m=(i(62991),i(93814)),f=i(73783),v=i(3132),y=i(4506),b=i(37623),M=i(37902),w=i(5262),S=i(53334),x=i(56560),O=i(11021),E=i(11631),A=i(10709),T=i(92174);i(2980);let R=(e,t,i)=>{for(let n=0,a=t.length;n<a;n++){let a=t[n];Array.isArray(a)?R(e,a,i):null!=a&&!1!==a&&("string"==typeof a&&(a={vnodeSelector:"",properties:void 0,children:void 0,text:a.toString(),domNode:null}),i.push(a))}};i(58133);const P={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let D=class extends f.A{get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){const{textColor:e,backgroundColor:t}=this,i=t.clone();return i.a*=e.a,i}get _textShadow(){const e=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${e}`}get padding(){return.5*this.fontSize}get _borderRadius(){return this.padding}constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new m.A([0,0,0,.6]),this.textColor=new m.A([255,255,255]),this._textShadowSize=1}render(){return function(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let n,a;return i&&1===i.length&&"string"==typeof i[0]?n=i[0]:i&&(a=[],R("div",i,a),0===a.length&&(a=void 0)),{vnodeSelector:"div",properties:t,children:a,text:""===n?void 0:n,domNode:null}}(0,{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this.padding,n=this._borderRadius,a=e.measureText(this.text).width,s=this.fontSize,r=C[this.anchor];e.textAlign="center",e.textBaseline="middle";const o=a+2*i,l=s+2*i,c=this.x+r.x*o,h=this.y+r.y*l;this._roundedRect(e,c,h,o,l,n),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const d=this.x+(r.x+.5)*o,p=this.y+(r.y+.5)*l;this._renderTextShadow(e,this.text,d,p),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,d,p)}_renderTextShadow(e,t,i,n){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/I.length})`;const a=this._textShadowSize;for(const[s,r]of I)e.fillText(t,i+a*s,n+a*r)}_roundedRect(e,t,i,n,a,s){e.beginPath(),e.moveTo(t,i+s),e.arcTo(t,i,t+s,i,s),e.lineTo(t+n-s,i),e.arcTo(t+n,i,t+n,i+s,s),e.lineTo(t+n,i+a-s),e.arcTo(t+n,i+a,t+n-s,i+a,s),e.lineTo(t+s,i+a),e.arcTo(t,i+a,t,i+a-s,s),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};let t;for(t in P)e[P[t]]=this.anchor===t;return e}};(0,n._)([(0,l.MZ)()],D.prototype,"x",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"y",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"position",null),(0,n._)([(0,l.MZ)()],D.prototype,"text",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"fontSize",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"anchor",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"visible",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"isDecoration",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"backgroundColor",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"textColor",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"_textShadowSize",void 0),(0,n._)([(0,l.MZ)()],D.prototype,"_textShadowColor",null),(0,n._)([(0,l.MZ)()],D.prototype,"_textShadow",null),(0,n._)([(0,l.MZ)()],D.prototype,"padding",null),(0,n._)([(0,l.MZ)()],D.prototype,"_borderRadius",null),D=(0,n._)([(0,h.$)("esri.views.overlay.TextOverlayItem")],D);const C={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},I=[];{const e=16;for(let t=0;t<360;t+=360/e)I.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const L=D;var G=i(49970);const z={default:15,far:25};let V=class extends f.A{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,v.UT)((async e=>{const t=await(0,A.ud)("esri/core/t9n/Units");(0,b.Te)(e),this._messagesUnits=t}));this.addHandles([(0,o.wB)((()=>[null!=this.context&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,o.on)((()=>this.context?.editGeometryOperations),e,(()=>this._update())))),(0,s.hA)((()=>e.abort())),(0,o.wB)((()=>this._colors),(e=>this._updateStyle(e)))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return null==this._messagesUnits}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return z[this.edgeDistance]}get _colors(){const e=this.context?.view.effectiveTheme.textColor??m.A.fromArray([255,255,255]);return{textColor:e,backgroundColor:(0,a._L)((0,a.bJ)(e,a.pW.Low),.6)}}_update(){if(this.destroyed)return;this._nextLabelIndex=0;const{context:e,stagedVertex:t}=this;if(!e)return this._destroyUnusedLabels();const{editGeometryOperations:i}=e,{components:n,geometry:a,coordinateHelper:s}=i.data;if(!a)return this._destroyUnusedLabels();const r=n.length;for(let n=0;n<r;++n){const o=N(a,i,t,s,n);if(o.length<2||!Z(o,e.view,e.elevationInfo,s.spatialReference))continue;const l=1===r&&!(0,O.$3)(o);let c=k,h=U;this.toScreenPointArray(e,o[0],c);for(let t=1;t<o.length;++t){const i=o[t-1],n=o[t];this.toScreenPointArray(e,n,h),this._addLabel(e,i,c,n,h,l),[c,h]=[h,c]}}this._destroyUnusedLabels()}_updateStyle({textColor:e,backgroundColor:t}){const i=this._nextLabelIndex,n=this._labelInfos;for(let a=0;a<i;++a){const{label:i}=n[a];i.textColor=e,i.backgroundColor=t}}_addLabel(e,t,i,n,a,s){const{label:r}=this._getOrCreateLabel(e);if(!this.visible||(0,S.hG)(i,a)<3025)return void(r.visible=!1);const{spatialReference:o}=e.editGeometryOperations.data,l=(0,G.Do)(t,n,o),c=this._messagesUnits,h=(0,T.c)(e.view);r.text=null!=c&&null!=l?(0,M.ix)(c,l,h):"",r.visible=!0;const d=a[0]-i[0],p=a[1]-i[1];s?(0,S.hZ)(j,-p,d):(0,S.hZ)(j,p,-d),(0,S.S8)(j,j),(0,S.hs)(j,j,this._edgeDistancePixels),(0,S.Cc)(F,i,a,.5),(0,S.WQ)(F,F,j),r.position=[F[0],F[1]],Math.abs(j[0])>Math.abs(j[1])?r.anchor=j[0]>0?"left":"right":r.anchor=-j[1]<0?"top":"bottom"}_getOrCreateLabel(e){const t=this._labelInfos.length>this._nextLabelIndex,{textColor:i,backgroundColor:n}=this._colors;if(t){const e=this._labelInfos[this._nextLabelIndex++],{label:t}=e;return t.textColor=i,t.backgroundColor=n,e}const a=new L({anchor:"center",fontSize:8,textColor:i,backgroundColor:n});e.view.overlay?.items.add(a);const s={label:a};return this._labelInfos.push(s),this._nextLabelIndex=this._labelInfos.length,s}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){this.context?.view.overlay?.items.remove(e),e.destroy()}};function N(e,t,i,n,a){const s=[];if(t.data.components[a].iterateVertices((e=>{s.push(n.toXYZ(e.pos,E.rq.get()))})),0===a&&null!=i&&s.push(n.toXYZ(i,E.rq.get())),s.length<2)return s;const r=s[0],o=s[s.length-1];return"polygon"===e.type&&s.length>2&&!(0,d.G)(r,o)&&s.push(r),s}function Z(e,t,i,n){if("2d"===t.type)return!0;const a=(0,w.Ao)(n)??1,s=(0,w.G9)(n),r=e=>(0,u.xS)(t,e,n,i,u.qt)??0;for(let t=1;t<e.length;++t){const i=e[t-1],n=e[t],o=(n[0]-i[0])*a,l=(n[1]-i[1])*a,c=(r(n)-r(i))*s;if(Math.abs(c)/Math.sqrt(o*o+l*l)>H)return!1}return!0}(0,n._)([(0,l.MZ)()],V.prototype,"context",void 0),(0,n._)([(0,l.MZ)()],V.prototype,"stagedVertex",void 0),(0,n._)([(0,l.MZ)()],V.prototype,"visible",void 0),(0,n._)([(0,l.MZ)()],V.prototype,"edgeDistance",void 0),(0,n._)([(0,l.MZ)()],V.prototype,"updating",null),(0,n._)([(0,l.MZ)()],V.prototype,"_messagesUnits",void 0),(0,n._)([(0,l.MZ)()],V.prototype,"_edgeDistancePixels",null),(0,n._)([(0,l.MZ)()],V.prototype,"_colors",null),V=(0,n._)([(0,h.$)("esri.views.interactive")],V);const H=(0,y.kU)(5),j=(0,x.vt)(),F=(0,x.vt)(),k=(0,g.gs)(),U=(0,g.gs)();var B=i(5073);let q=class extends V{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:i},n,a=(0,g.gs)()){const{spatialReference:s}=i.data.coordinateHelper;return(0,B.XG)(n,s,t,e,W),e.state.camera.projectToScreen(W,a),a}};q=(0,n._)([(0,h.$)("esri.views.3d.interactive.SegmentLabels3D")],q);const W=(0,p.vt)();var X=i(42722),Y=i(74772),$=i(53357),Q=i(45876),J=i(74224),K=i(94669),ee=i(63918),te=i(23377),ie=i(161),ne=i(80561),ae=i(34402);class se{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=ie.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new re({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new re({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){null!=this._resources?.drapeSourceRenderer&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,ne.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){null!=this._resources?.drapeSourceRenderer&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,ne.q.UPDATE),this._resources.geometriesAdded=!0))}}let re=class extends((0,te.sA)(f.A)){constructor(e){super(e),this.drapeSourceType=ie.Om.Features,this.updatePolicy=ae.q.SYNC,this.renderGroup=ie.O7.Outline}};(0,n._)([(0,l.MZ)({constructOnly:!0})],re.prototype,"view",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],re.prototype,"drapeSourceType",void 0),(0,n._)([(0,l.MZ)()],re.prototype,"renderGroup",void 0),re=(0,n._)([(0,h.$)("DrapedVisualElementLayerView")],re);class oe{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,o.wB)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var le=i(61723),ce=i(54909),he=i(5415);class de{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==le.X.Mesh&&t.type!==le.X.Line&&t.type!==le.X.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const n=new he.x(i,{pickable:!1,updatePolicy:ae.q.SYNC}),a=new ce.B({castShadow:!1}),s=e.createResources(a,n);s.forEach((e=>{i.add(e),e.type===le.X.Texture&&e.load(i.renderView.renderingContext)})),i.add(a),n.add(a);const r=e.cameraChanged,l=r?(0,o.wB)((()=>t.state.camera),(e=>r(e)),o.Vh):null;this._resources={layer:n,object:a,external:s,cameraHandle:l},this._syncVisible()}_destroyResources(){if(null==this._resources)return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((t=>{e.remove(t),t.type===le.X.Texture&&t.unload()}))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class pe extends oe{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new de(this.createObject3DResourceFactory(e.view)),this.drapedResources=new se(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var ue=i(84456),_e=i(75644),ge=i(29386),me=i(7724),fe=i(5801),ve=i(33763),ye=i(21979),be=i(19362),Me=i(24441),we=i(6578),Se=i(68716),xe=i(15651);class Oe extends be.w{initializeProgram(e){return new Me.B(e.rctx,Oe.shader.get().build(this.configuration),Ee)}initializePipeline(){return(0,xe.Ey)({blending:(0,xe.ox)(Se.dn.ONE,Se.dn.ONE_MINUS_SRC_ALPHA),colorWrite:xe.wE})}}Oe.shader=new ye.$(we.L,(()=>i.e(4114).then(i.bind(i,24114))));const Ee=new Map([[ve.r.START,0],[ve.r.END,1],[ve.r.UP,2],[ve.r.EXTRUDE,3]]);var Ae=i(89325);class Te{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,p.vt)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,_e.jh)(3*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1],t[i++]=n[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,d.s)(this._origin,e[t],e[t+1],e[t+2])}else(0,d.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(Se.WR.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new fe.Z(e,Ee,{data:(0,ge.U)(De)},{data:Ae.g.createVertex(e,Se._U.STATIC_DRAW,i)})}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.data?.setData(i),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=De.createBuffer(t),n=this._origin;let a=0,s=0;for(const t of e){for(let e=0;e<t.length;e+=3){const r=(0,d.s)(Pe,t[e],t[e+1],t[e+2]);0===e?s=this._renderCoordsHelper.getAltitude(r):this._renderCoordsHelper.setAltitude(r,s);const o=this._renderCoordsHelper.worldUpAtPosition(r,Re),l=a+2*e,c=(0,d.f)(Pe,r,n);if(e<t.length-3){i.up.setVec(l,o),i.up.setVec(l+3,o),i.up.setVec(l+5,o);for(let e=0;e<6;e++)i.start.setVec(l+e,c);i.extrude.setValues(l,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,o),i.up.setVec(l-4,o),i.up.setVec(l-5,o);for(let e=-6;e<0;e++)i.end.setVec(l+e,c)}}a+=this._numberOfRenderVertices(t)}return i.buffer}}const Re=(0,p.vt)(),Pe=(0,p.vt)(),De=(0,me.BP)().vec3f(ve.r.START).vec3f(ve.r.END).vec3f(ve.r.UP).vec2f(ve.r.EXTRUDE);var Ce=i(45845),Ie=i(15449),Le=i(73395),Ge=i(51662);class ze extends Ge.K{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,n._)([(0,Ge.W)()],ze.prototype,"contrastControlEnabled",void 0);var Ve=i(41014),Ne=i(74242),Ze=i(75232);class He extends Ve.Y{constructor(){super(...arguments),this.innerColor=(0,p.fA)(1,1,1),this.innerWidth=1,this.glowColor=(0,p.fA)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,y.kU)(6),this.pointDistanceOrigin=(0,p.vt)(),this.pointDistanceTarget=(0,p.vt)(),this.lineVerticalPlaneSegment=(0,K.vt)(),this.intersectsLineSegment=(0,K.vt)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,p.vt)(),this.lineStartWorld=(0,p.vt)(),this.lineEndWorld=(0,p.vt)()}}class je extends be.w{initializeProgram(e){return new Me.B(e.rctx,je.shader.get().build(this.configuration),Ne.D)}initializePipeline(){return(0,xe.Ey)({blending:(0,xe.ox)(Se.dn.ONE,Se.dn.ONE_MINUS_SRC_ALPHA),colorWrite:xe.wE})}}je.shader=new ye.$(Ze.L,(()=>i.e(2624).then(i.bind(i,82624))));class Fe extends ze{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,n._)([(0,Ge.W)()],Fe.prototype,"heightManifoldEnabled",void 0),(0,n._)([(0,Ge.W)()],Fe.prototype,"pointDistanceEnabled",void 0),(0,n._)([(0,Ge.W)()],Fe.prototype,"lineVerticalPlaneEnabled",void 0),(0,n._)([(0,Ge.W)()],Fe.prototype,"intersectsLineEnabled",void 0),(0,n._)([(0,Ge.W)()],Fe.prototype,"spherical",void 0);let ke=class extends Ce.Ot{constructor(e){super(e),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=ue.RT.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new He,this.produces=new Map([[Ie.N.LASERLINES,()=>!this.contrastControlEnabled],[Ie.N.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return Ce.B7}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,d.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,d.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,d.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,K.C)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,K.C)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Te(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new Te(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,Le.MB)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e,this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new Fe;const t=new ze;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(Oe,t)}uninitializeRenderContext(){this._technique=(0,r.Gz)(this._technique),this._pathVerticalPlaneData=(0,r.WD)(this._pathVerticalPlaneData),this._pathTechnique=(0,r.Gz)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===ue.RT.Global,this._technique=this._techniqueRepository.releaseAndAcquire(je,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,e.bindParameters,this._passParameters),i.screen.draw()}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,e.bindParameters,{...this._passParameters,origin:this._pathVerticalPlaneData.origin}),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,Q.$e)((0,ee.LV)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),Ue),Ue.c0=-Number.MAX_VALUE,!(0,J.ig)(t.frustum,Ue))return;(0,Q.j1)(Ue,this._passParameters.lineStartWorld),(0,Q.mO)(Ue,this._passParameters.lineEndWorld)}else(0,d.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,d.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};(0,n._)([(0,l.MZ)({constructOnly:!0})],ke.prototype,"contrastControlEnabled",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],ke.prototype,"_isDecoration",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],ke.prototype,"renderCoordsHelper",void 0),ke=(0,n._)([(0,h.$)("esri.views.3d.support.LaserLineRenderer")],ke);const Ue=(0,Q.vt)();class Be extends oe{constructor(e){super(e),this._angleCutoff=Ze.d,this._style={},this._heightManifoldTarget=(0,p.vt)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,K.vt)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,d.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,qe);this.intersectsLine=(0,K.fA)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,K.C)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,K.C)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,p.o8)(e.origin),target:e.target?(0,p.o8)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new ke({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const qe=(0,p.vt)();var We=i(62187),Xe=i(74316),Ye=i(31272),$e=i(35537),Qe=i(16596);class Je extends pe{constructor(e){super(e),this._ray=(0,ee.vt)(),this._isWorldDown=!1,this._start=(0,p.vt)(),this._end=(0,p.fA)(1,0,0),this._width=1,this._color=(0,$.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,$.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=nt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ye.m$.OccludeAndTransparent,this._fadedExtensions=rt,this._laserline=new Be({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,d.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,d.f)(this._end,e,this._end),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,d.j)(this._start,e)||((0,d.c)(this._start,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,d.j)(this._end,e)||((0,d.c)(this._end,e),(0,ee.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,Y.a)(e,this._innerColor)||((0,Y.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,Y.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,$.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ye.m$.OccludeAndTransparentStencil?Ye.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??rt,this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new Qe.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const n=this._createGeometry(e);i.push(n),t.addGeometry(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Qe.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new $e.$(t)}_createGeometry(e){const t=this.extensionType===nt.FADED,i=t?[(0,p.vt)(),(0,p.vt)(),(0,p.vt)(),(0,p.vt)()]:[(0,p.vt)(),(0,p.vt)()];return(0,Xe.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===nt.FADED?this._updateLineSegmentFinite(it):this._updateLineSegmentInfinite(this._extensionType,it)}_updateLineSegmentFinite(e){return(0,K.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,Q.$e)(this._ray,Ke),e){case nt.LINE:Ke.c0=-Number.MAX_VALUE;break;case nt.RAY:case nt.GROUND_RAY:{const e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,d.F)(Ke.ray.direction,Ke.ray.direction),this._extensionType===nt.GROUND_RAY&&null!=t&&(Ke.c1=Math.abs(i-t));break}}if(!(0,J.ig)(i.frustum,Ke))return this._updateLineSegmentFinite(t);const n=(0,Q.j1)(Ke,et),a=(0,Q.mO)(Ke,tt);return(0,K.Cr)(n,a,t)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(ve.r.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],ve.r.POSITION)}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(ve.r.POSITION)?.data;if(!i)return;let n=0;for(const e of this._lineVertices(t))i[n++]=e[0],i[n++]=e[1],i[n++]=We.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===nt.FADED?(yield(0,K.sd)(e,-this.fadedExtensions.start,et),yield(0,K.sd)(e,0,et),yield(0,K.sd)(e,1,et),yield(0,K.sd)(e,1+this.fadedExtensions.end,et)):(yield(0,K.sd)(e,0,et),yield(0,K.sd)(e,1,et))}}const Ke=(0,Q.vt)(),et=(0,p.vt)(),tt=(0,p.vt)(),it=(0,K.vt)();var nt,at;(at=nt||(nt={}))[at.LINE=0]="LINE",at[at.RAY=1]="RAY",at[at.GROUND_RAY=2]="GROUND_RAY",at[at.FADED=3]="FADED";const st=1/3,rt={start:st,end:st};var ot=i(82320);class lt extends pe{constructor(e){super(e),this._location=(0,p.vt)(),this._direction=(0,p.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,$.fA)(1,0,1,1),this._renderOccluded=Ye.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,d.j)(this._location,e)||((0,d.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,d.j)(this._direction,e)||((0,d.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,d.n)(this._direction,(0,d.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new Qe.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[n,a]=this._createGeometries(e);t.addGeometry(n),t.addGeometry(a),i.push(n),i.push(a),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new Qe.W(this.materialParameters),t=(0,o.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new $e.$(e)))}_createGeometries(e){return[(0,Xe.Z8)(e,[(0,p.vt)(),(0,p.vt)()]),(0,Xe.Z8)(e,[(0,p.vt)(),(0,p.vt)()])]}_updateMaterial(){const{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,ut),(0,d.g)(ct,this.location,this.direction),t.projectToScreen(ct,_t),(0,S.S8)(_t,(0,S.Re)(_t,_t,ut)),this._updateVertexAttributesObject3D(t,e,0,ut,_t,1),this._updateVertexAttributesObject3D(t,e,1,ut,_t,-1)}_updateVertexAttributesObject3D(e,t,i,n,a,s){const r=t.geometries[i],o=r.getMutableAttribute(ve.r.POSITION)?.data;if(!o)return;const{start:l,end:c}=this._computeStartEnd(a,n,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,g.PR)(l),ct),o[0]=ct[0],o[1]=ct[1],o[2]=ct[2],e.unprojectFromScreen((0,g.PR)(c),ct),o[3]=ct[0],o[4]=ct[1],o[5]=ct[2],t.geometryVertexAttributeUpdated(r,ve.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:n,width:a,length:s,offset:r}=this,o=gt;o.spatialReference=t.renderer.spatialReference,o.x=n[0],o.y=n[1];const l=this.view.overlayPixelSizeInMapUnits(o)*i,c=a*l,h=s*l,d=r*l;this._updateVertexAttributesDraped(e[0],c,h,d,-1),this._updateVertexAttributesDraped(e[1],c,h,d,1)}_updateVertexAttributesDraped(e,t,i,n,a){const s=e.getMutableAttribute(ve.r.POSITION)?.data;if(!s)return;const{location:r,direction:o}=this,{start:l,end:c}=this._computeStartEnd(o,r,a,n,t,i);s[0]=l[0],s[1]=l[1],s[2]=We.bi,s[3]=c[0],s[4]=c[1],s[5]=We.bi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,n,a,s){const r=(0,S.hs)(ht,(0,S.hZ)(ht,e[1]*i,e[0]*-i),n+a/2),o=(0,S.WQ)(dt,(0,S.WQ)(dt,(0,S.WQ)(dt,t,(0,S.hs)(dt,e,s/2)),r),r);return{start:o,end:(0,S.WQ)(pt,o,(0,S.hs)(pt,e,-s))}}}const ct=(0,p.vt)(),ht=(0,x.vt)(),dt=(0,x.vt)(),pt=(0,x.vt)(),ut=(0,g.gs)(),_t=(0,g.gs)(),gt=(0,ot.T)(0,0,void 0,null);var mt=i(76982),ft=i(46373),vt=i(25336),yt=i(26110);class bt extends oe{constructor(e){super(e),this._resources=null,this._transform=(0,yt.vt)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,vt.C)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new he.x(e,{pickable:!1,updatePolicy:ae.q.SYNC}),i=new ce.B({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}var Mt=i(5822),wt=i(93129),St=i(11519),xt=i(88417);class Ot extends bt{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,mt.fA)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,mt.fA)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.a)(e,this._outlineColor)||((0,Y.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(ve.r.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,e.geometryVertexAttributeUpdated(e.geometries[0],ve.r.SIZE)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,St.ny)(this._primitive),distanceFieldBoundingBox:At,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/Et}createExternalResources(){this._texture=(0,St.sZ)(this._primitive,this._preferredTextureSize),this._material=new xt.R(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,y.qE)(2*this._geometrySize,16,128)}calculateMapBounds(e){const t=this.object?.geometries[0];if(!t)return!1;const i=t.attributes.get(ve.r.POSITION).data;return(0,X.F)(i,this.view.renderCoordsHelper.spatialReference,Tt,this.view.spatialReference),(0,ft.Hq)(e,Tt),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:n}=this.view,a=(0,Mt.nG)(e,n,wt.F.fromElevationInfo(this.elevationInfo),i),s=(0,d.s)(E.rq.get(),e.x,e.y,a),r=E.rq.get();(0,X.F)(s,e.spatialReference,r,i.spatialReference);const o=this._geometrySize;return(0,Xe.DJ)(t,null,r,null,[o,o],[0,0,0,1])}}const Et=St.CN,At=[Et/2,Et/2,1-Et/2,1-Et/2],Tt=(0,p.vt)();var Rt=i(10941),Pt=i(40753),Dt=i(29239);class Ct extends pe{constructor(e){super(e),this._maxSize=0,this._position=(0,p.vt)(),this._up=(0,p.vt)(),this._right=(0,p.vt)(),this._renderOccluded=Ye.m$.OccludeAndTransparent,this._color=(0,mt.fA)(1,0,0,1),this._outlineColor=(0,mt.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Ye.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,Y.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,d.q)(t,e),(0,d.q)(t,i))/3,(0,d.n)(this._up,(0,d.f)(this._up,e,t)),(0,d.n)(this._right,(0,d.f)(this._right,i,t)),(0,d.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new Dt.v(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new Qe.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,d.j)(this._up,p.uY)&&(0,d.j)(this._right,p.uY))return;const n=this._createGeometries(t,i);for(const t of n)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new Dt.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new Qe.W(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new $e.$(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,o.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:i,right:n,corner:a}=this._getVertices(),s=this._quadGeometryData(i,n,a,e);return t?[s,(0,Xe.Z8)(t,[i,a,n])]:[s]}_getVertices(){let e=this._up,t=this._right;const i=(0,d.g)(E.rq.get(),e,t);return this.isDraped&&(e=(0,d.c)(E.rq.get(),e),t=(0,d.c)(E.rq.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,vt.kN)(It,this._position),(0,vt.hs)(It,It,[n,n,n]),e.transformation=It}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:n,_size:a}=this,s=(0,d.c)(E.rq.get(),n);s[2]=We.bi;const r=Lt;r.spatialReference=t.renderer.spatialReference,r.x=s[0],r.y=s[1];const o=a*(this.view.overlayPixelSizeInMapUnits(r)*i),l=Math.min(this._maxSize,o);(0,vt.kN)(It,s),(0,vt.hs)(It,It,[l,l,1]);for(const t of e)t.transformation=It}_quadGeometryData(e,t,i,n){return new Pt.V(n,[[ve.r.POSITION,new Rt.n([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const It=(0,yt.vt)(),Lt=(0,ot.T)(0,0,void 0,null);var Gt=i(93617),zt=i(51879),Vt=i(49982),Nt=i(53981),Zt=i(36598),Ht=i(56142);class jt extends Zt.b{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof Ht.c?t.length:0)-(e instanceof Ht.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t,a=Ft(t);return(0,s.DQ)(new Ot({view:n,primitive:"circle",geometry:(0,Gt.io)(e.intersectionPoint,i),elevationInfo:e.isDraped?u.Tq:u.qt,size:20,outlineSize:2,color:a.intersectionPointColor,outlineColor:a.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,a=Ft(t),r=kt(e.point,e.domain,t);return(0,s.DQ)(new Ot({view:i,primitive:"circle",geometry:(0,Gt.io)(r,n),elevationInfo:Ut(e,t),size:20,outlineSize:2,color:a.pointColor,outlineColor:a.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:n}=t,a=Ft(t),r=kt(e.lineStart,e.domain,t),o=kt(e.lineEnd,e.domain,t);return(0,s.DQ)(this._createLineSegmentHint(e.type,r,o,n,Ut(e,t),i,a,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,a=Ft(t),{isDraped:r}=e,o=Ut(e,t),l=kt(e.lineStart,e.domain,t),c=kt(e.lineEnd,e.domain,t),h=qt(l,n,o,i,r),p=qt(c,n,o,i,r),u=(0,d.m)(p,h,p,.5),_=new lt({view:i,attached:!1,offset:zt.N.parallelLineHintOffset,length:zt.N.parallelLineHintLength,width:zt.N.parallelLineHintWidth,color:a.parallelSignColor,location:u,renderOccluded:r?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,isDraped:r,renderGroup:ie.O7.SnappingHint,isDecoration:!0});return _.setDirectionFromPoints(h,u),_.attached=!0,(0,s.DQ)(_)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,a=Ft(t),r=Ut(e,t),{isDraped:o}=e,l=kt(e.previousVertex,e.domain,t),c=kt(e.centerVertex,e.domain,t),h=kt(e.nextVertex,e.domain,t),d=qt(l,n,r,i,o),p=qt(c,n,r,i,o),u=qt(h,n,r,i,o);return(0,s.DQ)(new Ct({view:i,attached:!0,color:o?a.rightAngleColorDraped:a.rightAngleColor,renderOccluded:o?Ye.m$.OccludeAndTransparent:Ye.m$.Transparent,outlineRenderOccluded:o?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,outlineColor:a.rightAngleOutlineColor,outlineSize:zt.N.rightAngleHintOutlineSize,size:zt.N.rightAngleHintSize,isDraped:o,geometry:{previous:d,center:p,next:u},renderGroup:ie.O7.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,n,a,s,r,o=!1,l=!0,c=!0){const h=qt(t,n,a,s,o),d=qt(i,n,a,s,o),p=new Je({view:s,extensionType:nt.FADED,start:h,end:d,isDraped:o,color:r.lineColor,renderOccluded:o?Ye.m$.OccludeAndTransparent:Ye.m$.Opaque,renderGroup:ie.O7.SnappingHint,isDecoration:!0});switch(e){case Nt.H3.TARGET:p.width=zt.N.lineHintWidthTarget,p.fadedExtensions={start:0,end:zt.N.lineHintFadedExtensions};break;case Nt.H3.REFERENCE_EXTENSION:p.width=zt.N.lineHintWidthReference,p.fadedExtensions={start:0,end:0};break;case Nt.H3.REFERENCE:p.width=zt.N.lineHintWidthReference,p.fadedExtensions={start:l?zt.N.lineHintFadedExtensions:0,end:c?zt.N.lineHintFadedExtensions:0}}return p.attached=!0,p}}function Ft(e){const{effectiveTheme:t}=e.view,i=m.A.toUnitRGBA(t.accentColor),n=[0,0,0,0];return{intersectionPointColor:n,intersectionPointOutlineColor:i,pointColor:n,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:m.A.toUnitRGBA((0,a._L)(t.accentColor,.5)),rightAngleOutlineColor:i}}function kt(e,t,i){const n=Bt(t,i);return null==n?e:(0,Gt.vt)(e[0],e[1],n)}function Ut(e,t){return null!=Bt(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?u.Tq:u.qt}function Bt(e,{selfSnappingZ:t}){return e===Vt.n.SELF&&null!=t?t.value:null}function qt(e,t,i,n,a){const s=(0,p.vt)();if(a){const i=n.basemapTerrain.overlayManager.renderer.spatialReference;(0,X.F)(e,t,s,i)}else(0,B.XG)(e,t,i,n,s);return s}var Wt=i(28364),Xt=i(67488),Yt=i(91413);function $t(e,t){const{graphic:i}=e;return[(0,o.wB)((()=>e.displaying),(e=>{e?function(e,t){const{geometry:i}=e;Jt(i,t)&&e.notifyMeshTransformChanged({action:Yt.$.EnableFastUpdates})}(i,t):Qt(i,t)}),{...o.pc}),(0,s.hA)((()=>Qt(i,t)))]}function Qt(e,t){const{geometry:i}=e;Jt(i,t)&&e.notifyMeshTransformChanged({action:Yt.$.DisableFastUpdates})}function Jt(e,{state:{viewingMode:t},spatialReference:i}){if("mesh"!==e?.type)return!1;const{vertexSpace:n,spatialReference:a}=e;if(!(0,Wt.Hq)(n))return!1;const{type:s}=n;return t===ue.RT.Global&&"local"===s||t===ue.RT.Local&&(0,Xt.aI)(i,a)&&"georeferenced"===s&&!a.isGeographic}var Kt=i(51310);const ei=.3;function ti(e,t){t&&Object.assign(e,t)}class ii{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=Ye.m$.Opaque,this.color=e.accent}}class ni{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=Ye.m$.Opaque,this.hoverOutlineColor=e.selectedOutline,ti(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:(0,a.QP)(e),renderOccluded:this.renderOccluded})}}class ai{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=Ye.m$.Transparent,this.minSquaredEdgeLength=900,this.color=(0,a._L)(e.accent,.5),this.hoverColor=e.accent,ti(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:(0,a.QP)(e),renderOccluded:this.renderOccluded})}}class si{constructor(e){this.vertex=new ni({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new ni({colors:e,color:(0,a.Vl)((0,a._L)(e.accent,2/3),.5),outlineColor:(0,a._L)(e.outline,.5),size:8,collisionPadding:8}),this.selected=new ni({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new ai({colors:e})}}class ri{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=(0,Kt.wk)(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=Ye.m$.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,ti(this,t)}apply(e){e.color=(0,a.QP)(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=(0,a.QP)(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=(0,a.QP)(this.innerColor),e.renderOccluded=this.renderOccluded}}class oi{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,ti(this,t)}apply(e){e.color=(0,a.QP)(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=(0,a.QP)(this.outlineColor),e.primitive=this.shape}}class li{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ei,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,ti(this,t)}apply(e,t=1){const i={glowColor:m.A.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:m.A.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class ci{constructor(e){this.outline=new ri({colors:e,color:e.stippleOff,renderOccluded:Ye.m$.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new ri({colors:e,color:e.stippleOn,renderOccluded:Ye.m$.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new li({colors:e,globalAlpha:ei,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class hi{constructor(e){this.outline=new oi({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new li({colors:e,globalAlpha:ei,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class di extends ri{constructor({colors:e,...t}){super({colors:e}),this.extensionType=nt.GROUND_RAY,ti(this,t)}}class pi{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineGraphics=new ci(e),this.pointGraphics=new hi(e),this.heightPlane=new li({colors:e,globalAlpha:ei,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new li({colors:e,globalAlpha:ei,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new di({colors:e,color:(0,a._L)(e.accent,.5),falloff:2,innerColor:(0,a._L)(e.selected,0),renderOccluded:Ye.m$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:nt.GROUND_RAY})}}let ui=class extends f.A{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:(0,a.bJ)(e),selected:m.A.fromArray([255,255,255,t]),selectedOutline:m.A.fromArray([255,255,255,t]),staged:m.A.fromArray([12,207,255,t]),stagedSolid:m.A.fromArray([12,207,255,1]),outline:m.A.fromArray([0,0,0,.5*t]),stippleOn:m.A.fromArray([255,255,255,1]),stippleOff:m.A.fromArray([0,0,0,.5])}}get visualElements(){return new pi(this.colors)}get manipulators(){return new si(this.colors)}get zManipulator(){return new ii(this.colors)}};(0,n._)([(0,l.MZ)()],ui.prototype,"colors",null),(0,n._)([(0,l.MZ)()],ui.prototype,"visualElements",null),(0,n._)([(0,l.MZ)()],ui.prototype,"manipulators",null),(0,n._)([(0,l.MZ)()],ui.prototype,"zManipulator",null),(0,n._)([(0,l.MZ)()],ui.prototype,"getTheme",void 0),ui=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.settings.Settings")],ui);var _i=i(57888),gi=i(88133),mi=i(41410),fi=i(86652);class vi extends pe{constructor(e){super(e),this._attachmentOrigin=(0,ot.T)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new _i.A,this._geometry=null,this._width=1,this._color=(0,$.fA)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,$.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ye.m$.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Be({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,Y.a)(e,this._innerColor)||((0,Y.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,Y.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,$.o8)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=this.object3dResources.resources?.geometries;if(!e||0===e.length)return null;(0,d.s)(bi,0,0,0);let t=0;for(const i of e)i.computeAttachmentOrigin(yi)&&((0,d.g)(bi,bi,yi),t++);return 0===t?null:((0,d.h)(bi,bi,1/t),this.view.renderCoordsHelper.fromRenderCoords(bi,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return null!=this.geometry&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ye.m$.OccludeAndTransparentStencil?Ye.m$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){this._createRenderGeometries(t,i);for(const t of i)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[]}_createObject3DResources(e){const t=new Qe.W(this._materialParameters),i=new Array;return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new Qe.W(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:i}=this,n=i.basemapTerrain.spatialReference;return null==t||null==n?[]:(0,fi.A)(t,n).lines.map((({position:t})=>{const a={overlayInfo:{spatialReference:n,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new $e.$((0,mi.t)(e,a))}))}calculateMapBounds(e){if(null==this.object3dResources.resources)return!1;const t=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const n=i.attributes.get(ve.r.POSITION),a=(0,_e.jh)(n.data.length);(0,gi.projectBuffer)(n.data,t.spatialReference,0,a,this.view.spatialReference,0,n.data.length/3),(0,ft.Hq)(e,a)}return!0}_createRenderGeometries(e,t){const i=this.geometry;if(null==i)return;const n=(0,fi.C)(i,this.view.elevationProvider,this.view.renderCoordsHelper,wt.F.fromElevationInfo(this.elevationInfo??new _.A({mode:(0,u.w7)(i,null)}))),a=new Array;for(const{position:i,mapPositions:s}of n.lines){const n={mapPositions:s,attributeData:{position:i},removeDuplicateStartEnd:this._isClosed};t.push((0,mi.t)(e,n)),a.push(i)}this._laserline.pathVerticalPlane=a}}const yi=(0,p.vt)(),bi=(0,p.vt)();var Mi=i(10875),wi=i(40041),Si=i(77788),xi=i(76687),Oi=i(26421),Ei=i(29290),Ai=i(8445),Ti=i(7782),Ri=i(18693),Pi=i(32349);class Di extends be.w{initializeProgram(e){return new Me.B(e.rctx,Di.shader.get().build(this.configuration),Ii)}_setPipelineState(e){const t=this.configuration,i=e===Ti.y.NONE,n=e===Ti.y.FrontFace;return(0,xe.Ey)({blending:t.output!==Si.V.Color&&t.output!==Si.V.Alpha||!t.transparent?null:i?Ai.V0:(0,Ai.ez)(e),culling:(0,xe.Xt)(t.cullFace),depthTest:{func:n?Se.MT.LESS:t.shadingEnabled?Se.MT.LEQUAL:Se.MT.LESS},depthWrite:i?t.writeDepth?xe.kn:null:(0,Ai.XO)(e),colorWrite:xe.wE,polygonOffset:i||n?null:Ai.SE})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Di.shader=new ye.$(Pi.S,(()=>i.e(237).then(i.bind(i,30237))));class Ci extends Ri.E{constructor(){super(...arguments),this.output=Si.V.Color,this.cullFace=Mi.s2.None,this.transparencyPassType=Ti.y.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,n._)([(0,Ge.W)({count:Si.V.COUNT})],Ci.prototype,"output",void 0),(0,n._)([(0,Ge.W)({count:Mi.s2.COUNT})],Ci.prototype,"cullFace",void 0),(0,n._)([(0,Ge.W)({count:Ti.y.COUNT})],Ci.prototype,"transparencyPassType",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"transparent",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"writeDepth",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"screenSizeEnabled",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"shadingEnabled",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"multipassEnabled",void 0),(0,n._)([(0,Ge.W)()],Ci.prototype,"cullAboveGround",void 0),(0,n._)([(0,Ge.W)({constValue:!1})],Ci.prototype,"occlusionPass",void 0);const Ii=new Map([[ve.r.POSITION,0],[ve.r.NORMAL,1],[ve.r.OFFSET,2]]);class Li extends Ye.im{constructor(e){super(e,new zi),this.supportsEdges=!0,this.produces=new Map([[Ie.N.OPAQUE_MATERIAL,e=>e===Si.V.Highlight||(0,Si.BF)(e)&&!this._isTransparent],[Ie.N.TRANSPARENT_MATERIAL,e=>(0,Si.BF)(e)&&this._isTransparent&&this.parameters.writeDepth],[Ie.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,Si.BF)(e)&&this._isTransparent&&!this.parameters.writeDepth]]),this._configuration=new Ci,this._vertexAttributeLocations=Ii}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,n,a,s){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(ve.r.OFFSET),r={applyToVertex:(e,n,a,s)=>{const r=(0,d.s)(Ni,t.data[3*s],t.data[3*s+1],t.data[3*s+2]),o=(0,d.s)(Zi,e,n,a);return(0,d.h)(r,r,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(r)),(0,d.g)(o,o,r),[o[0],o[1],o[2]]},applyToAabb:e=>{const t=(0,ft.gX)(e,Ni);return(0,ft.hs)(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};(0,Le.Uy)(e,i,n,a,r,s)}else(0,Le.Uy)(e,i,n,a,void 0,s)}createGLMaterial(e){return new Gi(e)}createBufferWriter(){return new Vi(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class Gi extends xi.A{beginSlot(e){return this.ensureTechnique(Di,e)}}class zi extends Ye.qA{constructor(){super(...arguments),this.color=(0,mt.fA)(1,1,1,1),this.shadingTint=(0,mt.fA)(0,0,0,.25),this.shadingDirection=(0,d.n)((0,p.vt)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Mi.s2.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class Vi{constructor(e){this.screenSizeEnabled=e;const t=(0,me.BP)().vec3f(ve.r.POSITION).vec3f(ve.r.NORMAL);this.screenSizeEnabled&&t.vec3f(ve.r.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(ve.r.POSITION).indices.length}write(e,t,i,n,a){if((0,Ei.SA)(i,this.vertexBufferLayout,e,t,n,a),this.screenSizeEnabled){if(!i.attributes.has(ve.r.OFFSET))throw new Error(`${ve.r.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=i.attributes.get(ve.r.OFFSET);(0,Oi.vA)(3===e.size);const s=n.getField(ve.r.OFFSET,wi.xs);if(!s)throw new Error("unable to acquire view for "+ve.r.OFFSET);(0,Ei.Hk)(e,t,s,a)}}}}const Ni=(0,p.vt)(),Zi=(0,p.vt)();class Hi extends bt{constructor(e){super(e),this.view=null,this._renderOccluded=Ye.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,mt.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,mt.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,Y.a)(e,this._color)||((0,Y.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,Y.a)(e,this._outlineColor)||((0,Y.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(null==e||0===e.length)return[];const t=function(e,t,i,n,a){const s=(0,_e.jh)(3*e.length),r=(0,_e.jh)(s.length);e.forEach(((e,t)=>{s[3*t]=e[0],s[3*t+1]=e[1],s[3*t+2]=e.length>2?e[2]:0}));const o=(0,Mt.au)(s,t,0,r,0,s,0,s.length/3,i,n,a),l=null!=o;return{numVertices:e.length,position:s,mapPositions:r,projectionSuccess:l,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,wt.F.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position;for(let e=0;e<n;++e){const t=(0,d.s)(ji,a[3*e],a[3*e+1],a[3*e+2]),n=Fi(this._vertexMaterial,.5,t),s=Fi(this._vertexOutlineMaterial,.5,t);i.push({vertexGeometry:n,vertexOutlineGeometry:s})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i),e.addGeometry(n)}createExternalResources(){this._vertexMaterial=new Li({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Mi.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Li({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:Mi.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const ji=(0,p.vt)();function Fi(e,t,i){return(0,Xe.CM)(e,t,16,16,{offset:i})}let ki=class extends _i.A.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,n._)([(0,l.MZ)({constructOnly:!0})],ki.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],ki.prototype,"tracking",void 0),(0,n._)([(0,l.MZ)()],ki.prototype,"displaying",void 0),(0,n._)([(0,l.MZ)()],ki.prototype,"isDraped",void 0),ki=(0,n._)([(0,h.$)("esri.views.3d.layers.graphics.GraphicState")],ki);var Ui=i(30984),Bi=i(50889),qi=i(99517);const Wi=(0,p.vt)();let Xi=class extends Ui.Nt{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new ui({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t,unit:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new _.A({mode:e,offset:t,unit:i});const n=this.geometryToPlace;n&&this.addHandles([(0,o.wB)((()=>n.vertexSpace.origin),(()=>this.graphic?.notifyMeshTransformChanged()),o.OH),(0,o.wB)((()=>({vertexAttributes:n.vertexAttributes,alwaysUpdate:{}})),(()=>this.graphic?.notifyGeometryChanged()),o.OH)])}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:(0,u.bK)(t)}}return e}initializeGraphic(e){const{view:t}=this,i=this._createGraphicState=new ki({graphic:e});return(0,s.vE)([t.maskOccludee(e),t.trackGraphicState(i),(0,o.wB)((()=>({element:this._outlineVisualElement,isDraped:i.isDraped})),(({element:e,isDraped:t})=>{e&&(e.isDraped=t)}),o.pc),this._setupLoadingIndicator(i),...$t(i,t)])}updateDrawMeshTooltipInfo(e){const{graphic:t,sketchOptions:i,view:n}=this;e.sketchOptions=i,e.viewType=n.type,e.helpMessage=function(e,t){const i=e?.geometry;if(!e||"mesh"!==i?.type||!t)return;const{renderCoordsHelper:n,elevationProvider:a}=t,{camera:s}=t.state,{extent:r}=i,{center:o,spatialReference:l}=r,c=(0,w.GA)(l),h=(0,w.G9)(l),p=(0,w.GA)(n.spatialReference),_=r.width*c,g=r.height*h,m=(r.zmax??0)*h,f=m-(r.zmin??0)*h,v=Math.max(_,g,f)/p,{x:y,y:b}=o,M=o.z??0;(0,d.s)(Wi,y,b,M),n.toRenderCoords(Wi,l,Wi);const S=v/s.computeScreenPixelSizeAt(Wi);if(S>1*s.width)return"meshTooClose";if(S<20)return"meshTooFar";const x=(0,u.bh)(e),{absoluteZ:O}=(0,u.Q5)(y,b,m,l,t,x);return O<(a.getElevation(y,b,M,l,"ground")??0)*h+.1*f?"meshUnderground":"mesh"}(t,this.view),this.updateElevation(e.elevation)}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new Bi.O0({view:this.view,manipulators:this.manipulators,geometryType:(0,Ui.ld)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new qi.IX(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new qi.rT(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new jt,segmentLabels:t?new q:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,u.wF)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){const{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),(0,s.hA)();const i=this._settings,n=i.manipulators.vertex,l=new Hi({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=l;const c=i.visualElements.zVerticalLine,h=new Je({view:t,extensionType:c.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=h;const d=(0,s.vE)([(0,o.wB)((()=>i.visualElements.zVerticalLine),(e=>e.apply(h)),o.Vh),(0,o.wB)((()=>({selectedColor:(0,a.QP)(i.colors.selected),outlineColor:(0,a.QP)(i.manipulators.vertex.outlineColor)})),(({selectedColor:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),o.Vh),(0,s.hA)((()=>{this._activeVertexVisualElement=(0,r.pR)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,r.pR)(this._verticalLineVisualElement)}))]);return l.attached=!0,this._updateVerticalLineVisualElement(e),d}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(!t)return;const{renderCoordsHelper:i,elevationProvider:n}=this.view;(0,d.s)($i,e[0],e[1],e[2]),Yi.setFromElevationInfo(this.elevationInfo),$i[2]=(0,Mt.nG)($i,n,Yi,i),i.toRenderCoords($i,this.view.spatialReference,$i)?(t.setStartEndFromWorldDownAtLocation($i),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,s.hA)();const t=this.internalGraphicsLayer.elevationInfo,{view:i}=this,n=this._settings,a=new vi({view:i,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,u.wF)(this.hasZ,t),attached:!1,isDecoration:!0});this._outlineVisualElement=a;const l=(0,s.vE)([(0,o.wB)((()=>n.visualElements.lineGraphics.outline),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>n.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),o.Vh),(0,s.hA)((()=>{this._outlineVisualElement=(0,r.pR)(this._outlineVisualElement)}))]);return a.attached=!0,a.laserlineEnabled=!0,l}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,s.hA)();const{view:t}=this,i=this._settings,n=i.manipulators.vertex,l=new Hi({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:n.size,outlineSize:n.outlineSize,renderOccluded:n.renderOccluded,attached:!1,isDecoration:!0}),c=(0,s.vE)([(0,o.wB)((()=>({color:(0,a.QP)(i.manipulators.vertex.color),outlineColor:(0,a.QP)(i.manipulators.vertex.outlineColor)})),(({color:e,outlineColor:t})=>{l.color=e,l.outlineColor=t}),o.Vh),(0,s.hA)((()=>{this._verticesVisualElement=(0,r.pR)(this._verticesVisualElement)}))]);return l.attached=!0,this._verticesVisualElement=l,c}updateGraphicGeometry(e){if("mesh"!==this.geometryType||"point"!==e?.type)super.updateGraphicGeometry(e);else{const t=this.geometryToPlace;t?.centerAt(e);const i=this._graphic;t&&i.geometry===t||(i.geometry=t)}}_setupLoadingIndicator(e){const{drawOperation:t}=this;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;const i=(0,s.hA)((()=>{t.loading=!1}));let n;const a=()=>n&&cancelAnimationFrame(n);return(0,s.vE)([(0,o.z7)((()=>e.displaying),(()=>{a(),n=requestAnimationFrame((()=>i.remove()))}),{...o.pc,once:!0}),(0,s.hA)(a),i])}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"elevationInfo",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"geometryType",void 0),(0,n._)([(0,l.MZ)()],Xi.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Xi.prototype,"view",void 0),Xi=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Xi);const Yi=new wt.F,$i=(0,p.vt)();var Qi=i(58842),Ji=i(7743),Ki=i(68660),en=i(96124),tn=i(73682);function nn(e,t=Ye.m$.OccludeAndTransparent,i=!0){const n=(0,a.pf)(e),s=!(e[3]<1);return i?new Li({color:n,writeDepth:s,cullFace:Mi.s2.Back,renderOccluded:t,isDecoration:!0}):new Dt.v({color:n,writeDepth:s,cullFace:Mi.s2.Back,renderOccluded:t,isDecoration:!0})}function an(e,t=Ye.m$.OccludeAndTransparent){const i=(0,a.pf)(e);return new Dt.v({color:i,writeDepth:!0,cullFace:Mi.s2.Front,renderOccluded:t,isDecoration:!0})}const sn=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),rn=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function on(e,t,i,n){const a=(0,d.f)(E.rq.get(),e,i),s=ln(a,(0,d.b)(E.rq.get(),n,a),i,E.Rc.get());(0,vt.B8)(s,s);const r=(0,d.e)(E.rq.get(),t,s);return Math.atan2(r[1],r[0])}function ln(e,t,i,n){const a=(0,d.n)(E.rq.get(),e),s=(0,d.n)(E.rq.get(),t),r=(0,d.b)(E.rq.get(),a,s);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=s[0],n[5]=s[1],n[6]=s[2],n[7]=0,n[8]=r[0],n[9]=r[1],n[10]=r[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function cn(e,t){const i=e.getViewForGraphic(t);return null!=i&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function hn(e,t,i){const n=cn(e,i);null==n?function(e,t){if(null==t)return;const i="mesh"===t.type?t.anchor:(0,tn.W$)(t);null!=i&&(e.location=(0,en.wZ)(i))}(t,i.geometry):t.elevationAlignedLocation=n}var dn=i(78115);function pn(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t="polyline"===e.type?e.paths:e.rings,i=(0,dn.FD)();for(const e of t)for(let t=0;t<e.length-1;t++){const n=e[t],a=e[t+1],s=n[0]-a[0],r=n[1]-a[1];if(s*s+r*r>i)return Math.atan2(a[1]-n[1],a[0]-n[0])}return 0}var un=i(78978);function _n(e,t=(0,u.bh)(e)){return"on-the-ground"!==t.mode&&!(null==e.geometry||!e.geometry.hasZ)}var gn=i(39369),mn=(i(3313),i(95039)),fn=i(82541),vn=i(79441),yn=i(34670),bn=i(34561),Mn=i(31262),wn=i(99269),Sn=i(2532),xn=i(87368),On=i(2568);function En(e,t,i=(0,ee.vt)()){return An(e,(0,g.WA)(t),i),(0,d.n)(i.direction,i.direction),i}function An(e,t,i){return function(e,t,i){const n=(0,g.sc)((0,S.C)(E.rq.get(),t));if(n[2]=0,!e.unprojectFromRenderScreen(n,i.origin))return null;const a=(0,g.sc)((0,S.C)(E.rq.get(),t));a[2]=1;const s=e.unprojectFromRenderScreen(a,E.rq.get());return null==s?null:((0,d.f)(i.direction,s,i.origin),i)}(e,e.screenToRender(t,(0,g.sc)(E.rq.get())),i)}var Tn=i(75526),Rn=i(10715),Pn=i(8977);class Dn{constructor(e){this.metadata=void 0,this._camera=new Tn.i,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,yt.vt)(),this._worldFrame=null,this._renderLocation=(0,p.vt)(),this._renderLocationDirty=!0,this._location=new Pn.A({x:0,y:0,z:0}),this._elevationAlignedLocation=new Pn.A,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=Rn.SJ.None,this._focused=!1,this.events=new _i.A.EventEmitter,this._screenLocation={screenPointArray:(0,g.gs)(),renderScreenPointArray:(0,g.r_)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=Wn,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,s.hA)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){Cn(e)&&(this._screenLocationDirty=!0),(0,vt.C)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,yt.vt)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,vt.D_)(i),!0;case"global":{const n=(0,yn.tO)(e.renderCoordsHelper.spatialReference);(0,wn.n4)(t,0,Hn,0,n.radius),(0,Mn.y)((0,y.kU)(Hn[0]),(0,y.kU)(Hn[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,en.EL)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,en.EL)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,en.RS)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Cn(this._modelTransform)){const t=this._calculateModelTransformOffset(Bn);e=(0,d.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,g.WA)(e,In),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,S.hG)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(t,Nn),r=n*this.screenLocation.pixelSize,o=An(this._camera,i,Gn);if(null==o)return null;for(const t of e){if(0===t.length)continue;const e=(0,d.e)(Hn,t[0],s);for(let i=1;i<t.length;i++){const n=(0,d.e)(jn,t[i],s),l=(0,K.dz)((0,K.Cr)(e,n,Ln),o);if(null!=l&&l<r*r){const t=(0,d.g)(E.rq.get(),e,n);(0,d.h)(t,t,.5);const i=(0,g.rX)(E.rq.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,d.c)(e,n)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??p.uY,s=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(s,Nn),o=n*this.screenLocation.pixelSize,l=An(this._camera,i,Gn);if(null==l)return null;const c=(0,fn.z0)(zn,r),h=(0,d.t)(kn,e,c),u=(0,d.e)(Un,t,r);(0,xn.O_)(u,h,Zn);const _=Fn;if((0,xn.Ui)(Zn,l,_)&&(0,d.a)(_,u)<o*o)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,s=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(s,Nn),o=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),l=An(this._camera,i,Gn);if(null==l)return null;const c=(0,fn.z0)(zn,r),h=(0,d.t)(kn,t,c),p=this._calculateModelTransformPosition(Un);(0,xn.O_)(p,h,Zn);const u=Fn;if(!(0,xn.Ui)(Zn,l,u))break;for(const t of e){if(0===t.length)continue;const e=(0,d.e)(Hn,t[0],r);for(let i=1;i<t.length;i++){const n=(0,d.e)(jn,t[i],r),s=(0,K.kb)((0,K.Cr)(e,n,Ln),u);if(null!=s&&s<o*o){const t=(0,d.g)(E.rq.get(),e,n);(0,d.h)(t,t,.5);const i=(0,g.rX)(E.rq.get());return this._camera.projectToRenderScreen(t,i),i[2]+a}(0,d.c)(e,n)}}break}default:(0,mn.Xb)(this.collisionType)}return null}attach(e={manipulator3D:{}}){const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new he.x(t,{pickable:!1,updatePolicy:ae.q.SYNC}),i.engineLayerId=this._engineLayer.id):t?.getObject&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,bn.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new Pn.A({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;this._removeResourcesFromStage(),i&&(t.engineLayerId=null,(0,r.pR)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,bn.projectPoint)(this.location,qn,e.spatialReference)&&(0,Sn.vR)(e.extent,qn)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(null==this.elevationInfo)return;let e=null,t=0;const i=(0,u.Ze)(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":e=(0,On.R1)(this.view.elevationProvider,this.location,"ground")??0;break;case"relative-to-ground":t=((0,On.R1)(this.view.elevationProvider,this.location,"ground")??0)+i;break;case"relative-to-scene":t=((0,On.R1)(this.view.elevationProvider,this.location,"scene")??0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=Nn;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?Rn.p7.Focused:Rn.p7.Unfocused)|(this.selected?Rn.p7.Selected:Rn.p7.Unselected),a=this._noDisplayCount>0;for(const{stateMask:e,objects:s}of i){if(a){for(const e of s)e.visible=!1;continue}const i=(e&Rn.p7.All)!==Rn.p7.None,r=(e&Rn.SJ.All)!==Rn.SJ.None,o=!i||(n&e)==(e&Rn.p7.All),l=!r||(this.state&e)==(e&Rn.SJ.All);if(o&&l)for(const e of s)e.visible=!0,e.transformation=t;else for(const e of s)e.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((({geometry:{material:e}})=>{i.has(e)||(t.push(e),i.add(e))}));const n=new Map;this._renderObjects.forEach((e=>{const t=new ce.B({castShadow:!1,geometries:[e.geometry]}),i=n.get(e.stateMask)||[];i.push(t),n.set(e.stateMask,i)}));const a=[];n.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id)||0;0===n&&e.add(t),i.set(t.id,n+1)})),t.forEach((({objects:t})=>{i.addMany(t),e.addMany(t)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;t.forEach((({objects:t})=>{i.removeMany(t),e.removeMany(t)})),n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id);1===n?(e.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,Vn);return(0,d.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,d.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,vt.hZ)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,vt.lw)(t,t,this._worldFrame),(0,vt.lw)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){let e=!1;if(null!=this._engineResources)for(const t of this._engineResources.objectsByState){for(const i of t.objects)if(i.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function Cn(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const In=(0,g.gs)(),Ln=(0,K.vt)(),Gn=(0,ee.vt)(),zn=(0,vn.vt)(),Vn=(0,yt.vt)(),Nn=(0,yt.vt)(),Zn=(0,xn.vt)(),Hn=(0,p.vt)(),jn=(0,p.vt)(),Fn=(0,p.vt)(),kn=(0,p.vt)(),Un=(0,p.vt)(),Bn=(0,p.vt)(),qn=new Pn.A({x:0,y:0,z:0,spatialReference:null}),Wn=()=>{};var Xn,Yn,$n,Qn;(Qn=Xn||(Xn={}))[Qn.NONE=0]="NONE",Qn[Qn.ANY=1]="ANY",Qn[Qn.Z=2]="Z",Qn[Qn.XY=4]="XY",($n=Yn||(Yn={}))[$n.TRANSLATE_Z=0]="TRANSLATE_Z",$n[$n.TRANSLATE_XY=1]="TRANSLATE_XY",$n[$n.SCALE=2]="SCALE",$n[$n.ROTATE=3]="ROTATE",$n[$n.SCALE_ROTATE=4]="SCALE_ROTATE";class Jn{constructor(){this.grabbingState=Xn.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Xn.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===Yn.TRANSLATE_Z&&(this.zManipulator=e),e instanceof Dn&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),null==this.firstGrabbedXY&&e.grabbing&&t===Yn.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Xn.ANY,t){case Yn.TRANSLATE_Z:this.grabbingState|=Xn.Z;break;case Yn.TRANSLATE_XY:this.grabbingState|=Xn.XY}}))}}function Kn(e,t,i){const{graphic:n,view:a}=e,r=[],l=(0,u.bh)(n),c="on-the-ground"===l.mode||!l.offset&&"absolute-height"!==l.mode,h=new Jn,p=new ui({getTheme:()=>a.effectiveTheme}),_=p.visualElements,g=new Je({view:a,extensionType:_.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0}),m=(0,y.kU)(_.heightPlaneAngleCutoff),f=new Be({view:a,attached:!1,angleCutoff:m,isDecoration:!0}),v=(0,gn.v)(1);r.push((0,o.wB)((()=>({lineShadowStyle:p.visualElements.lineGraphics.shadowStyle,pointShadowStyle:p.visualElements.pointGraphics.shadowStyle,alpha:v.value})),(({lineShadowStyle:e,pointShadowStyle:i,alpha:n})=>{e.apply(t,n),i.apply(g,n)}),o.Vh));const b=(0,gn.v)(1);r.push((0,o.wB)((()=>({heightPlane:p.visualElements.heightPlane,alpha:b.value})),(({heightPlane:e,alpha:t})=>e.apply(f,t)),o.Vh));const M=()=>{if(h.update(e),!i.displaying||c&&(i.isDraped||!ea(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,g.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0;const a=h.grabbingState&Xn.XY?_.laserlineAlphaMultiplier:1;v.value=a;const s=h.grabbingState&Xn.Z?_.laserlineAlphaMultiplier:1;b.value=s,function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=i?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(g,h),function(e,t,i,n){if(n.numSelected>0){(0,d.s)(ta,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===Yn.TRANSLATE_XY&&e.selected&&e instanceof Dn&&((0,d.g)(ta,ta,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,d.h)(ta,ta,1/t),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;null!=n&&e.view.renderCoordsHelper.toRenderCoords(n,ta)?(i.heightManifoldTarget=ta,i.attached=!0):i.attached=!1}}(e,t,f,h)};r.push((0,o.wB)((()=>p.visualElements.zVerticalLine),(e=>e.apply(g)),o.Vh)),r.push(i.on("changed",M),(0,o.wB)((()=>i.displaying),M),t.events.on("attachment-origin-changed",M),(0,s.DQ)(g),(0,s.DQ)(f));const w=[],S=()=>{(0,s.a0)(w),w.length=0,e.forEachManipulator((e=>w.push(e.events.on("grab-changed",M)))),e.forEachManipulator((e=>w.push(e.events.on("select-changed",M)))),M()};return S(),r.push(e.onManipulatorsChanged(S),(0,s.a2)((()=>(0,s.vE)(w)))),(0,s.vE)(r)}function ea(e){return null!=e.geometry&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ta=(0,p.vt)();var ia=i(64159);function na(e){const{view:t,graphic:i}=e,n=new ki({graphic:i}),a=[],r=function(e,t,i){const{view:n,graphic:a}=e,r=new Ot({view:n,geometry:aa(a),elevationInfo:(0,u.bh)(a),isDecoration:!0});return function(e,t,i,n){const a=new ui({getTheme:()=>e.view.effectiveTheme});(function(e,t,i,n){const{view:a,graphic:r}=e;let o=null;const l=()=>{const e=aa(r);(e=>{null!=o&&(o.remove(),o=null),i.isDraped&&null!=e&&(o=function(e,t,i){const n=e.elevationProvider.spatialReference;(0,ia.g)(t,sa,n);const a=sa[0],s=sa[1];return e.elevationProvider.on("elevation-change",(e=>{(0,Sn.Rj)(e.extent,a,s)&&i()}))}(a,e,(()=>{t.geometry=e})))})(e),t.geometry=e};n.push(i.on("changed",l),(0,s.a2)((()=>o))),l()})(e,t,i,n),a.visualElements.pointGraphics.outline.apply(t),n.push((0,o.wB)((()=>i.displaying),(()=>{t.attached=i.displaying}),o.Vh))}(e,r,t,i),i.push((0,s.DQ)(r)),r}(e,n,a);return function(e,t,i,n){const{view:a,graphic:r}=e,l=new ui({getTheme:()=>a.effectiveTheme}),c=new Je({view:a,extensionType:l.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});i.push((0,o.wB)((()=>l.visualElements.zVerticalLine),(e=>e.apply(c)),o.Vh));const h=new Be({view:a,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),p=(0,y.kU)(l.visualElements.heightPlaneAngleCutoff),_=new Be({view:a,attached:!1,angleCutoff:p,isDecoration:!0}),g=(0,u.bh)(e.graphic),m=wt.F.fromElevationInfo(g),f="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,v=new Jn,b=(0,gn.v)(1);i.push((0,o.wB)((()=>({heightPlane:l.visualElements.heightPlane,alpha:b.value})),(({heightPlane:e,alpha:t})=>e.apply(_,t)),o.Vh));const M=(0,gn.v)(1);i.push((0,o.wB)((()=>({shadowStyle:l.visualElements.pointGraphics.shadowStyle,alpha:M.value})),(({shadowStyle:e,alpha:t})=>e.apply(h,t)),o.Vh));const w=()=>{v.update(e);const i=aa(r),s=f&&(t.isDraped||null==i||!i.hasZ);let o=!0;if(s||null==i)o=!1;else{const e=(0,Mt.nG)(i,a.elevationProvider,m,a.renderCoordsHelper);(0,d.s)(sa,i.x,i.y,e),(0,X.F)(sa,i.spatialReference,sa,a.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(sa),h.intersectsWorldUpAtLocation=sa}const p=v.grabbingState&Xn.Z?l.visualElements.laserlineAlphaMultiplier:1;b.value=p;const u=(0,ft.Ie)(ra);!s&&t.displaying&&n.calculateMapBounds(u)&&(0,X.F)((0,ft.pg)(u,sa),a.spatialReference,sa,a.renderCoordsHelper.spatialReference)?(_.heightManifoldTarget=sa,_.attached=!0):_.attached=!1;const g=v.grabbingState&Xn.XY?l.visualElements.laserlineAlphaMultiplier:1;M.value=g;const y=o&&t.displaying&&!s;h.attached=y,c.attached=y};i.push((0,o.wB)((()=>[t.displaying,t.isDraped]),w),t.on("changed",w)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",w))})),i.push((0,s.DQ)(h)),i.push((0,s.DQ)(c)),i.push((0,s.DQ)(_)),w()}(e,n,a,r),a.push(t.trackGraphicState(n)),{visualElement:r,remove:()=>(0,s.a0)(a)}}function aa(e){const t=e.geometry;return null==t?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const sa=(0,p.vt)(),ra=(0,ft.vt)();function oa(e){switch(e.graphic.geometry.type){case"point":case"mesh":return na(e);case"polygon":case"polyline":return function(e){const{view:t,graphic:i}=e,n=new ki({graphic:i}),a=function(e,t){const{view:i,graphic:n}=e,a=new vi({view:i,geometry:ea(n)?n.geometry:null,elevationInfo:(0,u.bh)(n),attached:!1,isDecoration:!0}),r=new ui({getTheme:()=>i.effectiveTheme}),l=()=>{a.attached=t.displaying},c=(0,s.vE)([(0,o.wB)((()=>r.visualElements.lineGraphics.outline),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>r.visualElements.lineGraphics.shadowStyle),(e=>e.apply(a)),o.Vh),(0,o.wB)((()=>t.displaying),l),(0,o.wB)((()=>t.isDraped),(e=>{a.isDraped=e})),t.on("changed",(()=>a.geometry=ea(n)?n.geometry:null)),(0,s.DQ)(a)]);return l(),{visualElement:a,remove:()=>c.remove()}}(e,n),r=[a,Kn(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:()=>(0,s.a0)(r)}}(e);default:return null}}const la=70,ca=Math.ceil(la/3*2),ha=5*Math.PI/12,da=1*Math.PI/3;var pa=i(56802);class ua{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Dn&&e(t,i)}))}}class _a{constructor(e,t=Rn.p7.None){this.geometry=e,this.stateMask=t}}var ga,ma=i(74695),fa=(i(57809),i(30165),i(72559),i(66019));function va(e,t){return ya(e,(()=>t))}function ya(e,t){const i=(0,p.vt)(),n=(0,p.vt)();let a=!1;return s=>{const r=t(s);if("start"===s.action){const t=(0,g.WA)(s.screenStart,(0,g.PR)(E.oG.get())),n=An(e.state.camera,t,Ea);null!=n&&(a=(0,xn.Ui)(r,n,i))}if(!a)return null;const o=(0,g.WA)(s.screenEnd,(0,g.PR)(E.oG.get())),l=An(e.state.camera,o,Ea);return null==l?null:(0,xn.Ui)(r,l,n)?{...s,renderStart:i,renderEnd:n,plane:r,ray:l}:null}}function ba(e,t,i,n=null,a=null){return function(e,t,i=0,n=null,a=null){let s=null;return r=>{if("start"===r.action&&(s=e.sceneIntersectionHelper.intersectElevationFromScreen((0,g.gs)(r.screenStart.x,r.screenStart.y),t,i,a),null!=s&&null!=n&&!(0,bn.projectPoint)(s,s,n)))return null;if(null==s)return null;const o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,g.gs)(r.screenEnd.x,r.screenEnd.y),t,i,a);return null==o||null!=n&&!(0,bn.projectPoint)(o,o,n)?null:{...r,mapStart:s,mapEnd:o}}}(e,i,(0,u.id)(t,e,i),n,a)}function Ma(e,t,i,n=null,a=null){return ba(e,i,(0,u.bh)(t),n,a)}function wa(e,t,i){let n=null;const a=new fa.rh;return a.next(va(e,function(e,t){const i=xa,n=Oa,a=(0,xn.vt)();e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,d.b)((0,xn.Qj)(a),i,(0,d.f)(n,t,e.state.camera.eye));return(0,d.b)(s,s,i),(0,xn.O_)(t,s,a)}(e,t))).next(function(e,t){const i=(0,p.vt)(),n=(0,d.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const a=(0,p.vt)(),s=(0,p.vt)(),r=a=>((0,d.f)(a,a,t),(0,ma._I)(i,a,a),"global"===e.viewingMode&&(0,d.l)(a)*Math.sign((0,d.k)(i,a))<.001-n&&(0,d.f)(a,(0,d.h)(a,i,.001),t),(0,d.g)(a,a,t),a);return e=>(e.renderStart=r((0,d.c)(a,e.renderStart)),e.renderEnd=r((0,d.c)(s,e.renderEnd)),e)}(e,t)).next(Sa(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),e=>(n=null,a.execute(e),n)}function Sa(e,t){const i=e.renderCoordsHelper;return e=>{const n=i.fromRenderCoords(e.renderStart,new Pn.A({spatialReference:t})),a=i.fromRenderCoords(e.renderEnd,new Pn.A({spatialReference:t}));return null!=n&&null!=a?{...e,mapStart:n,mapEnd:a}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(ga||(ga={}));const xa=(0,p.vt)(),Oa=(0,p.vt)(),Ea=(0,ee.vt)();function Aa(e,t,i){const n=(i,n)=>t({action:i,graphic:e,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY});return i(((t,i,a)=>(i.next((e=>("start"===e.action&&n("start",e),e))).next((0,fa.n5)(e)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&n("update",e);break;case"end":n("end",e)}return e})),{steps:i,cancel:a=a.next((0,fa.Yl)(e)).next((e=>(n("end",{screenDeltaX:0,screenDeltaY:0}),e)))})))}function Ta(e){if(null==e?.axis)return 1;const{mapStart:t,mapEnd:i,axis:n}=e,a=[i.x-t.x,i.y-t.y];return a[0]*n[0]+a[1]*n[1]>0?1:-1}class Ra extends ua{constructor(e){super(),this._handles=new pa.A,this._arrowManipulatorInfos=new Array,this._angle=0,this._scale=1,this._radius=la,this._updateAfterDrag=!1,this.events=new _i.A,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=(0,r.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,u.bh)(n),s=n.geometry.spatialReference;return Aa(n,i,(t=>this.createDragPipeline(((i,n,a,s,r)=>(({steps:n,cancel:a}=e(i,n,a,s,r)),t(i,n,a))),a,s,n)))}createDragPipeline(e,t,i,n){return(0,s.vE)(this._arrowManipulatorInfos.map((({manipulator:a},s)=>(0,fa.Xt)(a,((a,r,o,l,c)=>{const h=r.next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,fa.Tp)(this._view,a.elevationAlignedLocation)).next(ba(this._view,a.elevationAlignedLocation,t,i,n)).next((0,fa.an)(a.location,this.angle+(s+1)*Math.PI*.5)).next((0,fa.sO)());e(a,h,o,l,c)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const n=this._radius/la,a=54*n,s=a*Math.sqrt(3)/2,r=(0,Xe._B)(this._opaqueMaterial,s,a/2,a/2,.02);(0,Xe.xh)(r,(0,vt.kN)(E.Rc.get(),(0,d.s)(E.rq.get(),0,-s/3,0))),e.renderObjects=[new _a(r,Rn.p7.Focused),new _a(r.instantiate({material:this._transparentMaterial}),Rn.p7.Unfocused)],e.radius=s/3*2*1.2;const o=(0,vt.N9)(E.Rc.get(),i*Math.PI/2),l=(0,vt.kN)(E.Rc.get(),(0,d.s)(E.rq.get(),0,100*n,0));(0,vt.lw)(t,o,l)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,vt.$0)(E.Rc.get(),e,(0,p.fA)(0,0,1));if(null==t)return;const i=(0,vt.CV)(E.Rc.get(),(0,d.s)(E.rq.get(),this.displayScale,this.displayScale,this.displayScale)),n=(0,vt.lw)(E.Rc.get(),i,t);for(const e of this._arrowManipulatorInfos){const t=(0,vt.lw)(E.Rc.get(),n,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){const t=new Dn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,p.fA)(0,0,1)}}),i={manipulator:t,transform:(0,yt.vt)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(e=1){const t=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this._handles.add((0,o.wB)((()=>m.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),o.Vh)),t}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class Pa{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if(null!=i){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=e}_snap(e){const t=null!=this._view?this._view.toMap(e,{exclude:[]}):null;return null!=t&&null!=this._view&&(t.z=(0,u.id)(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;const i=new fa.rh;return this._next=i,[e=>{if(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return null!=t?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},i]}}class Da extends ua{constructor(e){super(),this._handles=new pa.A,this._snapToScene=new Pa,this._scale=1,this._radius=la,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles=(0,r.pR)(this._handles),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const n=t.graphic,a=(0,u.bh)(n),s=n.geometry.spatialReference;return Aa(n,i,(t=>this.createDragPipeline(((i,n,a,s,r)=>(({steps:n,cancel:a}=e(i,n,a,s,r)),t(i,n,a))),a,s,n)))}createDragPipeline(e,t,i,n){const a=this._view;return(0,fa.Xt)(this._manipulator,((s,r,o,l,c)=>{const h=r.next((0,fa.Tp)(a,s.elevationAlignedLocation)).next(ba(a,s.elevationAlignedLocation,t,i,n)).next(...this._snapToScene.createDragEventPipelineStep(a,t)).next((e=>({...e,manipulatorType:Yn.TRANSLATE_XY}))).next((0,fa.sO)());e(s,h,o,l,c)}))}_updateManipulatorTransform(){const e=(0,vt.CV)(E.Rc.get(),(0,d.s)(E.rq.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Dn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,p.fA)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=(0,Xe.nW)(this._discMaterial,.02,1,128,(0,p.fA)(0,0,1),(0,p.fA)(0,0,0));e.transformation=(0,vt.CV)((0,yt.vt)(),(0,p.fA)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new _a(e,Rn.p7.Focused),new _a(e.instantiate({material:this._discMaterialTransparent}),Rn.p7.Unfocused)],this._manipulator.radius=this._radius/la*80}_createMaterial(e=1){const t=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this._handles.add((0,o.wB)((()=>m.A.toUnitRGBA(this._view.effectiveTheme.accentColor)),(i=>{i[3]*=e,t.setParameters({color:i})}),o.Vh)),t}get test(){return{discManipulator:this._manipulator}}}class Ca extends ua{constructor(e){super(),this._radius=la,this.events=new _i.A,this._tool=e.tool,this._view=e.view;const t=new ui({getTheme:()=>this._view.effectiveTheme});this._settings=t,null!=e.radius&&(this._radius=e.radius);const i=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:nn(this._createDarkenedColor(i,1,.25),Ye.m$.Occlude),materialFocused:nn(this._createDarkenedColor(i,1,0),Ye.m$.Occlude),materialOccludedUnfocused:nn(this._createDarkenedColor(i,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:nn(this._createDarkenedColor(i,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=(0,o.wB)((()=>this._view.effectiveTheme.accentColor),(e=>{const t=this._createDarkenedColor(e,1,.25),i=this._createDarkenedColor(e,1,0),n=this._createDarkenedColor(e,.7,0),a=this._createDarkenedColor(e,.85,0),{materialUnfocused:s,materialFocused:r,materialOccludedUnfocused:o,materialOccludedFocused:l}=this._materials;s.setParameters({color:t}),r.setParameters({color:i}),o.setParameters({color:n}),l.setParameters({color:a})})),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._themeHandle=(0,r.xt)(this._themeHandle),this._manipulator.applyObjectTransform=za,this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const n=t.graphic.geometry.spatialReference;return Aa(t.graphic,i,(t=>this.createDragPipeline(((i,n,a,s,r)=>(({steps:n,cancel:a}=e(i,n,a,s,r)),t(i,n,a))),n)))}createDragPipeline(e,t){const i=this._view;return(0,fa.Xt)(this._manipulator,((n,a,s,r,o)=>{const l=a.next((e=>({...e,manipulatorType:Yn.TRANSLATE_Z}))).next(wa(i,n.renderLocation,t)).next((0,fa.sO)());e(n,l,s,r,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._settings,t=this._radius/la,i=e.zManipulator.height*t,n=e.zManipulator.coneHeight*t,a=e.zManipulator.coneWidth*t,s=e.zManipulator.width*t,r=[(0,p.fA)(0,0,0),(0,p.fA)(0,0,i)],o=[(0,p.fA)(0,0,0),(0,p.fA)(0,0,i+n)],l=(e=>{const t=(0,yt.vt)();return(0,vt.Tl)(t,t,[0,0,i]),(0,vt.eL)(t,t,Math.PI/2),t})(),{materialUnfocused:c,materialFocused:h,materialOccludedUnfocused:d,materialOccludedFocused:u}=this._materials,_=(0,Xe.Nb)(c,r,s/2,16,!1),g=(0,Xe.EE)(c,n,a/2,16,!1);g.transformation=l,this._manipulator.renderObjects=[new _a(g,Rn.p7.Unfocused),new _a(_,Rn.p7.Unfocused),new _a(g.instantiate({material:h}),Rn.p7.Focused),new _a(_.instantiate({material:h}),Rn.p7.Focused),new _a(g.instantiate({material:d}),Rn.p7.Unfocused),new _a(_.instantiate({material:d}),Rn.p7.Unfocused),new _a(g.instantiate({material:u}),Rn.p7.Focused),new _a(_.instantiate({material:u}),Rn.p7.Focused)],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[o]}}_createManipulator(){const e=this._view,t=new Dn({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const i=e.state.camera,n=Ia;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const a=(0,d.o)(i.eye,n),s=i.computeRenderPixelSizeAtDist(a),r=(0,d.f)(La,n,i.eye);(0,d.n)(r,r);const o=Ga;e.renderCoordsHelper.worldUpAtPosition(Ia,o);const l=Math.abs((0,d.k)(r,o)),c=(0,d.b)(La,r,o),h=(0,d.b)(La,c,o),p=(0,y.qE)(l,.01,1),u=1-Math.sqrt(1-p*p)/p/i.fullWidth,_=this._settings,g=this._radius/la,m=_.zManipulator.width*g;(0,d.h)(h,(0,d.n)(h,h),(1/u-1)*a+s*m),t[12]-=La[0],t[13]-=La[1],t[14]-=La[2]},this._manipulator=t,this._updateManipulator()}_createDarkenedColor(e,t,i){const n=(0,a.e$)(e,i);return n.a*=t,m.A.toUnitRGBA(n)}get test(){return{manipulator:this._manipulator}}}const Ia=(0,p.vt)(),La=(0,p.vt)(),Ga=(0,p.vt)(),za=()=>{};class Va extends ua{constructor(e){super(),this._handles=new pa.A,this._interactive=!0;const{tool:t,view:i,snapToScene:n,radius:a}=e;this._view=i,this.xyManipulation=new Da({tool:t,view:i,snapToScene:n,radius:a}),this.xyAxisManipulation=new Ra({tool:t,view:i,radius:a}),this.zManipulation=new Ca({tool:t,view:i,radius:a}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return(0,s.vE)([this.xyManipulation.createGraphicDragPipeline(((t,i,n,a,s)=>e(Za.XY,t,i,n,a,s)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,n,a,s)=>e(Za.XY_AXIS,t,i,n,a,s)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,n,a,s)=>e(Za.Z,t,i,n,a,s)),t,i)])}createDragPipeline(e,t,i,n){return(0,s.vE)([this.xyManipulation.createDragPipeline(((t,i,n,a,s)=>e(Za.XY,t,i,n,a,s)),t,i,n),this.xyAxisManipulation.createDragPipeline(((t,i,n,a,s)=>e(Za.XY_AXIS,t,i,n,a,s)),t,i,n),this.zManipulation.createDragPipeline(((t,i,n,a,s)=>e(Za.Z,t,i,n,a,s)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,Yn.TRANSLATE_Z)))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,c.A)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const n=()=>{const t=[];this._xyAxisVisible||e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Na),this._handles.add(t,Na)};for(const e of i)this._handles.add(e.events.on("focus-changed",n));this._view.inputManager&&this._handles.add((0,o.z7)((()=>this._view.inputManager?.latestPointerType),n)),n()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=null!=e&&"point-3d"===e.type&&e.symbolLayers;return t&&t.some((e=>"icon"===e.type))?ca:la}}const Na="disable-xy-axis-display";var Za,Ha;(Ha=Za||(Za={}))[Ha.XY=0]="XY",Ha[Ha.XY_AXIS=1]="XY_AXIS",Ha[Ha.Z=2]="Z";var ja=i(83423);class Fa extends ua{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,Yn.TRANSLATE_XY)}createGraphicDragPipeline(e){return Aa(this._graphicState.graphic,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,n=null!=i.geometry?i.geometry.spatialReference:null;return(0,fa.Xt)(this._manipulator,((a,s,r,o,l)=>{const c=s.next(function(e,t,i,n){const a=t.toMap(e.screenStart,{include:[i]});return null!=a?Ma(t,i,a,n):null}(l,t,i,n)).next((0,fa.EX)()).next((0,fa.sO)());e(a,c,r,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new ja.l({graphic:t,view:e,selectable:!0,cursor:"move"})}}var ka=i(87327),Ua=i(77671),Ba=i(60141),qa=i(3130),Wa=i(28535),Xa=i(51720),Ya=i(16761),$a=i(83853),Qa=i(68489);class Ja{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Ka{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class es{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}const ts="manipulators";let is=class extends(_i.A.EventedMixin(Ua.g)){constructor(e){super(e),this._infos=new Map,this.graphics=new Qi.A,this.enableZ=!0,this.sketchOptions=new qa.A,this.type="move-3d",this.tooltip=null,this._updatingHandles=new Ki.U,this._moveManipulation=null,this._latestTooltipInfo=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{view:e}=this;this.addHandles([this.graphics.on("change",(e=>{e.removed.forEach((e=>this.removeHandles(e))),this._updateGraphicInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()})),(0,o.wB)((()=>this.sketchOptions.tooltips.effectiveEnabled),(t=>{this.tooltip=t?new Ya.m({info:this._latestTooltipInfo,view:e}):(0,r.pR)(this.tooltip)}),o.pc)]);const t=this.graphics.toArray();this._updateGraphicInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this.finishToolCreation()}destroy(){this.tooltip=(0,r.pR)(this.tooltip),this._moveManipulation=(0,r.pR)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating}reset(){}_updateGraphicInfos({added:e,removed:t}){for(const t of e){if((0,ka.N)(t)!==un.e.SUPPORTED)continue;const e=new ns(t),i=this.view.trackGraphicState(e.state);this._infos.set(e.graphic,{info:e,handle:i})}for(const e of t)this._infos.get(e)?.handle.remove(),this._infos.delete(e)}_setupFastTransformUpdates(e){const{view:t}=this;for(const i of e){const{info:e}=this._infos.get(i);this.addHandles($t(e.state,t),i)}}_refreshManipulators(){if(this.removeHandles(ts),this._moveManipulation=(0,r.pR)(this._moveManipulation),this.manipulators.removeAll(),0===this._infos.size)return;const e=Array.from(this._infos.values(),(({info:e})=>e));this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Fa({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()})),e.events.on("grab-changed",(({action:e})=>{"start"===e?this._showTooltip(Za.XY):this._hideTooltip()}))],ts))),this.addHandles(t.manipulationXY.createDragPipeline(((t,i,n,a)=>this._buildDragEventPipeline(e,Za.XY,t,i,n,a))),ts)}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Va({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Va.radiusForSymbol(e[0].graphic.symbol):la});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.addHandles(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.at(0)}),i.stopPropagation()})),ts)}));const i=e=>t=>{this.addHandles([t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._showTooltip(e):this._hideTooltip()})),t.events.on("grab-changed",(()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=Ji.r7)}))],ts)};this._moveManipulation.xyManipulation.forEachManipulator(i(Za.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Za.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Za.Z));const n=()=>this._updateMoveManipulation(e);for(const t of e)this.addHandles([t.state.on("changed",n),(0,o.wB)((()=>t.state.displaying),n)],ts);const a=e[e.length-1];this.addHandles(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a))),ts),this.addHandles(t.createDragPipeline(((t,i,n,a,s)=>this._buildDragEventPipeline(e,t,i,n,a,s)),(0,u.bh)(a.graphic),a.graphic.geometry.spatialReference,a.graphic),ts),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const i=t.graphic,n=oa({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>(0,s.hA)()});null!=n&&(t.geometryRepresentation=n.visualElement,t.geometryRepresentation instanceof vi&&this.addHandles([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),(0,o.wB)((()=>t.state.isDraped),(()=>this._updateMoveManipulation(e)))],ts),this.addHandles(n,ts))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=pn(e.graphic.geometry))}_updateMoveManipulation(e){const t=(0,ot.T)(0,0,0,this.view.spatialReference);let i=0,n=!1;const a=this._moveManipulation;if(a){for(const a of e){if(!a.state.displaying)continue;const e=a.state.graphic;this.enableZ&&_n(e)&&(n=!0);const s=a.geometryRepresentation instanceof vi&&!a.state.isDraped?a.geometryRepresentation.attachmentOrigin:cn(this.view,e);if(null!=s){const{x:e,y:n,z:a}=s;t.x+=e,t.y+=n,a&&(t.z??=0,t.z+=a),i++}}i>0?(t.x/=i,t.y/=i,t.z??=0,t.z/=i,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=n):a.available=!1}}_buildDragEventPipeline(e,t,i,n,a,s){const r=[],o=[];let l=null,c=null;const h=()=>{for(const e of r)e.dragging=!1;r.length=0,o.length=0,l=null,c=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(1===e.length&&t===Za.XY){const t=e[0].graphic;({steps:n,cancel:a}=this._buildSnappingPipelineSteps(t,(0,u.bh)(t),n,a,s))}return a=a.next((e=>c?.(e))).next((()=>(this.emit("graphic-move-stop",new es(o)),this.destroyed||h(),null))),{steps:n=n.next((t=>{if("start"===t.action){r.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY?.hasManipulator(i)&&t.manipulationXY?.grabbing||(r.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),l=(0,fa.qh)(o),c=(0,fa.ns)(o),this.emit("graphic-move-start",new Ja(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>l?.(e))).next((e=>(this._updateMoveTooltip(t,e),e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),n=i.x-t.x,a=i.y-t.y;if(this.emit("graphic-move",new Ka(n,a,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new es(o)),this.destroyed)return null;h()}return null})),cancel:a}}_showTooltip(e){this._updateMoveTooltip(e),this._latestTooltipInfo&&(this._latestTooltipInfo.distance=Ji.r7)}_hideTooltip(){this.tooltip?.clear(),this._latestTooltipInfo=null}_updateMoveTooltip(e,t){const{sketchOptions:i,tooltip:n}=this;switch(e){case Za.XY:this._latestTooltipInfo=this._translateGraphicTooltipInfo??=new $a.ar({sketchOptions:i}),this._updateMoveTooltipDistance(this._latestTooltipInfo,t,((e,t)=>(0,G.Kt)(e,t)));break;case Za.XY_AXIS:this._latestTooltipInfo=this._translateGraphicXYTooltipInfo??=new $a.nW({sketchOptions:i}),this._updateMoveTooltipDistance(this._latestTooltipInfo,t,((e,i)=>(0,Ji.hs)((0,G.Kt)(e,i),Ta(t))));break;case Za.Z:this._latestTooltipInfo=this._translateGraphicZTooltipInfo??=new $a.YI({sketchOptions:i}),this._updateMoveTooltipDistance(this._latestTooltipInfo,t,Qa.e5)}this._latestTooltipInfo.sketchOptions=i,n&&(n.info=this._latestTooltipInfo)}_updateMoveTooltipDistance(e,t,i){if(null==t||"end"===t.action)return;const{mapStart:n,mapEnd:a}=t,s=i(n,a);e.distance=null!=s?s:Ji.r7}_buildSnappingPipelineSteps(e,t,i,n,a){const s=e.geometry;if(null==s||"point"!==s.type&&"mesh"!==s.type)return{steps:i,cancel:n};const r=("point"===s.type?s:s.anchor).clone(),o=new Wa.e({elevationInfo:t,pointer:a,editGeometryOperations:Ba.p.fromGeometry(r,this.view.state.viewingMode),visualizer:new jt,excludeFeature:e}),l=this.snappingManager,{snappingStep:c,cancelSnapping:h}=(0,Xa.L)({snappingContext:o,snappingManager:l,updatingHandles:this._updatingHandles});return n=n.next(h),{steps:i=i.next((t=>(r.z=(0,u.wS)(this.view,r,(0,u.bh)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:o.coordinateHelper.pointToVector(r)}))).next(...c),cancel:n}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],is.prototype,"view",void 0),(0,n._)([(0,l.MZ)()],is.prototype,"graphics",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],is.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:qa.A})],is.prototype,"sketchOptions",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],is.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)()],is.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],is.prototype,"updating",null),(0,n._)([(0,l.MZ)()],is.prototype,"tooltip",void 0),is=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],is);class ns{constructor(e){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ki({graphic:e})}get graphic(){return this.state.graphic}}var as=i(2252),ss=i(3223),rs=i(38648),os=i(54866),ls=i(98947);function cs(e,t,i){const n="on-the-ground"===i.mode?ls.B.XY:ls.B.XYZ;return new ls.L(e,n,t,0)}function hs(e,t,i){const n=(0,p.vt)();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;const a=ds(e,t,(0,xn.Qj)(i.plane)),s=ds(e,t,i.edgeDirection);if(null==a||null==s)return null;const r=(0,d.b)((0,p.vt)(),a,s);return(0,xn.O_)(n,r,(0,xn.vt)())}function ds(e,t,i){const n=(0,ot.T)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),a=(0,p.vt)(),s=(0,p.vt)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(n,s)?(0,d.E)(s,a,s):null}var ps=i(98596),us=i(36826),_s=i(27920);let gs=class extends _s.w{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Ji.r7,this.area=null,this.totalLength=null}};(0,n._)([(0,l.MZ)()],gs.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],gs.prototype,"distance",void 0),(0,n._)([(0,l.MZ)()],gs.prototype,"area",void 0),(0,n._)([(0,l.MZ)()],gs.prototype,"totalLength",void 0),gs=(0,n._)([(0,h.$)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],gs);var ms=i(43399),fs=i(65334),vs=i(1186),ys=i(44153);let bs=class extends(_i.A.EventedMixin(f.A)){constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new pa.A,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Es.NONE,this._updatingHandles=new Ki.U,this._recreatingManipulators=!1,this._settings=new ui({getTheme:()=>this.view.effectiveTheme}),this._latestTooltipInfo=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null,this._translateVertexTooltipInfo=null,this._translateVertexXYTooltipInfo=null,this._translateVertexZTooltipInfo=null,this._edgeOffsetTooltipInfo=null,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._settings.manipulators,n=i.vertex;this._vertexManipulatorMaterial=nn((0,a.QP)(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=an((0,a.QP)(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=an((0,a.QP)(n.hoverOutlineColor),n.renderOccluded);const s=i.edge;this._edgeManipulatorMaterial=nn((0,a.QP)(s.color),s.renderOccluded),this._edgeManipulatorOutlineMaterial=an((0,a.QP)(s.outlineColor),s.renderOccluded);const r=i.edgeOffset;this._edgeOffsetManipulatorMaterial=nn((0,a.QP)(r.color),r.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=nn((0,a.QP)(r.hoverColor),r.renderOccluded,!1);const l=i.selected;this._selectedManipulatorMaterial=nn((0,a.QP)(l.color),l.renderOccluded),this._selectedManipulatorOutlineMaterial=an((0,a.QP)(l.outlineColor),l.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=an((0,a.QP)(l.hoverOutlineColor),l.renderOccluded);const c=this._graphicState=new ki({graphic:e});this.tooltip=new Ya.m({view:t}),this.addHandles([(0,o.wB)((()=>{const e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}}),(({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:i,selectedSettings:n})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),i.applyColor(this._edgeOffsetManipulatorMaterial),i.applyHover(this._edgeOffsetManipulatorHoverMaterial),n.applyColor(this._selectedManipulatorMaterial),n.applyOutline(this._selectedManipulatorOutlineMaterial),n.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)})),(0,o.wB)((()=>c.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,o.wB)((()=>({labels:this._segmentLabels,enabled:this.sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:e,enabled:t,edgeOffsetEnabled:i})=>{null!=e&&(e.visible=t,e.edgeDistance=i?"far":"default")}),o.Vh),(0,o.wB)((()=>this.sketchOptions.tooltips.effectiveEnabled),(e=>{this.tooltip.info=e?this._latestTooltipInfo:null}),o.Vh),this.view.trackGraphicState(c)])}destroy(){this._segmentLabels=(0,r.pR)(this._segmentLabels),this.tooltip=(0,r.pR)(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}get inputGeometry(){return null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,r.pR)(this._moveManipulation),this._graphicMoveManipulation=(0,r.pR)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(null==this._editGeometryOperations)return;const t=(0,u.bh)(this.graphic);for(const i of this._editGeometryOperations.data.components){const n=e?.byComponentIndex.get(i.index);for(const e of i.vertices){const i=n?.has(e.index);this._createVertexOrEdgeManipulator(e,t,i)}for(const e of i.edges)this._createVertexOrEdgeManipulator(e,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canRedo}get canUndo(){return null!=this._editGeometryOperations&&this._editGeometryOperations.canUndo}redo(){if(null==this._editGeometryOperations)return null;const e=this._editGeometryOperations.redo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(null==this._editGeometryOperations)return null;this.emit("undo");const e=this._editGeometryOperations.undo();return null!=e&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._hideTooltip(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if(null!=e&&null!=this.inputGeometry&&(0,O.It)(e,this.inputGeometry))for(const e of this._manipulatorInfos)if("vertex"===e.type&&e.manipulator.selected){const{index:i,component:{index:n}}=e.handle,{byComponentIndex:a}=t,s=a.get(n)||new Set;s.add(i),a.set(n,s)}if(this._recreatingManipulators=!0,this._removeManipulators(),this._hideTooltip(),this._editGeometryOperations=(0,r.pR)(this._editGeometryOperations),this._segmentLabels=(0,r.pR)(this._segmentLabels),null==e)return void(this._recreatingManipulators=!1);const i="mesh"===e.type?e.anchor:e;this._editGeometryOperations=Ba.p.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(t);const n=this.sketchOptions.labels;this._segmentLabels=new q({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,u.bh)(this.graphic),labelOptions:n,graphic:this.graphic,graphicState:this._graphicState},visible:n.enabled}),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const n=[],a=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),s=e===As.SELECTED_OR_ALL&&a;for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.grabbing||s&&!e.manipulator.selected||n.push(e),i++);if(0===n.length)return t;if(this._moveVertices(n,t),n.length===i){if(this._updateEventState(Es.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Es.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((e,t)=>"vertex"===t.type&&t.manipulator.selected?e+1:e),0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Es.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:n}=e;if(!t&&!i&&!n)return;const a=[];for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&a.push(t);this._moveVertices(a,e,us.Y.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Es.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Es.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Es.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Es.MOVING:switch(this._reshapeEventState){case Es.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Es.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Es.RESHAPING:switch(this._reshapeEventState){case Es.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Es.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new Fa({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,n)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=this._editGeometryOperations.createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(As.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Za.XY,e),e))).next((t=>{"end"===t.action&&(this._hideTooltip(),e=(0,r.xt)(e))})),n.next((()=>this._onDragCancel(!0,(()=>e=(0,r.xt)(e)))))}))),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1))))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add(e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))))}_createMoveManipulation(e){const{graphic:t,tool:i,view:n}=this,a=this._graphicState;this._moveManipulation=new Va({tool:i,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&_n(t),snapToScene:!1,radius:Va.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.addHandles([e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()})),this._watchAndUpdateGrabState(e,!1)])));const s=e=>t=>{this.addHandles(t.events.on("focus-changed",(({action:t})=>{"focus"===t?this._updateTranslateTooltip(e):this._hideTooltip()})))};this._moveManipulation.xyManipulation.forEachManipulator(s(Za.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(s(Za.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(s(Za.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const r=t.geometry.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline(((n,a,s,r,o)=>{const{snappingStep:l,cancelSnapping:c}=(0,Xa.L)({predicate:e=>!!e.info,snappingManager:i.snappingManager,snappingContext:new Wa.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:e,pointer:o,excludeFeature:t,visualizer:new jt}),updatingHandles:this._updatingHandles,useZ:!1});return r=r.next((e=>(this._onDragCancel(),e))).next(c),{steps:s=s.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===Yn.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e})).next((0,fa.pg)(this.view,e,t)).next(...l).next((0,fa.EX)()).next((e=>this._perGraphicManipulatorDragAction(As.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(n,e),e))),cancel:r}}),e,r,t),(0,o.wB)((()=>a.displaying),(()=>this._updateMoveManipulationPosition()),o.Vh),a.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,o.wB)((()=>a.isDraped),(e=>{this._updateMoveManipulationPosition();const t="align-move-manipulation";e?this.addHandles(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):this.removeHandles(t)}),o.Vh)])}_createVisualElements(){const{graphic:e,view:t}=this,i=oa({view:t,graphic:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Yn.TRANSLATE_XY)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});null!=i&&(this._outlineVisualElement=i.visualElement instanceof vi?i.visualElement:null),null!=this._outlineVisualElement&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=(0,u.bh)(this.graphic)){if(e.component.vertices.length<=2)return null;const i=this._settings.manipulators.edgeOffset,n=i.size/2,a=n+i.collisionPadding,r=n/a,o=r*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,Xe._B)(this._edgeOffsetManipulatorMaterial,o,r/2,r/2,i.height,i.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,Xe._B)(this._edgeOffsetManipulatorMaterial,-o,r/2,r/2,i.height,-i.offset));const l=[new _a(this._edgeOffsetManipulatorGeometryInside.instantiate(),Rn.p7.Unfocused),new _a(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Rn.p7.Focused),new _a(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Rn.p7.Unfocused),new _a(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Rn.p7.Focused)],c=new Dn({view:this.view,renderObjects:l,elevationInfo:"on-the-ground"!==t.mode||(0,os.$d)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:a,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:(0,p.fA)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new Dn({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),d={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);const _=[];for(const t of[e.leftVertex,e.rightVertex]){const e=this._getManipulatorInfoFromHandle(t);null!=e&&_.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d))))}d.locationUpdateHandle=(0,s.vE)(_),this._manipulatorHandles.add(d.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(h,!0)],c),this._manipulatorHandles.add((0,fa.Xt)(c,this._createEdgeOffsetPipeline(d,t)),c),this._manipulatorHandles.add((0,fa.Xt)(h,((e,i,n,a)=>{if("touch"===a)this._createEdgeOffsetPipeline(d,t)(e,i,n);else if(this.enableMoveGraphic){const a=this.graphic,s=null!=a.geometry?a.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next((0,fa.Tp)(this.view,e.elevationAlignedLocation)).next(ba(this.view,e.elevationAlignedLocation,t,s,a)).next((0,fa.sO)()).next((0,fa.EX)()).next((e=>this._perGraphicManipulatorDragAction(As.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(Za.XY,e),e))).next((e=>{"end"===e.action&&this._hideTooltip()})),n.next((()=>this._onDragCancel(!e.metadata.deleting)))}})),c);const g=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",g),h.events.on("immediate-click",g),c.events.on("focus-changed",(({action:e})=>{const{sketchOptions:t,tooltip:i}=this;if("focus"===e){const e=this._edgeOffsetTooltipInfo??=new gs({sketchOptions:t});e.distance=Ji.r7,e.sketchOptions=t,this._updateTooltipAreaOrTotalLength(e),this._latestTooltipInfo=e,i.info=t.tooltips.effectiveEnabled?this._latestTooltipInfo:null}else this._hideTooltip()}))],c),this._manipulatorInfos.push(d),this.manipulators.add(c),this.manipulators.add(h),this.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,n=e.edgeManipulator,a=()=>{e.visibilityHandle=(0,r.xt)(e.visibilityHandle);const a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=a&&null!=o&&function(e,t,i){const n=i.projectToRenderScreen(e,(0,g.r_)()),a=i.projectToRenderScreen(t,(0,g.r_)());return null!=n&&null!=a?(0,d.p)((0,d.f)(n,n,a)):0}(a.manipulator.renderLocation,o.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!n.focused||l)&&(i.grabbable=!l,n.grabbable=!l,e.visibilityHandle=(0,s.vE)([i.disableDisplay(),(0,s.hA)((()=>{i.grabbable=!0,n.grabbable=this.enableMoveGraphic}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",a),n.events.on("focus-changed",a),(0,s.hA)((()=>{(0,r.xt)(e.visibilityHandle),n.metadata.deleting=!0,this.manipulators.remove(n)}))],i),a()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=this._editGeometryOperations.data,i=hs(this.view,e.manipulator.elevationAlignedLocation,cs(t,e.handle,e.manipulator.elevationInfo)),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==a)return;const s=n.manipulator.renderLocation,r=a.manipulator.renderLocation,o=null!=i?function(e,t,i){const n=(0,xn.Qj)(e),a=(0,d.E)((0,p.vt)(),t,i),s=(0,d.b)((0,p.vt)(),a,n),r=(0,d.b)((0,p.vt)(),a,s);return(0,yt.fA)(a[0],a[1],a[2],0,s[0],s[1],s[2],0,r[0],r[1],r[2],0,0,0,0,1)}(i,s,r):yt.zK;e.manipulator.modelTransform=o,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=o;const l=(0,d.l)((0,d.f)(Ss,s,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,n,a)=>{this._clearSelection();const{step:s,cleanup:r}=this._initializeEdgeOffset(e,t);n.next((e=>this._trackNumDragging(e))).next((0,fa.Tp)(this.view,i.elevationAlignedLocation)).next(s).next(function(e){return ya(e,(e=>e.plane))}(this.view)).next(Sa(this.view,this._editGeometryOperations.data.spatialReference)).next((0,fa.EX)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&r()})),a.next((()=>{i.metadata.deleting||(r(),this._onDragCancel())}))}}_initializeEdgeOffset(e,t){const{view:i}=this,n=this._editGeometryOperations,l=cs(n.data.coordinateHelper,e.handle,t),c=n.createUndoGroup(),h=hs(i,e.manipulator.elevationAlignedLocation,l);if(l.requiresSplitEdgeLeft){const t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=t&&this._splitEdgeManipulator(t,1)}if(l.requiresSplitEdgeRight){const t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=t&&this._splitEdgeManipulator(t,0)}const d=()=>new rs.A({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference}),p=this._settings,u=new vi({view:i,isDraped:this._graphicState.isDraped,geometry:d(),elevationInfo:e.elevationInfo,width:p.visualElements.lineGraphics.outline.width,attached:!1,isDecoration:!0});let _;const g=()=>{this._cleanEdgeOffsetCollapsedEdges(e),_=(0,r.xt)(_)},m=this.on("undo",g);return _=(0,s.vE)([(0,o.wB)((()=>(0,a.QP)(this._accentColor)),(e=>u.color=e),o.Vh),(0,s.DQ)(u),(0,o.wB)((()=>this._graphicState.isDraped),(e=>u.isDraped=e)),this._graphicState.on("changed",(()=>u.geometry=d())),c,m]),u.attached=!0,{step:e=>null==l||null==h?(g(),null):{...e,operation:l,plane:h},cleanup:g}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||null==t.operation)return t;this._updateEventState(Es.RESHAPING);const{mapDeltaX:i,mapDeltaY:n,mapDeltaZ:a}=t;return(i||n||a)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return null==t||null==i?e:("start"===e.action&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:n}=e,{tooltip:a,sketchOptions:s}=this;if(null!=i){const a=this._edgeOffsetTooltipInfo??=new gs({sketchOptions:s});a.sketchOptions=s,a.distance="end"===e.action?Ji.r7:function(e,t,i,n,a){if(e){const e=a.toXYZ(a.pointToVector(i)),s=(0,xn._I)(n,e,E.rq.get()),r=(0,vs.n3)(s,e,a.spatialReference);if(null!=r)return(0,Ji.d_)(r.value*Math.sign(t),r.unit)}return(0,Ji.d_)(t*(0,w.GA)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*n.selectedArrow,t,n.plane,this._editGeometryOperations.data.coordinateHelper),this._updateTooltipAreaOrTotalLength(a),this._latestTooltipInfo=a}else this._latestTooltipInfo=null;return a.info=s.tooltips.effectiveEnabled?this._latestTooltipInfo:null,e}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,n=e.handle.rightVertex.rightEdge?.rightVertex,a=e.handle.rightVertex,s=this._editGeometryOperations.data.coordinateHelper,r=[];if(t&&s.distance(t.pos,i.pos)<xs){const e=this._getManipulatorInfoFromHandle(i);null!=e&&r.push(e)}if(s.distance(i.pos,a.pos)<xs||n&&s.distance(n.pos,a.pos)<xs){const e=this._getManipulatorInfoFromHandle(a);null!=e&&r.push(e)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=(0,u.bh)(this.graphic),i=!1){const{view:n}=this,a=this._settings;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(a.manipulators.vertex);this._vertexManipulatorGeometry=(0,Xe.CM)(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=(0,Xe.CM)(this._vertexManipulatorOutlineMaterial,t,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(a.manipulators.edge);this._edgeManipulatorGeometry=(0,Xe.CM)(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=(0,Xe.CM)(this._edgeManipulatorOutlineMaterial,t,16,16)}const{geometry:o}=this.graphic,l=o?.type,c="point"===l||"mesh"===l?[]:[new _a(this._vertexManipulatorGeometry.instantiate(),Os.Vertex|Rn.p7.Unselected),new _a(this._vertexManipulatorOutlineGeometry.instantiate(),Os.Vertex|Rn.p7.Unfocused|Rn.p7.Unselected),new _a(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Os.Vertex|Rn.p7.Focused|Rn.p7.Unselected),new _a(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Rn.p7.Selected),new _a(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Rn.p7.Selected|Rn.p7.Unfocused),new _a(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Rn.p7.Selected|Rn.p7.Focused)];this.enableMidpoints&&c.push(new _a(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Os.Edge|Rn.p7.Focused|Rn.p7.Unselected),new _a(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Os.Edge|Rn.p7.Focused|Rn.p7.Unselected),new _a(this._edgeManipulatorGeometry.instantiate(),Os.Edge|Rn.p7.Unfocused|Rn.p7.Unselected),new _a(this._edgeManipulatorOutlineGeometry.instantiate(),Os.Edge|Rn.p7.Unfocused|Rn.p7.Unselected));const h=new Dn({view:n,renderObjects:c,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});h.selected=i,this._setTypeSpecificManipulatorSettings(h,e,t);const d="edge"===e.type?{manipulator:h,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:h,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(d),this.manipulators.add(h),this._updateManipulatorPosition(d),"edge"===d.type){const e=[];for(const t of[d.handle.leftVertex,d.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(t);null!=i&&e.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(d))))}d.locationUpdateHandle=(0,s.vE)(e),this._manipulatorHandles.add(d.locationUpdateHandle,h)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(h,!0),h);const p=(0,fa.Xt)(h,((e,i,n,a)=>{let s=null;const{snappingStep:o,cancelSnapping:l}=(0,Xa.L)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new Wa.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:t,pointer:a,excludeFeature:this.graphic,visualizer:new jt}),updatingHandles:this._updatingHandles,useZ:!1});n=n.next((t=>(this._onDragCancel(!e.metadata.deleting,(()=>s=(0,r.xt)(s))),t))).next(l),i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(s=this._editGeometryOperations.createUndoGroup()),"edge"===d.type){const t=this._splitEdgeManipulator(d);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:d,snapOrigin:d.handle.pos}})).next((0,fa.Tp)(this.view,e.elevationAlignedLocation)).next(Ma(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next((0,fa.pg)(this.view,t,this.graphic)).next(...o).next((0,fa.EX)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(s=(0,r.xt)(s)),this._updateTranslateVertexTooltip(e,Za.XY,t)}))}));return this._manipulatorHandles.add([p,h.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,d))),h.events.on("select-changed",(()=>{d.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),h.events.on("focus-changed",(({action:e})=>{"focus"===e&&"edge"!==d.type?this._updateTranslateVertexTooltip(h,Za.XY):this._hideTooltip()}))],h),this.emit("manipulators-changed"),d}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=null!=this._editGeometryOperations?this._editGeometryOperations.data.geometry:null),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._hideTooltip(),this._reshapeEventState){case Es.NONE:break;case Es.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Es.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(Es.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){const{graphic:n}=this,a=this._settings;switch(t.type){case"vertex":{e.state=Os.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;const{size:t,collisionPadding:s}=a.manipulators.vertex;e.radius=t/2+s,e.elevationInfo=i;const{geometry:r}=n,o=r?.type;e.interactive=null!=o&&"point"!==o&&"mesh"!==o;break}case"edge":{e.state=Os.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;const{size:t,collisionPadding:s}=a.manipulators.edge;e.radius=t/2+s,e.elevationInfo="on-the-ground"!==i.mode||(0,os.$d)(n.symbol)?{mode:"absolute-height",offset:0}:i;break}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i,n="mouse"){if(!this._recreatingManipulators){if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Es.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==n||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{const{manipulator:t}=e,{geometry:i}=this.graphic,n=i?.type;t.interactive=t.grabbing||!this._numGrabbing&&null!=n&&"point"!==n&&"mesh"!==n,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((e=>{e.interactive=e.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,ss.Xy)(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(null==e)return;const t=this._editGeometryOperations;if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ws),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==i||null==n)return;const a=i.manipulator,s=n.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){const i=a.location,n=s.location,r=.5,o=i.x+r*(n.x-i.x),l=i.y+r*(n.y-i.y),c=i.hasZ&&n.hasZ?0:void 0;e.manipulator.location=(0,ot.T)(o,l,c,t.data.spatialReference)}else(0,d.m)(Ss,a.renderLocation,s.renderLocation,.5),e.manipulator.renderLocation=Ss}}_splitEdgeManipulator(e,t=.5){const i=this._editGeometryOperations,n=i.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,r.xt)(e.locationUpdateHandle);const a=(0,u.bh)(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(n)):(s=e,s.handle=n,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,a)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,Za.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(Es.RESHAPING),l=i.data.coordinateHelper.vectorToArray(s.handle.pos),c=i.data.components.indexOf(n.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:c,vertexIndex:n.index}],added:l}),o&&this._updateEventState(Es.NONE),s}_updateMoveManipulationPosition(){const e=(0,d.s)(Ss,0,0,0);let t=0,i=!1,n=null,a=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(t++,(0,d.g)(e,e,s.manipulator.renderLocation),null==n||s.selectedIndex>n.selectedIndex?(a=n,n=s):(null==a||s.selectedIndex>a.selectedIndex)&&(a=s)):i=!0);if(0===t){const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&_n(this.graphic),this._moveManipulation.angle=pn(this.graphic.geometry),this._moveManipulation.radius=Va.radiusForSymbol(this.graphic.symbol)}else{const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&_n(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;let i=0;if(null!=n){const e=n.handle.pos,t=null!=a?a.handle.pos:n.handle.leftEdge&&n.handle.leftEdge.leftVertex?n.handle.leftEdge.leftVertex.pos:null,s=null==a&&n.handle.rightEdge&&n.handle.rightEdge.rightVertex?n.handle.rightEdge.rightVertex.pos:null;t&&s?this._moveManipulation.xyAxisManipulation.available=!1:t?i=Ms(t,e):s&&(i=Ms(e,s))}this._moveManipulation.angle=i,this._moveManipulation.radius=ca}0!==t&&i?((0,d.h)(e,e,1/t),ws.spatialReference=this._editGeometryOperations.data.spatialReference,ws.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,ws),this._moveManipulation.elevationAlignedLocation=ws):null==this._outlineVisualElement||this._graphicState.isDraped||null==this._outlineVisualElement.attachmentOrigin?hn(this.view,this._moveManipulation,this.graphic):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){const t=new Array,i=this._editGeometryOperations;for(const n of e){const e=n.handle.component;if("vertex"===n.type&&i.canRemoveVertex(e)){t.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const a=i.removeVertices([n.handle]),s=a.removedVertices?.[0].createdEdge;s?this._createVertexOrEdgeManipulator(s):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.edges[0]))}}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}));this.outputGeometry=i.data.geometry;const n=this._updateEventState(Es.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(n&&(this._updateEventState(Es.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?us.Y.NEW_STEP:us.Y.ACCUMULATE_STEPS)){const n=this._editGeometryOperations;n.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=n.data.geometry;for(const t of e)this._updateManipulatorPosition(t)}_offsetEdge(e,t){if(null==t.operation||null==t.signedDistance)return;const i=this._editGeometryOperations,n=t.operation.clone();n.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===ps.w.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===ps.w.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const{sketchOptions:i,tooltip:n}=this;switch(e){case Za.XY:this._latestTooltipInfo=this._translateGraphicTooltipInfo??=new $a.ar({sketchOptions:i}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,t,((e,t)=>(0,G.Kt)(e,t)));break;case Za.XY_AXIS:this._latestTooltipInfo=this._translateGraphicXYTooltipInfo??=new $a.nW({sketchOptions:i}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,t,((e,i)=>(0,Ji.hs)((0,G.Kt)(e,i),Ta(t))));break;case Za.Z:this._latestTooltipInfo=this._translateGraphicZTooltipInfo??=new $a.YI({sketchOptions:i}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,t,Qa.e5)}this._latestTooltipInfo.sketchOptions=i,n.info=i.tooltips.effectiveEnabled?this._latestTooltipInfo:null}_updateTranslateVertexTooltip(e,t,i){const{sketchOptions:n,tooltip:a}=this;switch(t){case Za.XY:this._latestTooltipInfo=this._translateVertexTooltipInfo??=new $a.un({sketchOptions:n}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,((e,t)=>(0,G.Kt)(e,t))),this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case Za.XY_AXIS:this._latestTooltipInfo=this._translateVertexXYTooltipInfo??=new $a.JH({sketchOptions:n}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,((e,t)=>(0,Ji.hs)((0,G.Kt)(e,t),Ta(i)))),this._updateTooltipAreaOrTotalLength(this._latestTooltipInfo);break;case Za.Z:this._latestTooltipInfo=this._translateVertexZTooltipInfo??=new $a.y3({sketchOptions:n}),this._updateTranslateTooltipDistance(this._latestTooltipInfo,i,Qa.e5)}const s=(0,Qa.Of)(e.location);this._latestTooltipInfo.elevation=null!=s?(0,ms.S3)({actual:s}):null,this._latestTooltipInfo.sketchOptions=n,a.info=n.tooltips.effectiveEnabled?this._latestTooltipInfo:null}_updateTranslateTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,s=i(n,a);e.distance=null!=s?s:Ji.r7}else e.distance=Ji.r7}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(null==t)return e.area=null,void(e.totalLength=null);e.area="polygon"===t.type?(0,fs.n)(t):null,e.totalLength="polyline"===t.type?(0,G.ob)(t):null}_hideTooltip(){this.tooltip.clear(),this._latestTooltipInfo=null}get test(){return{segmentLabels:this._segmentLabels,manipulatorInfos:this._manipulatorInfos}}};function Ms(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,n._)([(0,l.MZ)()],bs.prototype,"_editGeometryOperations",void 0),(0,n._)([(0,l.MZ)()],bs.prototype,"_segmentLabels",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],bs.prototype,"tool",void 0),(0,n._)([(0,l.MZ)()],bs.prototype,"tooltip",void 0),(0,n._)([(0,l.MZ)()],bs.prototype,"inputGeometry",null),(0,n._)([(0,l.MZ)()],bs.prototype,"outputGeometry",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],bs.prototype,"updating",null),(0,n._)([(0,l.MZ)()],bs.prototype,"manipulators",null),(0,n._)([(0,l.MZ)()],bs.prototype,"view",null),(0,n._)([(0,l.MZ)()],bs.prototype,"graphic",null),(0,n._)([(0,l.MZ)()],bs.prototype,"enableZShape",null),(0,n._)([(0,l.MZ)()],bs.prototype,"enableZVertex",null),(0,n._)([(0,l.MZ)()],bs.prototype,"enableMoveGraphic",null),(0,n._)([(0,l.MZ)()],bs.prototype,"enableMidpoints",null),(0,n._)([(0,l.MZ)()],bs.prototype,"enableEdgeOffset",null),(0,n._)([(0,l.MZ)()],bs.prototype,"sketchOptions",null),(0,n._)([(0,l.MZ)()],bs.prototype,"_accentColor",null),bs=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],bs);const ws=(0,ot.T)(0,0,void 0,ys.A.WGS84),Ss=(0,p.vt)(),xs=1e-6;var Os,Es,As,Ts;(Ts=Os||(Os={})).Vertex=Rn.SJ.Custom1,Ts.Edge=Rn.SJ.Custom2,function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Es||(Es={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(As||(As={}));let Rs=class extends(_i.A.EventedMixin(Ua.g)){constructor(e){super(e),this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.sketchOptions=new qa.A,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new bs({tool:this});this.addHandles([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>e.stopPropagation())),(0,o.wB)((()=>this.graphic),(()=>this._updateGraphic()),o.pc)]),this.finishToolCreation()}destroy(){this._reshapeOperation=(0,r.pR)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=(0,as.g)(this.graphic);this._reshapeOperation.inputGeometry=null!=e?e.clone():null}_updateGraphic(){if(this.removeHandles("onGraphicGeometryChange"),this._updateGeometry(),(0,as.N)(this.graphic)!==un.e.SUPPORTED)return;const e=(0,o.wB)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),o.OH);this.addHandles(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0;const{graphic:t}=this,{geometry:i}=t;"mesh"===i?.type&&"point"===e.type?(t.geometry=i.centerAt(e),t.notifyGeometryChanged()):t.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;null!=this.graphic&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){null!=this.snappingManager&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,n._)([(0,l.MZ)()],Rs.prototype,"_reshapeOperation",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Rs.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"enableZShape",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"enableZVertex",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"enableMoveGraphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"enableMidpoints",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Rs.prototype,"enableEdgeOffset",void 0),(0,n._)([(0,l.MZ)()],Rs.prototype,"type",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:qa.A})],Rs.prototype,"sketchOptions",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Rs.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)()],Rs.prototype,"updating",null),(0,n._)([(0,l.MZ)()],Rs.prototype,"automaticManipulatorSelection",void 0),Rs=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Rs);var Ps=i(80575),Ds=i(9987);let Cs=class extends _s.w{constructor(e){super(e),this.type="transform-rotate",this.rotation=null,this.rotationPrecision=null,this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic"}};(0,n._)([(0,l.MZ)()],Cs.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Cs.prototype,"rotation",void 0),(0,n._)([(0,l.MZ)()],Cs.prototype,"rotationPrecision",void 0),(0,n._)([(0,l.MZ)()],Cs.prototype,"orientation",void 0),(0,n._)([(0,l.MZ)()],Cs.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.MZ)()],Cs.prototype,"rotationType",void 0),Cs=(0,n._)([(0,h.$)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Cs);let Is=class extends _s.w{constructor(e){super(e),this.type="transform-scale",this.size=null,this.sizeUnit=null,this.sizePrecision=null}};(0,n._)([(0,l.MZ)()],Is.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Is.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Is.prototype,"size",void 0),(0,n._)([(0,l.MZ)()],Is.prototype,"sizeUnit",void 0),(0,n._)([(0,l.MZ)()],Is.prototype,"sizePrecision",void 0),Is=(0,n._)([(0,h.$)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Is);let Ls=class extends _s.w{constructor(e){super(e),this.type="transform-absolute",this.orientation=null,this.orientationPrecision=null,this.rotationType="geographic",this.size=null,this.sizePrecision=null,this.sizeUnit=null}};var Gs;(0,n._)([(0,l.MZ)()],Ls.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"orientation",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"orientationPrecision",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"rotationType",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"size",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"sizePrecision",void 0),(0,n._)([(0,l.MZ)()],Ls.prototype,"sizeUnit",void 0),Ls=(0,n._)([(0,h.$)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ls),function(e){e.ScaleIn=Rn.SJ.Custom2,e.ScaleOut=Rn.SJ.Custom3,e.RotateLeft=Rn.SJ.Custom4,e.RotateRight=Rn.SJ.Custom5,e.Unlocked=Rn.SJ.Custom7,e.DelayedFocused=Rn.SJ.Custom8,e.TouchInput=Rn.SJ.Custom12}(Gs||(Gs={}));let zs=class extends f.A{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this._absoluteTooltipInfo=null,this._scaleTooltipInfo=null,this._rotateTooltipInfo=null,this.events=new _i.A,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>"scale"===this._scaleRotateDragData?.mode?this.adapter.scale:1}initialize(){this._tooltip=new Ya.m({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,o.z7)((()=>!this.sketchOptions.tooltips.effectiveEnabled),(()=>this._tooltip.clear()),o.Vh),(0,o.wB)((()=>{const{adapter:e}=this,{info:t}=this._tooltip;return t===this._absoluteTooltipInfo&&this.getFocused()?[t,e.size,e.orientationClockwise]:[null]}),(([e])=>{e&&this._updateFocusTooltip()}))])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,r.pR)(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,Ds.mg)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=(0,r.pR)(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,Yn.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=(0,fa.Xt)(e,((e,i,n)=>{this._scaleRotateDragData=null;const a=this.adapter.startInteraction(),s={mode:"none",origin:(0,p.o8)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=s,this._updateDragState();const r=E.rq.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,r),i.next(va(this.tool.view,(0,xn.O_)(e.renderLocation,r,(0,xn.vt)()))).next((e=>{const i=(0,xn.Qj)(e.plane),n=on(e.renderStart,e.renderEnd,s.origin,i),r=Ps.wf.shortestSignedDiff(s.angle,n);s.angleDir=(0,y.qE)(s.angleDir+r,-.3,.3),s.angle=n;const o=function(e,t){const i=(0,d.f)(E.rq.get(),t.renderStart,e.origin),n=(0,d.f)(E.rq.get(),t.renderEnd,e.origin),a=(0,d.l)(i),s=(0,d.l)(n);return 0===a?0:s/a}(s,e),l=o-this.adapter.scale;if(s.scaleDir=(0,y.qE)(s.scaleDir+l,-.2,.2),this._onScaleChanged(),"none"===s.mode){const i=this.mode||function(e,t,i,n){const{renderStart:a,renderEnd:s}=e,r=Vs(a,n,E.rq.get()),o=Vs(s,n,E.rq.get());if((0,d.a)(r,o)<100)return null;const l=(0,d.f)(E.rq.get(),a,i),c=(0,d.b)(E.rq.get(),l,(0,xn.Qj)(t)),h=a,p=(0,d.g)(E.rq.get(),h,c),u=Vs(i,n,E.rq.get()),_=r,g=Vs(p,n,E.rq.get()),m=(0,d.f)(E.rq.get(),g,_),f=(0,d.f)(E.rq.get(),r,u),v=(0,ee.LV)(_,m),y=(0,ee.LV)(u,f);return(0,ee.kb)(v,o)<(0,ee.kb)(y,o)?"rotate":"scale"}(e,e.plane,s.origin,this.tool.view.state.camera);if(null!=i){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}s.mode=i}}switch(s.mode){case"rotate":a.state.angle=s.initialAngle+n;break;case"scale":a.state.scale=o,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:(0,y.KJ)(s.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:o,yScale:o})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:(0,y.KJ)(s.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:o,yScale:o})}}return"end"===e.action&&(this.startAnimation(Zs(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),a.done()),e})).next(this._updateTooltipPipelineStep(s)),n.next((()=>{if(a.cancel(),null!=this._scaleRotateDragData){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Zs(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this.addHandles([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t,i){let n=0,a=null;const s=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=s,n=0,t()},update:e=>(n+=e,!a?.()||n>=i.delayMs?Ns.STOP:Ns.CONTINUE),destroy:()=>{a&&(e.getFocused=a),t()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,o.wB)((()=>this.tool.graphicState?.displaying),(e=>this._ringManipulator.available=e),o.Vh)])}_updateTooltipPipelineStep(e){return t=>{const{sketchOptions:i}=this,{effectiveEnabled:n,visualVariables:a}=i.tooltips;if(!n)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const s=this._tooltip;switch(e.mode){case"scale":{s.info=this._scaleTooltipInfo??=new Is({sketchOptions:i});const{size:e,scale:t}=this.adapter,n=a?.size,r=s.info;r.sketchOptions=i,r.scale={value:t},r.size=null!=e?(0,Ji.d_)(e,"meters"):void 0,r.sizePrecision=Hs(n?.valueType),r.sizeUnit=n?.unit;break}case"rotate":{s.info=this._rotateTooltipInfo??=new Cs({sketchOptions:i});const{orientationClockwise:e,relativeAngleClockwise:t}=this.adapter,n=a?.rotation,r=Hs(n?.valueType),o=s.info;o.sketchOptions=i,o.rotation=null!=t?(0,Ji.Wq)(t,"radians","geographic"):void 0,o.rotationPrecision=r,o.rotationType=n?.rotationType??"geographic",o.orientation=null!=e?(0,Ji.Wq)(e,"radians","geographic"):void 0,o.orientationPrecision=r;break}}return t}}_updateFocusTooltip(){const{sketchOptions:e,_tooltip:t}=this,{effectiveEnabled:i,visualVariables:n}=e.tooltips;if(i)if(this.getFocused()){const i=n?.rotation,a=n?.size,s=this.mode,{size:r,orientationClockwise:o}=this.adapter,l=null!=o&&(null==s||"rotate"===s),c=null!=r&&(null==s||"scale"===s);t.info=this._absoluteTooltipInfo??=new Ls({sketchOptions:e});const h=t.info;h.sketchOptions=e,h.orientation=l?(0,Ji.Wq)(o,"radians","geographic"):void 0,h.orientationPrecision=Hs(i?.valueType),h.rotationType=i?.rotationType??"geographic",h.size=c?(0,Ji.d_)(r,"meters"):void 0,h.sizeUnit=a?.unit,h.sizePrecision=Hs(a?.valueType)}else t.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Gs.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Gs.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==this._scaleRotateDragData?.mode)),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Gs.ScaleIn|Gs.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Gs.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Gs.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Gs.RotateLeft|Gs.RotateRight,!1),this._ringManipulator.updateStateEnabled(Gs.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Gs.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Gs.ScaleIn|Gs.ScaleOut|Gs.RotateLeft|Gs.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,vt.$0)(E.Rc.get(),this.adapter.angle,(0,p.fA)(0,0,1));if(null==e)return;const t=this.getScale(),i=(0,vt.CV)(E.Rc.get(),(0,d.s)(E.rq.get(),t,t,t));this._ringManipulator.modelTransform=(0,vt.lw)(E.Rc.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const n=[],a=Math.ceil(128*(t-e)/(2*Math.PI));for(let s=0;s<a+1;s++){const r=e+s*(t-e)/a;n.push((0,p.fA)(i*Math.cos(r),i*Math.sin(r),0))}return n},t=t=>e(0,2*Math.PI,t),i=this._createMaterial(1),n=(e,t,n=i)=>(0,Xe.Nq)(n,(e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(160),s=n(a,24),r={left:new Array,right:new Array},o=[];for(let t=0;t<2;t++){const a=t*Math.PI-Math.PI/4,s=Math.PI/2-ha,l=a+s,c=a+Math.PI/2-s,h=e(l,c,190),d=n(h,9);o.push(h),o.push(e(l,c,201)),r.left.push(d),r.right.push(d.instantiate());for(let e=0;e<2;e++){const t=0===e,n=(0,yt.vt)();if(t){(0,vt.hs)(n,n,[1,-1,1]),(0,vt.e$)(n,n,-l,[0,0,1]);const e=Math.round(.2*(h.length-1));n[12]=h[e][0],n[13]=h[e][1],n[14]=h[e][2]}else{(0,vt.e$)(n,n,c,[0,0,1]);const e=Math.round(.8*(h.length-1));n[12]=h[e][0],n[13]=h[e][1],n[14]=h[e][2]}const a=(0,Xe._B)(i,60,0,23,.5);(0,Xe.xh)(a,n),(t?r.left:r.right).push(a)}}const l=[];for(let t=0;t<2;t++){const i=t*Math.PI-Math.PI/4,a=Math.PI/2-da,s=i+a,r=i+Math.PI/2-a,o=e(s,r,213);l.push(n(o,9))}const c=this._createMaterial(.66),h=this._createMaterial(.5),d=this._createMaterial(.33),_=t(190),g=t(213),m=n(_,9,c),f=n(g,9,d),v=t(130),y=t(107),b=n(v,9,c),M=n(y,9,d);let w=[new _a(s,Gs.DelayedFocused),new _a(s.instantiate({material:h}),Rn.p7.None)];this.mode&&"scale"!==this.mode||(w=w.concat([...l.map((e=>new _a(e,Gs.DelayedFocused|Gs.Unlocked))),new _a(m,Gs.DelayedFocused|Gs.ScaleIn),new _a(f,Gs.DelayedFocused|Gs.ScaleIn),new _a(b,Gs.DelayedFocused|Gs.ScaleOut),new _a(M,Gs.DelayedFocused|Gs.ScaleOut)])),this.mode&&"rotate"!==this.mode||(w=w.concat([...r.right.map((e=>new _a(e.instantiate(),Gs.DelayedFocused|Gs.Unlocked))),...r.left.map((e=>new _a(e,Gs.DelayedFocused|Gs.RotateLeft))),...r.right.map((e=>new _a(e,Gs.DelayedFocused|Gs.RotateRight)))]));const S=[a,...o];return new Dn({view:this.tool.view,renderObjects:w,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,u.bh)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:S,direction:(0,p.fA)(0,0,1)}})}_createMaterial(e){const t=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Transparent,isDecoration:!0});return this.addHandles((0,o.wB)((()=>({color:(0,a.f6)(this.tool.view.effectiveTheme.accentColor,e)})),(e=>t.setParameters(e)),o.Vh)),t}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:e=>this._ringIndicatorDelayMs=e,tooltip:this._tooltip}}};function Vs(e,t,i){return t.projectToScreen(e,js),(0,d.s)(i,js[0],js[1],0)}var Ns;function Zs(e,t){let i=null,n=1;const a=()=>n;return{start:()=>{n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:e=>(n+=((n+1)/2-n)*Math.min(3*e,1),t(),Math.abs(n-1)<.01?Ns.STOP:Ns.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function Hs(e){switch(e){case"integer":case"long":return 0;default:return null}}(0,n._)([(0,l.MZ)({constructOnly:!0})],zs.prototype,"tool",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],zs.prototype,"adapter",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],zs.prototype,"sketchOptions",void 0),(0,n._)([(0,l.MZ)()],zs.prototype,"mode",void 0),(0,n._)([(0,l.MZ)()],zs.prototype,"_activeAnimation",void 0),(0,n._)([(0,l.MZ)()],zs.prototype,"updating",null),zs=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.transformGraphic.GraphicScaleRotateTransform")],zs),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Ns||(Ns={}));const js=(0,g.gs)();var Fs=i(43785);function ks(e){return null!=e.geometry&&"mesh"===e.geometry.type?function(e){return(0,Wt.Hq)(e.vertexSpace)?function(e,t,i){let n=t?.clone(),a=(0,p.o8)(i.origin),s=null,r=null;return{undo:t=>{s=e.transform?.clone(),r=(0,p.o8)(i.origin),e.transform=n,e.vertexSpace.origin=a,t.notifyMeshTransformChanged()},redo:t=>{n=e.transform?.clone(),a=(0,p.o8)(i.origin),e.transform=s,e.vertexSpace.origin=r,t.notifyMeshTransformChanged()}}}(e,e.transform,e.vertexSpace):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:n=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,n.notifyGeometryChanged()},redo:n=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=null;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Us=class extends f.A{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([(0,o.z7)((()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null}),(({interactionState:e})=>{this._updateMeshRotation(e)}),o.OH),(0,o.z7)((()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null}),(({interactionState:e})=>{this._updateMeshSize(e)}),o.OH)])}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry.transform;if(null==e)return this._interactionState?.angle??0;const t=(0,Fs.yo)(e.rotation)[2];return Math.abs(t)>.999999?(0,y.kU)((0,Fs.g7)(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new Bs({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return ks(this.graphic)}_updateMeshRotation(e){const{angle:t,previousAngle:i}=e;e.previousAngle=t;const n=(0,y.KJ)(t-i),{geometry:a}=this,s=a.anchor;a.rotate(0,0,n,{origin:s}),a.transform&&a.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const{scale:t,previousScale:i}=e;e.previousScale=t;const{geometry:n}=this,a=t/i,s=this.geometry.anchor;this.geometry.scale(a,{origin:s}),n.transform&&n.vertexSpace.origin?this.graphic.notifyMeshTransformChanged():this.graphic.notifyGeometryChanged()}};(0,n._)([(0,l.MZ)({constructOnly:!0})],Us.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Us.prototype,"geometry",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],Us.prototype,"viewingMode",void 0),(0,n._)([(0,l.MZ)()],Us.prototype,"initialAngle",null),(0,n._)([(0,l.MZ)()],Us.prototype,"angle",null),(0,n._)([(0,l.MZ)()],Us.prototype,"angleClockwise",null),(0,n._)([(0,l.MZ)()],Us.prototype,"relativeAngle",null),(0,n._)([(0,l.MZ)()],Us.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.MZ)()],Us.prototype,"scale",null),(0,n._)([(0,l.MZ)()],Us.prototype,"_interactionState",void 0),Us=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Us);let Bs=class extends f.A{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,n._)([(0,l.MZ)()],Bs.prototype,"angle",void 0),(0,n._)([(0,l.MZ)()],Bs.prototype,"initialAngle",void 0),(0,n._)([(0,l.MZ)()],Bs.prototype,"previousAngle",void 0),(0,n._)([(0,l.MZ)()],Bs.prototype,"previousScale",void 0),(0,n._)([(0,l.MZ)()],Bs.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Bs.prototype,"state",null),Bs=(0,n._)([(0,h.$)("InteractionState")],Bs);let qs=class extends f.A{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,o.z7)((()=>null!=this._interactionState?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),o.OH))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?function(e){return-(0,y.kU)(e)}(this._orientationReferenceSymbolLayer.heading??0):0}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){const e=this._sizeReferenceSymbolLayer;if(null==e)return null;const t=this.findLayerView(),i=this._graphicSymbol;if(null==t||null==i||"point-3d"!==i.type)return null;const n=t.getSymbolLayerSize(i,e);if("size"in n&&null!=n.size)return n.size;const a=this.sizeAxis;return!("width"in n)||null==n.width||null!=a&&"width"!==a&&"all"!==a&&"width-and-depth"!==a?!("depth"in n)||null==e.depth||null!=a&&"depth"!==a&&"all"!==a&&"width-and-depth"!==a?!("height"in n)||null==e.height||null!=a&&"height"!==a&&"all"!==a?null:n.height:n.depth:n.width}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&null!=e.heading))}get _graphicSymbol(){return null!=this.graphic?.symbol&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(null!=this._interactionState||null==e||null==t)return Ws;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),n=e.clone(),a=this.angle,s=new Xs({originalSymbol:n,angle:a,initialSizes:i});this._interactionState=s;const r=()=>{this._interactionState=null};return{state:s,done:r,cancel:()=>{this._graphicSymbol=n,r()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:i,initialSizes:n}){const a=this._graphicSymbol;if(null==a||"point-3d"!==a.type)return;const s=a.clone(),r=-(0,y.KJ)(t-this.initialAngle);let o=!1;this._forEachObjectSymbolLayerPair(i,s,((t,i,a)=>{const s=(t.heading??0)+r;i.heading!==s&&(i.heading=s,o=!0);const l=n[a];if(null!=l&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;i.width!==t&&(i.width=t,o=!0);const n=l.depth*e;i.depth!==n&&(i.depth=n,o=!0);const a=l.height*e;i.height!==a&&(i.height=a,o=!0)}})),o&&(this._graphicSymbol=s)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,n)=>{const a=t.symbolLayers.at(n);"object"===e.type&&"object"===a.type&&i(e,a,n)}))}};(0,n._)([(0,l.MZ)()],qs.prototype,"initialAngle",null),(0,n._)([(0,l.MZ)()],qs.prototype,"angle",null),(0,n._)([(0,l.MZ)()],qs.prototype,"angleClockwise",null),(0,n._)([(0,l.MZ)()],qs.prototype,"orientation",null),(0,n._)([(0,l.MZ)()],qs.prototype,"orientationClockwise",null),(0,n._)([(0,l.MZ)()],qs.prototype,"relativeAngle",null),(0,n._)([(0,l.MZ)()],qs.prototype,"relativeAngleClockwise",null),(0,n._)([(0,l.MZ)()],qs.prototype,"scale",null),(0,n._)([(0,l.MZ)()],qs.prototype,"size",null),(0,n._)([(0,l.MZ)()],qs.prototype,"sizeAxis",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qs.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],qs.prototype,"_interactionState",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qs.prototype,"findLayerView",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0})],qs.prototype,"sizeFilter",void 0),(0,n._)([(0,l.MZ)()],qs.prototype,"_sizeReferenceSymbolLayer",null),(0,n._)([(0,l.MZ)()],qs.prototype,"_orientationReferenceSymbolLayer",null),(0,n._)([(0,l.MZ)()],qs.prototype,"_graphicSymbol",null),qs=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],qs);const Ws={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Xs=class extends f.A{get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:n,initialSizes:a}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};(0,n._)([(0,l.MZ)()],Xs.prototype,"originalSymbol",void 0),(0,n._)([(0,l.MZ)()],Xs.prototype,"angle",void 0),(0,n._)([(0,l.MZ)()],Xs.prototype,"initialAngle",void 0),(0,n._)([(0,l.MZ)()],Xs.prototype,"initialSizes",void 0),(0,n._)([(0,l.MZ)()],Xs.prototype,"scale",void 0),(0,n._)([(0,l.MZ)()],Xs.prototype,"state",null),Xs=(0,n._)([(0,h.$)("InteractionState")],Xs);let Ys=class extends(_i.A.EventedMixin(Ua.g)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new qa.A,this.type="transform-3d",this.tooltip=null,this._updatingHandles=new Ki.U,this._scaleRotate=null,this._translateGraphicTooltipInfo=null,this._translateGraphicXYTooltipInfo=null,this._translateGraphicZTooltipInfo=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new ki({graphic:e}),this.addHandles((0,o.wB)((()=>this.sketchOptions.tooltips.effectiveEnabled),(e=>{this.tooltip=e?new Ya.m({view:t}):(0,r.pR)(this.tooltip)}),o.pc)),this._moveManipulation=new Va({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&_n(e),radius:Va.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>this.addHandles(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))));const i=e=>t=>{this.addHandles(t.events.on("focus-changed",(({action:t})=>{const i=this.tooltip;null!=i&&("focus"===t?this._updateMoveTooltip(e):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(Za.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(Za.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(Za.Z));const n=(0,u.bh)(e);this._moveManipulation.elevationInfo=n,this.addHandles($t(this.graphicState,t));const{geometry:a}=e;if(this._moveManipulation.createGraphicDragPipeline(((i,s,r,o,l)=>{if(null!=a&&i===Za.XY){const{snappingStep:i,cancelSnapping:s}=(0,Xa.L)({snappingContext:new Wa.e({elevationInfo:n,pointer:l,editGeometryOperations:Ba.p.fromGeometry(new Pn.A({spatialReference:a.spatialReference}),t.state.viewingMode),visualizer:new jt,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});o=o.next(s),r=r.next((0,fa.RS)(this.view,n)).next(...i)}return{steps:r=r.next((e=>(this._updateMoveTooltip(i,e),e))),cancel:o}}),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:n,dyScreen:a}=e,s={graphic:i,dxScreen:n,dyScreen:a};switch(t){case"start":this.emit("graphic-translate-start",s),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,o.wB)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new zs({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.addHandles([oa({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.hA)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,o.wB)((()=>t.scale),(()=>this._updateMoveAngle()))].filter(ss.Ru)),this.addHandles(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof Dn&&this.addHandles(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this.tooltip=(0,r.pR)(this.tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,r.pR)(this._scaleRotate),this._scaleRotateAdapter=(0,r.pR)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return null!=this.graphic.geometry&&"mesh"===this.graphic.geometry.type?new Us({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new qs({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer)),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,o.wB)((()=>this.graphicState.displaying),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&_n(this.graphic)}))}_createGeometryUndoRecord(){return ks(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){this.view.state.viewingMode===ue.RT.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){hn(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(e,t){const{sketchOptions:i,tooltip:n}=this;if(null!=n){switch(n.clear(),e){case Za.XY:n.info=this._translateGraphicTooltipInfo??=new $a.ar({sketchOptions:i}),this._updateMoveTooltipDistance(n.info,t,((e,t)=>(0,G.Kt)(e,t)));break;case Za.XY_AXIS:n.info=this._translateGraphicXYTooltipInfo??=new $a.nW({sketchOptions:i}),this._updateMoveTooltipDistance(n.info,t,((e,i)=>(0,Ji.hs)((0,G.Kt)(e,i),Ta(t))));break;case Za.Z:n.info=this._translateGraphicZTooltipInfo??=new $a.YI({sketchOptions:i}),this._updateMoveTooltipDistance(n.info,t,Qa.e5)}n.info.sketchOptions=i}}_updateMoveTooltipDistance(e,t,i){if(null!=t&&"end"!==t.action){const{mapStart:n,mapEnd:a}=t,s=i(n,a);e.distance=null!=s?s:Ji.r7}else e.distance=Ji.r7}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:null!=this._scaleRotate?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:e=>null!=this._scaleRotate?this._scaleRotate.test.setRingIndicatorDelayMs(e):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ys.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ys.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],Ys.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)()],Ys.prototype,"enableRotation",void 0),(0,n._)([(0,l.MZ)()],Ys.prototype,"enableScaling",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:qa.A})],Ys.prototype,"sketchOptions",void 0),(0,n._)([(0,l.MZ)()],Ys.prototype,"graphicState",void 0),(0,n._)([(0,l.MZ)({value:!1})],Ys.prototype,"snapToScene",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],Ys.prototype,"snappingManager",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Ys.prototype,"type",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],Ys.prototype,"updating",null),(0,n._)([(0,l.MZ)()],Ys.prototype,"tooltip",void 0),Ys=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Ys);var $s=i(14755),Qs=i(84977),Js=i(77380),Ks=i(8636),er=i(18031);let tr=class extends((0,$s.O)(Qs.oY)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,r.CM)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,n._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:!0}})],tr.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:Pn.A}),(0,er.P)()],tr.prototype,"position",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,er.P)(),(0,Js.w)((e=>Ps.ie.normalize((0,Ks.GB)(e),0,!0)))],tr.prototype,"heading",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,er.P)(),(0,Js.w)((e=>Ps.ie.normalize((0,Ks.GB)(e),0,!0)))],tr.prototype,"tilt",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,er.P)()],tr.prototype,"width",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0}),(0,er.P)()],tr.prototype,"height",void 0),tr=(0,n._)([(0,h.$)("esri.analysis.SlicePlane")],tr),i(60929);var ir=i(7775);(0,mt.fA)(0,0,0,.04),(0,c.A)("mac");const nr=1.15,ar=1.15,sr=(Math.cos((0,y.kU)(45)),Math.cos((0,y.kU)(5)),3),rr=11,or=22.5,lr=.3;(0,yt.vt)();var cr,hr=i(66356),dr=i(83938),pr=i(59615),ur=i(70465);Ve.Y;class _r extends be.w{initializeProgram(e){return new Me.B(e.rctx,_r.shader.get().build(this.configuration),Ne.D)}initializePipeline(){return(0,xe.Ey)({blending:(0,xe.p3)(Se.dn.ONE,Se.dn.ONE,Se.dn.ONE_MINUS_SRC_ALPHA,Se.dn.ONE_MINUS_SRC_ALPHA),depthTest:{func:Se.MT.LESS},colorWrite:xe.wE})}}function gr(e){const t=(0,d.l)(e.basis1),i=(0,d.l)(e.basis2);return lr*Math.min(t,i)}function mr(e){return gr(e)}function fr(e){return 0!==e.direction[0]&&0!==e.direction[1]}_r.shader=new ye.$(ur.S,(()=>i.e(8577).then(i.bind(i,88577)))),pr.W,xi.A,i(32159),i(10379),i(69891),(0,p.vt)(),(0,p.vt)(),i(8e3),function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(cr||(cr={}));const vr=Rn.SJ.Custom1;var yr,br;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(yr||(yr={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(br||(br={}));const Mr=Rn.SJ.Custom2,wr=((0,ee.vt)(),Math.PI/2),Sr=Rn.SJ.Custom1,xr=Rn.SJ.Custom2;var Or,Er=i(31753);!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Or||(Or={}));class Ar extends Dn{constructor(e,t){const i=new Qe.W({width:1,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0}),n=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),s=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),r=new Dt.v({cullFace:Mi.s2.Back,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),l=new Dt.v({writeDepth:!1,cullFace:Mi.s2.Front,renderOccluded:Ye.m$.Transparent,isDecoration:!0});super({view:e,...Tr({offsetMode:t,tubeMaterial:n,tipMaterial:s,capMaterial:r,outlineMaterial:l,calloutMaterial:i})}),this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const t=(0,a.bJ)(e),o=m.A.toUnitRGBA(e),c=m.A.toUnitRGBA(t),h=m.A.toUnitRGBA(m.A.blendColors(t,e,.4)),d=m.A.toUnitRGBA(m.A.blendColors(t,e,.14));i.setParameters({color:o}),n.setParameters({color:d}),s.setParameters({color:c}),r.setParameters({color:h}),l.setParameters({color:o})}),o.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function Tr({offsetMode:e,tubeMaterial:t,tipMaterial:i,capMaterial:n,outlineMaterial:a,calloutMaterial:s}){const r=e===Or.CENTER_ON_CALLOUT?40:0,o=[(0,p.fA)(r,0,-24),(0,p.fA)(r,0,24)],l=function(e,t){const i=(0,d.f)((0,p.vt)(),e[e.length-1],e[e.length-2]);(0,d.n)(i,i),(0,d.h)(i,i,or),(0,d.g)(i,i,e[e.length-1]);{const t=(0,d.f)((0,p.vt)(),e[0],e[1]);return(0,d.n)(t,t),(0,d.h)(t,t,or),(0,d.g)(t,t,e[0]),[t,...e,i]}}(o),c=Rr({vertices:o,padding:0,materials:{tube:t,tip:i,cap:n}}),h=Rr({vertices:o,padding:2.25,materials:{tube:a,tip:a,cap:a}}),u=(0,Xe.Z8)(s,[[r,0,0],[r-40,0,0]]),_=(0,Xe.Z8)(s,[[r,0,0],[r-40,0,0]]);return{renderObjects:[...c.normal.map((e=>new _a(e,Rn.p7.Unfocused|vr))),...h.normal.map((e=>new _a(e,Rn.p7.Unfocused|vr))),new _a(u,Rn.p7.Unfocused|vr|Mr),...c.focused.map((e=>new _a(e,Rn.p7.Focused|vr))),...h.focused.map((e=>new _a(e,Rn.p7.Focused|vr))),new _a(_,Rn.p7.Focused|vr|Mr)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:rr,state:vr}}function Rr({vertices:e,padding:t,materials:i}){const n=n=>{const a=e.slice(0),s=(0,d.f)(E.rq.get(),a[0],a[1]);(0,d.n)(s,s);const r=(0,d.f)(E.rq.get(),a[a.length-1],a[a.length-2]);if((0,d.n)(r,r),t>0){const e=(0,d.h)((0,p.vt)(),r,-t);a[a.length-1]=(0,d.g)(e,e,a[a.length-1]);const i=(0,d.h)((0,p.vt)(),s,-t);a[0]=(0,d.g)(i,i,a[0])}const o=n?ar:1,l=or*o,c=rr*o,h=(0,vt.D_)(E.Rc.get());if(t>0){const e=l/4,i=(0,d.s)(E.rq.get(),0,e,0),n=1+t/e;(0,vt.Tl)(h,h,i),(0,vt.hs)(h,h,(0,d.s)(E.rq.get(),n,n,n)),(0,vt.Tl)(h,h,(0,d.h)(i,i,-1/n))}const u=(0,vt.D_)((0,yt.vt)()),_=(0,p.fA)(0,1,0),g=(0,vt.I0)((0,yt.vt)(),(0,Er.Yc)(E.J8.get(),_,r));g[12]=a[a.length-1][0],g[13]=a[a.length-1][1],g[14]=a[a.length-1][2],(0,vt.lw)(g,g,h);const m=i.tube,f=function(e,t,i){const n=[];for(let t=0;t<12;t++){const i=t/12*2*Math.PI;n.push([Math.cos(i)*e,Math.sin(i)*e])}return(0,Xe.Nq)(i,n,t,[],[],!1)}(sr*(n?nr:1)+t,a,m);f.transformation=u;const v=[f],y=i.tip,b=(0,Xe.EE)(y,l,c,24,!1,!1,!0);b.transformation=g,v.push(b);const M=i.cap,w=(0,Xe.EE)(M,l,c,24,!1,!0,!1);w.transformation=g,v.push(w);const S=(0,vt.I0)((0,yt.vt)(),(0,Er.Yc)(E.J8.get(),_,s));return S[12]=a[0][0],S[13]=a[0][1],S[14]=a[0][2],(0,vt.lw)(S,S,h),v.push(b.instantiate({transformation:S})),v.push(w.instantiate({transformation:S})),v};return{normal:n(!1),focused:n(!0)}}var Pr=i(96165);class Dr{constructor(e,t,i,n){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;const a=this._tool,s=a.view;this.moveXYGraphicManipulation=new Fa({view:s,tool:a,graphicState:this._graphicState}),a.addHandles(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=new Ar(s,Or.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Mr,a.manipulators.add(this.moveZManipulator),a.addHandles([this._createMoveZDragPipeline()]),a.addHandles([a.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))])}destroy(){this.moveXYGraphicManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYGraphicManipulation.forEachManipulator(e),e(this.moveZManipulator,Yn.TRANSLATE_Z)}updateManipulators(e,t){const i=this.moveZManipulator,n=(0,vt.Qr)(E.Rc.get(),e,Math.PI);n[12]=0,n[13]=0,n[14]=0,i.modelTransform=n,i.renderLocation=(0,d.f)(E.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYGraphicManipulation.grabbing||this.moveXYGraphicManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){const e=this._tool,t=this._moveXYTooltipInfo??=new $a.ar({sketchOptions:e.sketchOptions});if(this.moveXYGraphicManipulation.dragging){const i=this._bounds,n=i.mapBoundsStart.origin,a=i.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;const r=(0,G.Do)(n,a,s);if(null==r)return null;t.distance=r}else t.distance=Ji.r7;return t}_computeMoveZTooltipInfo(){const e=this._tool,t=this._moveZTooltipInfo??=new $a.YI({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){const i=this._bounds,n=i.mapBoundsStart.origin,a=i.mapBounds.origin,{renderSpatialReference:s}=e.view;if(!s)return null;const r=(0,Qa.cL)(n,a,s);if(null==r)return null;t.distance=r}else t.distance=Ji.r7;return t}_createMoveXYGraphicDragPipeline(){return this.moveXYGraphicManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i)))}_createMoveZDragPipeline(){const e=this._editGeometryOperations.data.spatialReference;return(0,fa.Xt)(this.moveZManipulator,((t,i,n)=>{const a=(0,p.o8)(t.renderLocation),s=i.next(wa(this._tool.view,a,e)).next((0,fa.sO)());this._applyGraphicMoveSteps(s,n)}))}_applyGraphicMoveSteps(e,t){const i=this._tool,n=i.graphic,a=e.next((e=>("start"===e.action&&(i.inputState={type:"move"},this._bounds.backupMapBounds(),i.emit("graphic-translate-start",{graphic:n,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,fa.EX)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:n,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&i.emit("graphic-translate",t);break;case"end":i.inputState=null,i.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{null!=i.inputState&&i.emit("graphic-translate-stop",{graphic:n,dxScreen:0,dyScreen:0}),i.cancel()})),a}_moveDragUpdateGeometry(){const e=this._tool;return t=>{if(null==e.inputState||"move"!==e.inputState.type)return t;const i=[];for(const e of this._editGeometryOperations.data.components)i.push(...e.vertices);const n="start"===t.action?us.Y.NEW_STEP:us.Y.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);return(0,Pr.Bb)(a,this._bounds.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,t}}}var Cr=i(41038),Ir=i(71678),Lr=i(28116),Gr=i(2296);class zr extends be.w{initializeProgram(e){return new Me.B(e.rctx,zr.shader.get().build(this.configuration),Zr)}_setPipelineState(e,t){const i=this.configuration,n=e===Ti.y.NONE,a=e===Ti.y.FrontFace;return(0,xe.Ey)({blending:i.output!==Si.V.Color&&i.output!==Si.V.Alpha||!i.transparent?null:n?Vr:(0,Ai.ez)(e),culling:(0,xe.Xt)(i.cullFace),depthTest:{func:(0,Ai.K_)(e)},depthWrite:n?i.writeDepth?xe.kn:null:(0,Ai.XO)(e),colorWrite:xe.wE,stencilWrite:i.hasOccludees?Lr.v0:null,stencilTest:i.hasOccludees?t?Lr.a9:Lr.qh:null,polygonOffset:n||a?null:(0,Ai.aB)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}zr.shader=new ye.$(Gr.I,(()=>i.e(9832).then(i.bind(i,19832))));const Vr=(0,xe.ox)(Se.dn.ONE,Se.dn.ONE_MINUS_SRC_ALPHA);class Nr extends Ri.E{constructor(){super(...arguments),this.output=Si.V.Color,this.cullFace=Mi.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Ti.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,n._)([(0,Ge.W)({count:Si.V.COUNT})],Nr.prototype,"output",void 0),(0,n._)([(0,Ge.W)({count:Mi.s2.COUNT})],Nr.prototype,"cullFace",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"hasSlicePlane",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"transparent",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"enableOffset",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"writeDepth",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"hasOccludees",void 0),(0,n._)([(0,Ge.W)({count:Ti.y.COUNT})],Nr.prototype,"transparencyPassType",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"multipassEnabled",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"cullAboveGround",void 0),(0,n._)([(0,Ge.W)()],Nr.prototype,"perspectiveInterpolation",void 0),(0,n._)([(0,Ge.W)({constValue:!1})],Nr.prototype,"occlusionPass",void 0);const Zr=new Map([[ve.r.POSITION,0],[ve.r.UV0,2],[ve.r.PERSPECTIVEDIVIDE,3]]);class Hr extends pr.W{constructor(e){super(e,new kr),this.supportsEdges=!0,this.produces=new Map([[Ie.N.OPAQUE_MATERIAL,e=>e===Si.V.Highlight||(0,Si.j8)(e)&&!this.parameters.transparent],[Ie.N.TRANSPARENT_MATERIAL,e=>(0,Si.j8)(e)&&this.parameters.transparent&&this.parameters.writeDepth],[Ie.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,Si.j8)(e)&&this.parameters.transparent&&!this.parameters.writeDepth],[Ie.N.DRAPED_MATERIAL,e=>(0,Si.jS)(e)]]),this._vertexAttributeLocations=Zr,this._configuration=new Nr}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Ai.xt,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new jr(e)}createBufferWriter(){const e=dr.zK.clone();return this.parameters.perspectiveInterpolation&&e.f32(ve.r.PERSPECTIVEDIVIDE),new Fr(e)}}class jr extends Ir.m{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(zr,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==Si.V.Color&&this._output!==Si.V.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Fr extends hr.Z{write(e,t,i,n,a){for(const s of this.vertexBufferLayout.fields.keys()){const r=i.attributes.get(s);if(r)if(s===ve.r.PERSPECTIVEDIVIDE){(0,Oi.vA)(1===r.size);const e=n.getField(s,wi.Y$);e&&(0,Ei.uO)(r,e,a)}else(0,Ei.zC)(s,r,e,t,n,a)}}}class kr extends Ye.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Mi.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}class Ur extends Dn{constructor(e,t){const i=new Hr({transparent:!0,writeDepth:!1,renderOccluded:Ye.m$.Opaque,isDecoration:!0}),n=sn.calloutWidth,s=new Qe.W({width:n,renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0});super({view:e,...Br({imageMaterial:i,calloutMaterial:s})}),this._currentTexture=null,this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const n=(0,a._L)(e,.5),r=(0,a.bJ)(e),o=this._currentTexture,l=t(n,r);i.setParameters({textureId:l.texture.id}),s.setParameters({color:m.A.toUnitRGBA(e)}),this._currentTexture=l,o?.release()}),o.Vh)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function Br({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:i,calloutLength:n,discRadius:a}=sn,s=a*i,r=(e,t)=>{const i=[0,1,2,2,3,0];return new Pt.V(t,[[ve.r.POSITION,new Rt.n([n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],i,3,!0)],[ve.r.UV0,new Rt.n([0,0,1,0,1,1,0,1],i,2,!0)]])},o=(0,Xe.Z8)(t,[[0,0,0],[n-a,0,0]]),l=(0,Xe.Z8)(t,[[0,0,0],[n-s,0,0]]),c=vr;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},focusMultiplier:i,radius:a,renderObjects:[new _a(r(a,e),Rn.p7.Unfocused|c),new _a(o,Rn.p7.Unfocused|c),new _a(r(s,e),Rn.p7.Focused|c),new _a(l,Rn.p7.Focused|c)],state:c}}var qr=i(62853),Wr=i(60595);class Xr{constructor(e,t,i){this._tool=e,this._editGeometryOperations=t,this._bounds=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;const n=this._tool,a=n.view,s=!a._stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new Ur(a,((e,t)=>function(e,t){const{accentColor:i,contrastColor:n,preMultiplyAlpha:a}=t;return e.fromData(`heading-rotate:[accent:${i},contrast:${n},size:64]`,(()=>new Cr.g(function(e,t){return function(e,t){const i=new Image(t,t);return i.src=e,i}(function(e){const t=(new XMLSerializer).serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}(function(e,{accentColor:t,contrastColor:i}){const n=t.toHex(),a=t.a,s=i.toHex(),r=i.a,o=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return o&&(o.innerHTML=`\n      .contrast-fill { fill: ${s}; fill-opacity: ${r}; }\n      .contrast-stroke { stroke: ${s}; stroke-opacity: ${r};  }\n      .accent-fill { fill: ${n}; fill-opacity: ${a}; }\n      .accent-stroke { stroke: ${n}; stroke-opacity:  ${a}; }`),e}(function(e){const t=e.split(",")[1],i=atob(t);return(new DOMParser).parseFromString(i,"image/svg+xml")}(e),t)),t.size)}("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:i,contrastColor:n,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:a})))}(a.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:s}))),n.addHandles([this.rotateManipulator.events.on("grab-changed",(e=>this._onRotateGrab(e))),this._createRotateDragPipeline(this.rotateManipulator)]),n.manipulators.add(this.rotateManipulator),n.addHandles([n.on("graphic-rotate-start",(e=>{this._startAngle=e.angle})),n.on("graphic-rotate",(e=>{this._endAngle=e.angle})),n.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0}))])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,Yn.ROTATE)}updateManipulators(e,t){const i=this._bounds.mapBounds.plane[2]<0?Math.PI:0,n=(0,vt.eL)(E.Rc.get(),e,i);n[12]=0,n[13]=0,n[14]=0,this.rotateManipulator.modelTransform=n,this.rotateManipulator.renderLocation=(0,d.g)(E.rq.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo??=new Wr.d({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onRotateGrab({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t)return;const a=function(e,t,i,n){const a=t.worldUpAtPosition(e.origin,E.rq.get()),s=E.rq.get();switch(i){case yr.HEADING:(0,d.c)(s,a);break;case yr.TILT:(0,d.c)(s,e.basis1)}return(0,xn.O_)(e.origin,s,n)}(n.displayBounds,i.view.renderCoordsHelper,yr.HEADING,(0,xn.vt)()),s=En(i.view.state.camera,t);(0,xn.Ui)(a,s,E.rq.get())&&(n.backupMapBounds(),i.inputState={type:"rotate",rotatePlane:a})}_createRotateDragPipeline(e){const t=this._tool,i=t.graphic;return(0,fa.Xt)(e,((e,n,a)=>{const s=t.inputState;null!=s&&(n.next((e=>("start"===e.action&&t.emit("graphic-rotate-start",{graphic:i,angle:0}),e))).next(va(t.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdateGeometry()).next((e=>{const n={graphic:i,angle:(0,y.KJ)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",n);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",n)}return e})),a.next((()=>{null!=t.inputState&&t.emit("graphic-rotate-stop",{graphic:i,angle:0}),t.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,xn.Qj)(e.rotatePlane),n=on(t.renderStart,t.renderEnd,this._bounds.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:n}}}_rotateDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,d.c)((0,p.vt)(),t.mapBoundsStart.origin),a=[];for(const e of this._editGeometryOperations.data.components)a.push(...e.vertices);const s="start"===i.action?us.Y.NEW_STEP:us.Y.ACCUMULATE_STEPS,r=this._editGeometryOperations.rotateVertices(a,n,i.rotateAngle,s,qr.K.REPLACE);return(0,ir.c)(t.mapBoundsStart,t.mapBounds),(0,Pr.Bb)(r,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}class Yr extends Dn{constructor(e,t){const i=fr(t),n=i?4:1,a=2*n,s={renderOccluded:Ye.m$.OccludeAndTransparent,isDecoration:!0},r=new Qe.W({...s,width:n}),l=new Qe.W({...s,width:a}),c=new Qe.W({...s,width:1});super({view:e,...rn,...$r({isCorner:i,unfocusedMaterial:r,focusedMaterial:l,outlineMaterial:c})}),this._themeHandle=(0,o.wB)((()=>e.effectiveTheme.accentColor),(e=>{const t=m.A.toUnitRGBA(e);r.setParameters({color:t}),l.setParameters({color:t}),c.setParameters({color:t})}),o.Vh)}destroy(){this._themeHandle.remove(),super.destroy()}}function $r({isCorner:e,unfocusedMaterial:t,focusedMaterial:i,outlineMaterial:n}){const a=e?[(0,p.fA)(1,0,0),(0,p.fA)(0,0,0),(0,p.fA)(0,1,0)]:[(0,p.fA)(1,0,0),(0,p.fA)(-1,0,0)];return{renderObjects:[new _a((0,Xe.Z8)(t,a),Rn.p7.Unfocused|Sr),new _a((0,Xe.Z8)(i,a),Rn.p7.Focused|Sr),new _a((0,Xe.Z8)(n,a),xr)],collisionType:{type:"line",paths:[a]},radius:e?6:4,state:Sr}}var Qr=i(22781);class Jr{constructor(e,t,i){this._tool=e,this._onDisplayBoundsChanged=t,this.mapBounds=(0,ir.a)(),this.mapBoundsStart=(0,ir.a)(),this.displayBounds=(0,ir.a)(),this._calculateMapBounds(i)}get displayBoundsMargin(){const{view:e,graphic:t}=this._tool,i=e.pointsOfInterest?.centerOnSurfaceFrequent.location??t.geometry?.extent?.center;return i?Kr*e.pixelSizeAt(i):0}backupMapBounds(){(0,ir.c)(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged()}_calculateMapBounds(e){const{view:t,attachmentOrigin:i}=this._tool,n=e.geometry,a=function(e){const t=pn(e);return(0,x.fA)(Math.cos(t),Math.sin(t))}(n);(0,S.hs)(a,a,-1);const s=t.spatialReference,r=n.spatialReference,o=i?t.pixelSizeAt(i)*(0,w.KX)(s)/(0,w.GA)(r):0;(0,Pr.G3)(a,e,eo*o,this.mapBounds)}_calculateDisplayBounds(){const{view:e,attachmentOrigin:t,graphic:i}=this._tool;if(!i.geometry)return;const n=t?.z??(0,Mt.nG)(this.mapBounds.origin,e.elevationProvider,wt.F.fromElevationInfo((0,u.bh)(i)),e.renderCoordsHelper),a=(0,ir.c)(this.mapBounds);a.origin[2]=n??0,function(e,t,i,n=0,a){a||(a=(0,ir.a)()),t.toRenderCoords(e.origin,i,a.origin);const s=E.rq.get();(0,d.g)(s,e.origin,e.basis1),(0,d.g)(s,s,e.basis2),t.toRenderCoords(s,i,s);const r=E.rq.get();(0,d.g)(r,e.origin,e.basis1),(0,d.f)(r,r,e.basis2),t.toRenderCoords(r,i,r);const o=E.rq.get();(0,d.f)(o,e.origin,e.basis1),(0,d.f)(o,o,e.basis2),t.toRenderCoords(o,i,o);const l=E.rq.get();(0,d.f)(l,e.origin,e.basis1),(0,d.g)(l,l,e.basis2),t.toRenderCoords(l,i,l);const c=(0,d.m)(E.rq.get(),s,r,.5);(0,d.f)(c,c,a.origin);const h=(0,d.m)(E.rq.get(),o,l,.5);(0,d.f)(h,a.origin,h),(0,d.m)(a.basis1,c,h,.5);const p=(0,d.m)(E.rq.get(),l,s,.5);(0,d.f)(p,p,a.origin);const u=(0,d.m)(E.rq.get(),r,o,.5);(0,d.f)(u,a.origin,u),(0,d.m)(a.basis2,p,u,.5);const _=(0,d.b)(E.rq.get(),a.basis1,a.basis2),g=(0,d.b)(_,_,a.basis1);(0,d.n)(g,g),(0,d.h)(a.basis2,g,(0,d.k)(a.basis2,g)),(0,d.h)(a.basis1,a.basis1,1+n/(0,d.l)(a.basis1)),(0,d.h)(a.basis2,a.basis2,1+n/(0,d.l)(a.basis2)),(0,ir.u)(a)}(a,e.renderCoordsHelper,i.geometry.spatialReference,this.displayBoundsMargin,this.displayBounds)}}const Kr=10,eo=80;function to(e,t,i){return(0,d.f)(so,(0,d.f)(so,e.origin,e.basis1),e.basis2),(0,d.r)(ao,so,e.basis1,2),(0,d.r)(no,ao,e.basis2,2),(0,d.r)(io,so,e.basis2,2),so[2]=ao[2]=no[2]=io[2]=t,(0,Qr.b)({topLeft:io,topRight:no,bottomRight:ao,bottomLeft:so,spatialReference:i})}const io=(0,p.vt)(),no=(0,p.vt)(),ao=(0,p.vt)(),so=(0,p.vt)();class ro{get zMax(){if(!this._zMaxDirty)return this._zMax;const e=this._editGeometryOperations.data;if(e.geometry.hasZ){const t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;for(const i of e.components)for(const e of i.vertices){const i=t.getZ(e.pos)??0;this._zMax=Math.max(i,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,i,n,a){this._tool=e,this._graphicState=t,this._editGeometryOperations=i,this._bounds=n,this._preserveAspectRatioStep=a,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,ir.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,x.vt)(),this._endScale=(0,x.vt)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;const s=this._tool,r=s.view;this.resizeManipulators=this._resizeHandles.map((e=>{const t=new Yr(r,e);return s.addHandles([t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(t,e)]),t})),s.manipulators.addMany(this.resizeManipulators),s.addHandles([s.on("graphic-scale-start",(e=>{(0,S.hZ)(this._startScale,e.xScale,e.yScale),(0,S.hZ)(this._endScale,e.xScale,e.yScale)})),s.on("graphic-scale",(e=>{(0,S.hZ)(this._endScale,e.xScale,e.yScale)})),s.on("graphic-scale-stop",(()=>{(0,S.hZ)(this._startScale,0,0),(0,S.hZ)(this._endScale,0,0)})),this._graphicState.on("changed",(()=>{"resize"!==s.inputState?.type&&(this._zMaxDirty=!0)}))])}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,Yn.SCALE)))}updateManipulators(e,t){this.resizeManipulators.forEach(((i,n)=>{!function(e,t,i,n){const a=(0,d.l)(n.basis1),s=(0,d.l)(n.basis2),r=gr(n),o=mr(n),l=(0,d.s)(E.rq.get(),0,0,0);(0,d.g)(l,(0,d.h)(E.rq.get(),n.basis1,t.direction[0]),(0,d.h)(E.rq.get(),n.basis2,t.direction[1])),(0,d.g)(l,n.origin,l);let c=0,h=1;if(fr(t))1===t.direction[0]&&-1===t.direction[1]?c=wr:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;c=1===e?wr:0,h=(1===e?s:a)-r}const p=(0,vt.N9)(E.Rc.get(),c);(0,vt.hs)(p,p,(0,d.s)(E.rq.get(),h,h,h)),(0,vt.lw)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(i,this._resizeHandles[n],e,t)}))}getUpdatedTooltipInfo(){return this.resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null}_computeScaleTooltipInfo(){const e=this._tool,t=this._scaleTooltipInfo??=new Wr.c({sketchOptions:e.sketchOptions}),i=e.graphic.geometry;if(null==i)return null;const n=to(this._bounds.mapBounds,this.zMax,i.spatialReference);return null==n?null:(t.xSize=n.xSize,t.ySize=n.ySize,null!=this._sizeStart&&this.resizeManipulators.some((e=>e.dragging))?(t.xScale=n.xSize.value/this._sizeStart.xSize.value,t.yScale=n.ySize.value/this._sizeStart.ySize.value):(t.xScale=1,t.yScale=1),t)}_onResizeGrab({action:e,screenPoint:t}){const i=this._tool,n=this._bounds;if("start"!==e||!t||!i.graphic.geometry)return;const a=En(i.view.state.camera,t);(0,xn.Ui)(n.displayBounds.plane,a,E.rq.get())&&(n.backupMapBounds(),(0,ir.c)(n.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=n.displayBoundsMargin,this._sizeStart=to(n.mapBoundsStart,this.zMax,i.graphic.geometry.spatialReference),i.inputState={type:"resize"})}_createResizeDragPipeline(e,t){const i=this._tool,n=i.graphic;return(0,fa.Xt)(e,((e,a,s)=>{null!=i.inputState&&(a.next((e=>("start"===e.action&&i.emit("graphic-scale-start",{graphic:n,xScale:1,yScale:1}),e))).next(va(i.view,this._displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:n,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),s.next((()=>{null!=i.inputState&&i.emit("graphic-scale-stop",{graphic:n,xScale:1,yScale:1}),i.cancel()})))}))}_resizeDragRenderPlaneToFactors(){const e=this._bounds;return t=>{const i=this._displayBoundsStart,n=t.handle.direction,a=e.displayBoundsMargin,s=this._displayBoundsMarginStart,r=(0,d.c)(E.rq.get(),i.origin);(0,d.r)(r,r,i.basis1,-n[0]),(0,d.r)(r,r,i.basis2,-n[1]);const o=(0,d.f)(E.rq.get(),t.renderEnd,r),l=(0,d.f)(E.rq.get(),t.renderStart,r),c=fr(t.handle),h=mr(i),p=mr(e.displayBounds)/h,u=(e,t)=>{if(0===e)return 1;let i=(0,d.l)(t),n=.5*e*(0,d.k)(t,o)/i;const r=n<0?-1:1;c&&(n+=(i-.5*e*(0,d.k)(t,l)/i)*r*p);const h=i<1.5*s?1:oo;return i=Math.max(i-s,oo),r>0&&(n-=a),r*Math.max(r*(n/i),h)};return{...t,factor1:u(n[0],i.basis1),factor2:u(n[1],i.basis2)}}}_resizeDragUpdateGeometry(){const e=this._tool,t=this._bounds;return i=>{const n=(0,d.c)((0,p.vt)(),t.mapBoundsStart.origin);(0,d.r)(n,n,t.mapBoundsStart.basis1,-i.handle.direction[0]),(0,d.r)(n,n,t.mapBoundsStart.basis2,-i.handle.direction[1]);const a=(0,S.hZ)((0,x.vt)(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);(0,S.S8)(a,a);const s=[];for(const e of this._editGeometryOperations.data.components)s.push(...e.vertices);const r="start"===i.action?us.Y.NEW_STEP:us.Y.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(s,n,a,i.factor1,i.factor2,r,qr.K.REPLACE);return(0,ir.c)(t.mapBoundsStart,t.mapBounds),(0,Pr.Bb)(o,t.mapBounds),e.graphic.geometry=this._editGeometryOperations.data.geometry,i}}}const oo=1e-6;class lo{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;const e=new fa.rh;return this._next=e,[e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e),e]}_adjustScaleFactors(e){const t=fr(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}let co=class extends(_i.A.EventedMixin(Ua.g)){constructor(e){super(e),this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new qa.A,this._preserveAspectRatio=new lo,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type="transform-3d",this._outlineVisualElement=null}initialize(){const{view:e,graphic:t}=this,i=this._graphicState=new ki({graphic:t}),n=t.geometry,a=this._editGeometryOperations=Ba.p.fromGeometry(n,e.state.viewingMode),r=this._bounds=new Jr(this,(()=>this._updateManipulators()),a.data);this._extentMove=new Dr(this,i,a,r),this._extentScale=new ro(this,i,a,r,(()=>this._preserveAspectRatio.createDragEventPipelineStep())),this._extentRotate=new Xr(this,a,r),this.addHandles([(0,o.wB)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,Yn.TRANSLATE_Z))),(0,o.wB)((()=>this.enableScaling),(()=>this._extentScale.forEachManipulator((e=>this._updateManipulatorAvailability(e,Yn.SCALE))))),(0,o.wB)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,Yn.ROTATE)))]),this._updateAllManipulatorAvailability();const l=oa({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.hA)()});if(null!=l){const{visualElement:e}=l;e instanceof vi&&(this._outlineVisualElement=e,this.addHandles(e.events.on("attachment-origin-changed",(()=>this._bounds.updateDisplayBounds())))),this.addHandles(l)}this.addHandles([i.on("changed",(()=>this._onGeometryChanged())),(0,o.wB)((()=>i.displaying),(()=>this._updateAllManipulatorAvailability())),(0,o.wB)((()=>i.isDraped),(()=>this._graphicDrapedChanged()),o.Vh),(0,o.wB)((()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location),(()=>r.updateDisplayBounds())),e.trackGraphicState(i)]),this._forEachManipulator((e=>{this.addHandles(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))})),this._forEachManipulator(((e,i)=>{this.addHandles(e.events.on("immediate-click",(e=>{i===Yn.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this._editGeometryOperations.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{view:e}=this,t=this.tooltip=new Ya.m({view:e}),i=()=>{t.info=this._getUpdatedTooltipInfo()};this.addHandles([(0,o.wB)((()=>this.sketchOptions.tooltips.effectiveEnabled),i),this.on("graphic-translate-start",i),this.on("graphic-translate",i),this.on("graphic-translate-stop",(()=>{this.tooltip.clear()})),this.on("graphic-rotate-start",i),this.on("graphic-rotate",i),this.on("graphic-rotate-stop",i),this.on("graphic-scale-start",i),this.on("graphic-scale",i),this.on("graphic-scale-stop",i)]),this._forEachManipulator((e=>{this.addHandles([e.events.on("focus-changed",i),e.events.on("grab-changed",i),e.events.on("drag",(e=>{"cancel"===e.action?this.tooltip.clear():i()}))])}))}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(ho),this._bounds.updateDisplayBounds(),this._graphicState.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(e=>{null!=this._attachmentOrigin&&(0,Sn.Rj)(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()})),ho)}_updateManipulators(){if(!this.visible)return;const e=this._bounds.displayBounds,t=function(e,t){return ln(e.basis1,e.basis2,e.origin,t)}(e,E.Rc.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof Dn){const n=this._graphicState.displaying,a=this.enableZ&&_n(this.graphic);switch(t){case Yn.ROTATE:e.available=n&&this.enableRotation;break;case Yn.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||a),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Sr:xr;break;case Yn.TRANSLATE_Z:e.available=n&&a;break;default:e.available=n}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get attachmentOrigin(){const e=this.graphic.geometry,t=this._graphicState.isDraped?null:this._outlineVisualElement?.attachmentOrigin;return this._attachmentOrigin=t??cn(this.view,this.graphic)??e?.extent?.center,this._attachmentOrigin}reset(){}cancel(){if(this.canUndo){const e=this._editGeometryOperations.undo();(0,Pr.fJ)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}this.inputState=null}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();(0,Pr.fJ)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();(0,Pr.Bb)(e,this._bounds.mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry}}get test(){return{moveZManipulator:this._extentMove.moveZManipulator,resizeManipulators:this._extentScale.resizeManipulators,rotateManipulator:this._extentRotate.rotateManipulator}}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],co.prototype,"view",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],co.prototype,"graphic",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"enableZ",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"enableScaling",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"enableRotation",void 0),(0,n._)([(0,l.MZ)({constructOnly:!0,type:qa.A})],co.prototype,"sketchOptions",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"preserveAspectRatio",null),(0,n._)([(0,l.MZ)()],co.prototype,"grabbing",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"inputState",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],co.prototype,"type",void 0),(0,n._)([(0,l.MZ)()],co.prototype,"tooltip",void 0),co=(0,n._)([(0,h.$)("esri.views.3d.interactive.editingTools.transformGraphic.ExtentTransformTool")],co);const ho="draped-elevation-changes"},45506:(e,t,i)=>{i.d(t,{ab:()=>be,gm:()=>Pe});var n=i(82541),a=i(79441),s=i(26110),r=i(31753),o=i(19165),l=i(80347),c=i(19913),h=i(74772),d=i(76982),p=i(34670),u=i(32159),_=i(63540),g=i(88133),m=i(99269),f=i(87368),v=i(67488),y=i(11631),b=i(84456),M=i(56560),w=i(10941);const S=1e-6,x=(0,c.vt)(),O=(0,c.vt)();function E(e,t,i,n,a,s,r,o,l,c){return function(e,t,i){let n=ve(e.maxVert[0],e.minVert[0]),a=0;for(let t=1;t<7;++t){const i=ve(e.maxVert[t],e.minVert[t]);i>n&&(n=i,a=t)}_e(t,e.minVert[a]),_e(i,e.maxVert[a])}(e,n,a),ve(n,a)<S?1:(pe(r,n,a),me(r,r),function(e,t,i,n){const{data:a,size:s}=e;let r=Number.NEGATIVE_INFINITY,o=0;for(let e=0;e<a.length;e+=s){z[0]=a[e]-t[0],z[1]=a[e+1]-t[1],z[2]=a[e+2]-t[2];const n=i[0]*z[0]+i[1]*z[1]+i[2]*z[2],s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=z[0]*z[0]+z[1]*z[1]+z[2]*z[2]-n*n/s;l>r&&(r=l,o=e)}return _e(n,a,o),r}(t,n,r,s)<S?2:(pe(o,a,s),me(o,o),pe(l,s,n),me(l,l),ge(i,o,r),me(i,i),U(t,i,r,o,l,c),0))}const A=(0,c.vt)(),T=(0,c.vt)(),R=(0,c.vt)(),P=(0,c.vt)(),D=(0,c.vt)(),C=(0,c.vt)(),I=(0,c.vt)(),L=(0,c.vt)();function G(e,t,i,n,a,s,r,o,l){(function(e,t,i,n,a){!function(e,t,i,n,a){const{data:s,size:r}=e;_e(n,s),_e(a,n),i[0]=ye(B,t),i[1]=i[0];for(let e=r;e<s.length;e+=r){const r=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];r<i[0]&&(i[0]=r,_e(n,s,e)),r>i[1]&&(i[1]=r,_e(a,s,e))}}(e,t,V,a,n);const s=ye(i,t);V[1]-S<=s&&(n[0]=void 0),V[0]+S>=s&&(a[0]=void 0)})(e,t,i,A,T),void 0!==A[0]&&(pe(R,A,i),me(R,R),pe(P,A,n),me(P,P),pe(D,A,a),me(D,D),ge(C,P,s),me(C,C),ge(I,D,r),me(I,I),ge(L,R,o),me(L,L),U(e,C,s,P,R,l),U(e,I,r,D,P,l),U(e,L,o,R,D,l)),void 0!==T[0]&&(pe(R,T,i),me(R,R),pe(P,T,n),me(P,P),pe(D,T,a),me(D,D),ge(C,P,s),me(C,C),ge(I,D,r),me(I,I),ge(L,R,o),me(L,L),U(e,C,s,P,R,l),U(e,I,r,D,P,l),U(e,L,o,R,D,l))}const z=[0,0,0],V=(0,M.vt)(),N=(0,c.vt)(),Z=(0,c.vt)(),H=(0,c.vt)(),j=(0,c.vt)(),F=(0,c.vt)(),k=(0,c.vt)();function U(e,t,i,n,a,s){if(fe(t)<S)return;ge(N,i,t),ge(Z,n,t),ge(H,a,t),q(e,t,V),F[1]=V[0],j[1]=V[1],k[1]=j[1]-F[1];const r=[i,n,a],o=[N,Z,H];for(let i=0;i<3;++i){q(e,r[i],V),F[0]=V[0],j[0]=V[1],q(e,o[i],V),F[2]=V[0],j[2]=V[1],k[0]=j[0]-F[0],k[2]=j[2]-F[2];const n=he(k);n<s.quality&&(_e(s.b0,r[i]),_e(s.b1,t),_e(s.b2,o[i]),s.quality=n)}}const B=(0,c.vt)();function q(e,t,i){const{data:n,size:a}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e+=a){const a=n[e]*t[0]+n[e+1]*t[1]+n[e+2]*t[2];i[0]=Math.min(i[0],a),i[1]=Math.max(i[1],a)}}function W(e,t,i){i.center=e,i.halfSize=(0,l.h)(t,t,.5),i.quaternion=o.zK}const X=(0,c.vt)(),Y=(0,c.vt)(),$=(0,c.vt)(),Q=(0,c.vt)(),J=(0,c.vt)(),K=(0,c.vt)();function ee(e,t,i){_e(X,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?X[0]=0:Math.abs(t[1])>Math.abs(t[2])?X[1]=0:X[2]=0,fe(X)<S&&(X[0]=X[1]=X[2]=1),ge(Y,t,X),me(Y,Y),ge($,t,Y),me($,$),te(e,t,Y,$,Q,J),pe(K,J,Q),oe(t,Y,$,Q,J,K,i)}function te(e,t,i,n,a,s){q(e,t,V),a[0]=V[0],s[0]=V[1],q(e,i,V),a[1]=V[0],s[1]=V[1],q(e,n,V),a[2]=V[0],s[2]=V[1]}const ie=(0,c.vt)(),ne=(0,c.vt)(),ae=(0,c.vt)(),se=(0,a.fA)(1,0,0,0,1,0,0,0,1),re=(0,o.vt)();function oe(e,t,i,n,a,s,r){se[0]=e[0],se[1]=e[1],se[2]=e[2],se[3]=t[0],se[4]=t[1],se[5]=t[2],se[6]=i[0],se[7]=i[1],se[8]=i[2],r.quaternion=function(e,t){const i=t[0]+t[4]+t[8];if(i>0){let n=Math.sqrt(i+1);e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,a=(i+2)%3;let s=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1);e[i]=.5*s,s=.5/s,e[3]=(t[3*n+a]-t[3*a+n])*s,e[n]=(t[3*n+i]+t[3*i+n])*s,e[a]=(t[3*a+i]+t[3*i+a])*s}return e}(re,se),de(ie,n,a),ue(ie,ie,.5),ue(ne,e,ie[0]),ue(ae,t,ie[1]),de(ne,ne,ae),ue(ae,i,ie[2]),r.center=(0,l.g)(ne,ne,ae),r.halfSize=(0,l.h)(ie,s,.5)}class le{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const i=new Array(7),n=new Array(7),{data:a,size:s}=e;for(let e=0;e<a.length;e+=s){let t=a[e];t<this.minProj[0]&&(this.minProj[0]=t,i[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,n[0]=e),t=a[e+1],t<this.minProj[1]&&(this.minProj[1]=t,i[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,n[1]=e),t=a[e+2],t<this.minProj[2]&&(this.minProj[2]=t,i[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,n[2]=e),t=a[e]+a[e+1]+a[e+2],t<this.minProj[3]&&(this.minProj[3]=t,i[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,n[3]=e),t=a[e]+a[e+1]-a[e+2],t<this.minProj[4]&&(this.minProj[4]=t,i[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,n[4]=e),t=a[e]-a[e+1]+a[e+2],t<this.minProj[5]&&(this.minProj[5]=t,i[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,n[5]=e),t=a[e]-a[e+1]-a[e+2],t<this.minProj[6]&&(this.minProj[6]=t,i[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,n[6]=e)}for(let e=0;e<7;++e){let t=i[e];_e(this.minVert[e],a,t),t=n[e],_e(this.maxVert[e],a,t)}}}class ce{constructor(){this.b0=(0,c.fA)(1,0,0),this.b1=(0,c.fA)(0,1,0),this.b2=(0,c.fA)(0,0,1),this.quality=0}}function he(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function de(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function pe(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function ue(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function _e(e,t,i=0){e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2]}function ge(e,t,i){const n=t[0],a=t[1],s=t[2],r=i[0],o=i[1],l=i[2];e[0]=a*l-s*o,e[1]=s*r-n*l,e[2]=n*o-a*r}function me(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const n=1/Math.sqrt(i);e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n}}function fe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ve(e,t){const i=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return i*i+n*n+a*a}function ye(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}class be{constructor(e=c.uY,t=Ue,i=o.zK){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],i[0],i[1],i[2],i[3]]}clone(){const e=new be;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new be;return t._data=e.slice(),t}static fromJSON(e){return new be(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return(0,l.s)(y.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,i){this._data[0]=e,this._data[1]=t,this._data[2]=i}get halfSize(){return(0,l.s)(y.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return(0,r.hZ)(y.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=Me,i=this._data;t[0]=i[6],t[1]=i[7],t[2]=i[8],t[3]=i[9];for(let n=0;n<8;++n){const a=e[n];a[0]=(1&n?-1:1)*i[3],a[1]=(2&n?-1:1)*i[4],a[2]=(4&n?-1:1)*i[5],(0,l.u)(a,a,t),a[0]+=i[0],a[1]+=i[1],a[2]+=i[2]}}isVisible(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],i=this._data[5];return Math.sqrt(e*e+t*t+i*i)}intersectSphere(e){xe[0]=this._data[0]-e[0],xe[1]=this._data[1]-e[1],xe[2]=this._data[2]-e[2];const t=this.getQuaternion(we);return(0,r.Xr)(Me,t),(0,l.u)(xe,xe,Me),(0,l.v)(xe,xe),Oe[0]=Math.min(xe[0],this._data[3]),Oe[1]=Math.min(xe[1],this._data[4]),Oe[2]=Math.min(xe[2],this._data[5]),(0,l.w)(Oe,xe)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const i=this._data;xe[0]=i[0]-e[0],xe[1]=i[1]-e[1],xe[2]=i[2]-e[2];const n=e[3],a=n+t;return!((0,l.x)(xe)>a*a)&&(Me[0]=-i[6],Me[1]=-i[7],Me[2]=-i[8],Me[3]=i[9],(0,l.u)(xe,xe,Me),(0,l.v)(xe,xe),Oe[0]=Math.min(xe[0],i[3]),Oe[1]=Math.min(xe[1],i[4]),Oe[2]=Math.min(xe[2],i[5]),(0,l.w)(Oe,xe)<n*n)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],i=this.projectedRadius((0,f.Qj)(e));return t>i?1:t<-i?-1:0}intersectRay(e,t,i=0){const n=this._data,a=Me;a[0]=-n[6],a[1]=-n[7],a[2]=-n[8],a[3]=n[9],xe[0]=e[0]-n[0],xe[1]=e[1]-n[1],xe[2]=e[2]-n[2];const s=(0,l.u)(xe,xe,Me),r=(0,l.u)(Oe,t,Me);let o=-1/0,c=1/0;const h=this.getHalfSize(Ve);for(let e=0;e<3;e++){const t=s[e],n=r[e],a=h[e]+i;if(Math.abs(n)>1e-6){const e=(a-t)/n,i=(-a-t)/n;o=Math.max(o,Math.min(e,i)),c=Math.min(c,Math.max(e,i))}else if(t>a||t<-a)return!1}return o<=c}projectedArea(e,t,i,a){const s=this.getQuaternion(we);(0,r.Xr)(Me,s),xe[0]=e[0]-this._data[0],xe[1]=e[1]-this._data[1],xe[2]=e[2]-this._data[2],(0,l.u)(xe,xe,Me);const o=this.getHalfSize(Ve),c=xe[0]<-o[0]?-1:xe[0]>o[0]?1:0,d=xe[1]<-o[1]?-1:xe[1]>o[1]?1:0,p=xe[2]<-o[2]?-1:xe[2]>o[2]?1:0,u=Math.abs(c)+Math.abs(d)+Math.abs(p);if(0===u)return 1/0;const _=1===u?4:6,g=6*(c+3*d+9*p+13);(0,n.I0)(Ne,s),(0,n.hs)(Ne,Ne,o);const m=this.getCenter(Ge);for(let e=0;e<_;e++){const i=Re[g+e];(0,l.s)(xe,((1&i)<<1)-1,(2&i)-1,((4&i)>>1)-1),(0,l.t)(xe,xe,Ne),(0,l.g)(Ee,m,xe),Ee[3]=1,(0,h.t)(Ee,Ee,t);const n=1/Math.max(1e-6,Ee[3]);Te[2*e]=Ee[0]*n,Te[2*e+1]=Ee[1]*n}const f=2*_-2;let v=Te[0]*(Te[3]-Te[f+1])+Te[f]*(Te[1]-Te[f-1]);for(let e=2;e<f;e+=2)v+=Te[e]*(Te[e+3]-Te[e-1]);return Math.abs(v)*i*a*.125}projectedRadius(e){const t=this.getQuaternion(we);return(0,r.Xr)(Me,t),(0,l.u)(xe,e,Me),Math.abs(xe[0]*this._data[3])+Math.abs(xe[1]*this._data[4])+Math.abs(xe[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius((0,f.Qj)(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius((0,f.Qj)(e))}toAaBoundingBox(e){const t=this.getQuaternion(we),i=(0,n.I0)(Ne,t),a=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),r=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-a,e[1]=this._data[1]-s,e[2]=this._data[2]-r,e[3]=this._data[0]+a,e[4]=this._data[1]+s,e[5]=this._data[2]+r}transform(e,t,i,n=0,a=(0,u.lO)(i),s=(0,u.lO)(t),o=(0,m.jd)(t,s)){if(i===a)t.isGeographic?function(e,t,i,n,a=(0,u.lO)(i)){const s=(0,p.tO)(i),o=1+Math.max(0,n)/(s.radius+e.centerZ);e.getCenter(Le),Le[2]+=n,(0,g.projectBuffer)(Le,i,0,Le,a,0,1),t.center=Le;const c=e.getQuaternion(we);t.quaternion=c,(0,r.Xr)(Me,c),(0,l.s)(je,0,0,1),(0,l.u)(je,je,Me);const h=e.getHalfSize(Ve);(0,l.s)(je,h[0]*Math.abs(je[0]),h[1]*Math.abs(je[1]),h[2]*Math.abs(je[2])),(0,l.h)(je,je,s.inverseFlattening),(0,l.g)(je,h,je),t.halfSize=(0,l.h)(je,je,o)}(this,e,t,n,s):function(e,t,i,n,a=(0,u.lO)(i),s=(0,m.jd)(i,a)){e.getCorners(He),e.getCenter(Le),Le[2]+=n,(0,_.l)(i,Le,Ze,a),t.setCenter(Ze[12],Ze[13],Ze[14]);const o=2*Math.sqrt(1+Ze[0]+Ze[5]+Ze[10]);Me[0]=(Ze[6]-Ze[9])/o,Me[1]=(Ze[8]-Ze[2])/o,Me[2]=(Ze[1]-Ze[4])/o,Me[3]=.25*o;const c=e.getQuaternion(we);t.quaternion=(0,r.lw)(Me,Me,c),(0,r.Xr)(Me,Me),(0,l.s)(Fe,0,0,0);const h=t.getCenter(ze);for(const e of He)e[2]+=n,s(e,0,e,0),(0,l.z)(je,e,h),(0,l.u)(je,je,Me),(0,l.v)(je,je),(0,l.C)(Fe,Fe,je);t.halfSize=Fe}(this,e,t,n,s,o);else if(t.isWGS84&&(i.isWebMercator||(0,v.r1)(i)))!function(e,t,i,n,a){t.getCenter(Ge),Ge[2]+=a;const s=(0,u.lO)(i);(0,g.projectBuffer)(Ge,e,0,Ge,s,0,1),De(s,t,Ge,i,n)}(t,this,i,e,n);else if(t.isWebMercator&&(0,v.r1)(i))!function(e,t,i,n,a){t.getCenter(Ge),Ge[2]+=a,De(e,t,Ge,i,n)}(t,this,i,e,n);else{const a=this.getCenter(Ge);a[2]+=n,(0,g.projectBuffer)(a,t,0,a,i,0,1),e.center=a,this!==e&&(e.quaternion=this.getQuaternion(we),e.halfSize=this.getHalfSize(Ve))}}}const Me=(0,o.vt)(),we=(0,o.vt)(),Se=(0,o.vt)(),xe=(0,c.vt)(),Oe=(0,c.vt)(),Ee=(0,d.vt)();function Ae(e,t=new be){return function(e,t){const{data:i,size:n}=e,a=i.length/n;if(a<=0)return;const s=new le(e);de(x,s.minProj,s.maxProj),ue(x,x,.5),pe(O,s.maxProj,s.minProj);const r=he(O),o=new ce;o.quality=r,a<14&&(e=new w.K(new Float64Array(s.buffer,112,42),3));const l=(0,c.vt)(),h=(0,c.vt)(),d=(0,c.vt)(),p=(0,c.vt)(),u=(0,c.vt)(),_=(0,c.vt)(),g=(0,c.vt)();switch(E(s,e,g,l,h,d,p,u,_,o)){case 1:return void W(x,O,t);case 2:return void ee(e,p,t)}G(e,g,l,h,d,p,u,_,o),te(e,o.b0,o.b1,o.b2,Q,J);const m=(0,c.vt)();pe(m,J,Q),o.quality=he(m),o.quality<r?oe(o.b0,o.b1,o.b2,Q,J,m,t):W(x,O,t)}(e,t),t}const Te=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],Re=(()=>{const e=new Int8Array(162);let t=0;const i=i=>{for(let n=0;n<i.length;n++)e[t+n]=i[n];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function Pe(e,t,i,n,a){const s=e.getQuaternion(we);a.quaternion=s,(0,r.Xr)(Me,s);const o=e.getCenter(Ge),h=e.getHalfSize(Ve);if(n===b.RT.Global){(0,l.u)(je,o,Me),(0,l.v)(Fe,je),(0,l.y)(ke,Fe,h),(0,l.z)(ke,Fe,ke);const n=(0,l.l)(ke);(0,l.g)(ke,Fe,h);const s=(0,l.l)(ke);if(n<i)a.center=o,(0,l.s)(je,i,i,i),a.halfSize=(0,l.g)(je,h,je);else{const r=s>0?1+t/s:1,o=n>0?1+i/n:1,c=(o+r)/2,d=(o-r)/2;(0,l.h)(ke,Fe,d),a.halfSize=(0,l.r)(ke,ke,h,c),(0,l.h)(ke,Fe,c),(0,l.r)(ke,ke,h,d),(0,l.A)(je,je),(0,l.B)(je,ke,je);const p=e.getQuaternion(Se);a.center=(0,l.u)(je,je,p)}}else{a.center=(0,l.r)(je,o,c.Cb,(i+t)/2);const e=(0,l.u)(je,c.Cb,Me);(0,l.v)(e,e),a.halfSize=(0,l.r)(Fe,h,e,(i-t)/2)}return a}function De(e,t,i,a,s){const r=t.getQuaternion(we),o=(0,n.I0)(Ne,r),l=t.getHalfSize(Ve);for(let e=0;e<8;++e){for(let t=0;t<3;++t)Le[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let n=i[t];for(let e=0;e<3;++e)n+=Le[e]*o[3*e+t];Ce[3*e+t]=n}}(0,g.projectBuffer)(Ce,e,0,Ce,a,0,8),Ae(Ie,s)}const Ce=new Array(24),Ie=new w.K(Ce,3),Le=(0,c.vt)(),Ge=(0,c.vt)(),ze=(0,c.vt)(),Ve=(0,c.vt)(),Ne=(0,a.vt)(),Ze=(0,s.vt)(),He=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],je=(0,c.vt)(),Fe=(0,c.vt)(),ke=(0,c.vt)(),Ue=(0,c.fA)(-1,-1,-1)},1725:(e,t,i)=>{i.d(t,{K:()=>h});var n=i(16937),a=i(36288),s=i(66579),r=i(64802),o=i(19635),l=i(41014),c=i(19778);function h(e,t){const i=e.fragment;i.include(n.D),e.include(a.Ir),i.uniforms.add(new o.m("globalAlpha",(e=>e.globalAlpha)),new r.t("glowColor",(e=>e.glowColor)),new o.m("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new o.m("glowFalloff",(e=>e.glowFalloff)),new r.t("innerColor",(e=>e.innerColor)),new o.m("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new c.N("depthMap",((e,t)=>t.linearDepth?.getTexture())),new s.G("nearFar",((e,t)=>t.camera.nearFar)),new c.N("frameColor",((e,t)=>t.mainColor))),i.code.add(l.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),i.code.add(l.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),i.code.add(l.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),i.code.add(l.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?(i.uniforms.add(new o.m("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),i.code.add(l.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):i.code.add(l.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},12540:(e,t,i)=>{i.d(t,{L:()=>r});var n=i(69952),a=i(19635),s=i(41014);function r(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,n.yu)(i,t),i.uniforms.add(new a.m("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new a.m("screenSizeScale",(e=>e.screenSizeScale))),i.code.add(s.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},10941:(e,t,i)=>{i.d(t,{K:()=>n,n:()=>a});class n{constructor(e,t,i=t){this.data=e,this.size=t,this.stride=i}}class a extends n{constructor(e,t,i,n=!1,a=i){super(e,i,a),this.indices=t,this.exclusive=n}}},60595:(e,t,i)=>{i.d(t,{c:()=>c,d:()=>l});var n=i(82392),a=i(7743),s=i(81482),r=i(26325),o=i(27920);let l=class extends o.w{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,n._)([(0,s.MZ)()],l.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],l.prototype,"angle",void 0),l=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let c=class extends o.w{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=a.r7,this.ySize=a.r7}};(0,n._)([(0,s.MZ)()],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"xScale",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"yScale",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"xSize",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"ySize",void 0),c=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],c)},83853:(e,t,i)=>{i.d(t,{JH:()=>u,YI:()=>c,ar:()=>l,nW:()=>h,un:()=>d,y3:()=>p});var n=i(82392),a=i(7743),s=i(81482),r=i(26325),o=i(27920);let l=class extends o.w{constructor(e){super(e),this.type="translate-graphic",this.distance=a.r7}clear(){this.distance=a.r7}};(0,n._)([(0,s.MZ)()],l.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],l.prototype,"distance",void 0),l=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let c=class extends o.w{constructor(e){super(e),this.type="translate-graphic-z",this.distance=a.r7}clear(){this.distance=a.r7}};(0,n._)([(0,s.MZ)()],c.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],c.prototype,"distance",void 0),c=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],c);let h=class extends o.w{constructor(e){super(e),this.type="translate-graphic-xy",this.distance=a.r7}};(0,n._)([(0,s.MZ)()],h.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],h.prototype,"distance",void 0),h=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],h);let d=class extends o.w{constructor(e){super(e),this.type="translate-vertex",this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,s.MZ)()],d.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],d.prototype,"distance",void 0),(0,n._)([(0,s.MZ)()],d.prototype,"elevation",void 0),(0,n._)([(0,s.MZ)()],d.prototype,"area",void 0),(0,n._)([(0,s.MZ)()],d.prototype,"totalLength",void 0),d=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],d);let p=class extends o.w{constructor(e){super(e),this.type="translate-vertex-z",this.distance=a.r7,this.elevation=null}clear(){this.distance=a.r7,this.elevation=null}};(0,n._)([(0,s.MZ)()],p.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],p.prototype,"distance",void 0),(0,n._)([(0,s.MZ)()],p.prototype,"elevation",void 0),p=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],p);let u=class extends o.w{constructor(e){super(e),this.type="translate-vertex-xy",this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=a.r7,this.elevation=null,this.area=null,this.totalLength=null}};(0,n._)([(0,s.MZ)()],u.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"distance",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"elevation",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"area",void 0),(0,n._)([(0,s.MZ)()],u.prototype,"totalLength",void 0),u=(0,n._)([(0,r.$)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],u)},22781:(e,t,i)=>{i.d(t,{b:()=>s});var n=i(7743),a=i(49970);function s({topLeft:e,topRight:t,bottomRight:i,bottomLeft:s,spatialReference:r}){const o=(0,n.T9)((0,a.Do)(s,i,r),(0,a.Do)(e,t,r));if(null==o)return null;const l=(0,n.T9)((0,a.Do)(i,t,r),(0,a.Do)(s,e,r));return null==l?null:{xSize:o,ySize:l}}}}]);